function is_mobile(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}function scrollWidth(){return window.innerWidth-document.documentElement.clientWidth}function menu(){$(".dd > a").attr("onclick","$(this).next().slideToggle('fast');return false;")}function devBarcode(t){clearTimeout(barTimer);var e=t.match(/DE\s([0-9]+)[.*]?/i);e&&(barTimer=setTimeout(function(){$.post("/ссылка",{id:parseInt(e[2])},function(){})},200))}function checkBarcode(t){clearTimeout(barTimer),console.log(t);var e,a,n=t.match(/(US|IS|DE|OB|PU|IN)\s([0-9]+)[.*]?/i);return n&&(barTimer=setTimeout(function(){switch(console.log(n),a=parseInt(n[2]),n[1]){case"US":e="/users/view/";break;case"IS":e="/issues/view/";break;case"DE":e="/inventory/view/";break;case"OB":e="/objects/edit/";break;case"PU":e="/purchases/edit/";break;case"IN":e="/invoices/view/"}return!!e&&Page.get(e+a)},200)),barTimer}function mainSearch(t){t.length?(clearTimeout(searchTimer),searchTimer=setTimeout(function(){$.post("/search",{q:t,type:$("[name='sGroup']").val()},function(t){$(".searchResult").html(t.content).show()},"json")},200)):$(".searchResult").hide()}function b64Blob(t,e){for(var a=atob(t),n=new Array(a.length),s=0;s<a.length;s++)n[s]=a.charCodeAt(s);var l=new Uint8Array(n);return new Blob([l],{type:e})}function min_price(t){for(var e in pf)if(t<e)return t+t/100*pf[e];return t+t/100*pf[0]}function userAppend(t,e){t.empty(),$.each(e,function(e,a){t.append($("<li/>",{class:"hnt hntTop","data-title":a.name,html:$("<a/>",{href:"/users/views/"+e,html:$("<img/>",{src:a.photo?"/uploads/images/users/"+e+"/thumb_"+a.photo:"/templates/admin/img/userDef.jpg",onclick:"showPhoto(this.src);"}),onclick:"return false;"})}))})}function getLocation(t){$("#location > ul").length||($("#location > input").removeData(),$("#location > .sfWrap").remove(),$("#location").append($("<ul/>"))),$.post("/objects/get_locations",{sId:Object.keys($('input[name="status"]').data()||{}).join(",")||11,nIds:Object.keys($('input[name="location"]').data()).join(","),oId:Object.keys($('input[name="object"]').data()||{}).join(",")||$(".devLocation").attr("data-object")||0,warranty:$("#location").length&&1==$("#location").attr("warranty")?1:0},function(e){if(e){var a="",n=0;$.each(e.list,function(t,e){a+='<li data-value="'+e.id+'" data-count="'+e.count+'">'+e.name+"</li>",n=e});var s=$('input[name="status"]').data()||{};(location_id&&!t||Object.keys(status_id)[0]==Object.keys(s)[0])&&($("#location > input").data(location_id),location_id="",object_id=""),$("#location > ul").html(a).sForm({action:"/objects/get_locations",data:{lId:n,sId:Object.keys($('input[name="status"]').data()||{}).join(",")||11,oId:Object.keys($('input[name="object"]').data()||{}).join(",")||$(".devLocation").attr("data-object")||object_id||0,query:$("#location > .sfWrap input").val()||"",warranty:$("#location").length&&1==$("#location").attr("warranty")?1:0},all:e.count<=20,select:$('input[name="location"]').data(),s:!0},$('input[name="location"]'),function(){$("#sublocation").find("select").empty(),getCount(t)},{oId:"object",sId:"status"})}},"json")}function getCount(t){var e='<option value="0">Not selected</option>',a=Object.keys($('input[name="location"]').data()||{}).join(",")?$('input[name="location"]').data()[Object.keys($('input[name="location"]').data()||{}).join(",")].count:0,n=$('input[name="location"]').data()||{};if(a>0){for(var s=1;s<=a;s++)e+='<option value="'+s+'"'+(Object.keys(count_id)[0]==Object.keys(n)[0]&&location_count==s?" selected":"")+">"+s+"</option>";location_id||(location_count=0),$("#sublocation").show().find("select").html(e),$("#sublocation .sWrap").length&&($("#sublocation .sWrap").remove(),$("#page").select())}else $("#sublocation").hide().find("select").val(0).trigger("change")}function income(){$("#income").html("<b>"+$('select[name="currency"] > option[value="'+$('select[name="currency"]').val()+'"]').attr("data-symbol")+(parseFloat($('input[name="price"]').val()||0)-parseFloat($('input[name="purchase-price"]').val()||0))+"</b>")}function selectAll(t,e){$('select[name="'+t+'"] > option').each(function(t,a){$(a).prop("selected",e>0?e:0).trigger("change")})}function hideArea(t){$(t).text("More"==$(t).text()?"Less":"More").next().next().slideToggle("fast")}function to_print(t,e){window.open(t,"_blank").onload=function(){this.document.title=e}}function round100(t,e,a){return t%e?a?t+e-t%e:t-e-t%e:t}function hideCalendar(t){$(t.target).hasClass("cl")&&$(t.target).parents(".filterCtnr").find(".calendar").hide()}function $_GET(t){var e=window.location.search.match(new RegExp("(\\?|&)"+t+"(\\[\\])?=([^&]*)"));return!!e&&e[3]}function closeCalendar(){$(".calendar").hide().parent().removeClass("act")}function accordeon(t){$(t).next().hasClass("hide")?($(t).parent().parent().find(".open").removeClass("open").addClass("hide").slideUp("fast"),$(t).next().slideDown("fast").removeClass("hide").addClass("open")):$(t).next().removeClass("open").addClass("hide").slideUp("fast")}function checkExists(){$('input[name="name"]').val().trim()&&$('input[name="lastname"]').val().trim()&&$.post("/users/check_by_name",{name:$('input[name="name"]').val().trim(),lanstname:$('input[name="lastname"]').val().trim()},function(t){if("OK"==t.res){var e="";t.data.length;$.each(t.data,function(){e+='<a href="/users/view/'+this.id+'" onclick="Page.get(this.href); return false">'+(this.image?'<img src="/uploads/images/users/'+this.id+"/"+this.image+'" class="miniRound">':'<span class="fa fa-user-secret miniRound"></span>')+this.name+" "+this.lastname+'<span class="exists_info">(<b>'+this.email+"</b>, "+this.phone+")</span>\t\t\t\t\t</a>"}),$(".exists_users").html("<h1>"+t.count+(1==t.count?" user":" users")+" found"+(t.count>10?'<span class="last10">(Printed last 10 results)</span>':"")+"</h1>"+e)}else $(".exists_users").empty()},"json")}var page=0,page_stats=0,query="",model_id="",type_id="",brand_id="",location_id="",object_id="";location_count=0,doload=!1,status_id="",count_id=0,online_users=null;var is_valid={name:function(t){return new RegExp(/^[a-zA-Za-яА-ЯїЇіІЄєЎўҐґ'0-9-_\.\s]+$/).test(t)},email:function(t){return new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i).test(t)},phone:function(t){return new RegExp(/^[0-9-(-+]+$/i).test(t)},intval:function(t){return new RegExp(/^[0-9+]+$/i).test(t)}};window.onload=function(){window.setTimeout(function(){window.addEventListener("popstate",function(t){t.preventDefault(),t.state?Page.get(t.state.link,!0):Page.get(window.location.pathname,!0)},!1)},1),Page.init()},$(window).resize(function(){menu(),$(".lMenu").removeClass("show")});var Page={scroll:0,check_top:function(){Page.scroll>0&&$(window).scrollTop()>=Page.scroll?(Page.scroll=0,$(".top_page").attr("onClick","Page.up();").find("li").removeClass("fa-arrow-down").addClass("fa-arrow-up")):$(window).scrollTop()>500?$(".top_page").fadeIn():Page.scroll<1&&$(".top_page").fadeOut()},up:function(){this.scroll=window.scrollY,window.scrollTo(0,0),$(".top_page").attr("onClick","Page.down();").find("li").removeClass("fa-arrow-up").addClass("fa-arrow-down")},down:function(t){window.scrollTo(0,this.scroll),$(".top_page").attr("onClick","Page.up();").find("li").removeClass("fa-arrow-down").addClass("fa-arrow-up"),this.scroll=0},init:function(t){page=0,query="",doload=!1,menu(),$("#page").checkbox(),$("#page").select(),$("#page").tabs(),$("#page").radio(),$(window).width()<=992&&$(".lMenu").removeClass("show"),$(".dd > ul").slideUp("fast"),$(".navMore").slideUp("fast"),clearInterval(online_users),$(".new_guest").length||mdl.close()},get:function(t,e){$("body").addClass("pre"),$(".notifications > .nfArea").hide(),e||history.pushState({link:t},null,t),$.getJSON(t,function(e){if("loggout"==e&&location.reload(),document.title=e.title,e.new_msg>0){var a=$("#new_msg > a"),n=a.find(".newMsg");n.length?n.text(e.new_msg):a.append($("<span/>",{class:"newMsg",text:e.new_msg}))}else $("#new_msg > a > .newMsg").remove();e.notify_count?$(".notifications > #notify").addClass("nfCount nfc").text(e.notify_count):$(".notifications > #notify").removeClass("nfCount nfc").text(""),$("#cpu").text(e.cpu),$("#time_script").text(e.time_script),$("#compile_tpl").text(e.compile_tpl),$("#query_cache").html(e.query_cache),$("#query_db").html(e.query_db),$("#points_top").html(e.points),$("#page").html(e.content),$("body").removeClass("pre"),$(window).scrollTop(0),Page.scroll=0,$(".top_page").hide(),Page.init(t)})}},barTimer=void 0,searchTimer=void 0,Search=function(t,e){query=t,$.post(location.pathname,{query:t,event:$('select[name="searchSel"]').val()||"",object:$('select[name="object"]').length?$('select[name="object"]').val():Object.keys($('input[name="object"]').data()||{}).join(","),date_start:$('#calendar > input[name="date"]').val(),date_finish:$('#calendar > input[name="fDate"]').val(),status:$('select[name="status"]').val(),type:e||$('select[name="type"]').val(),group:$('select[name="group"]').val(),instore:$('input[name="instore"]').val(),pickedup:$('input[name="pickedup"]').val(),all:$('input[name="all"]').val(),updated:$('input[name="updated"]').val(),action:$('select[name="action"]').val(),payment:$('select[name="payment"]').val(),rating:$('select[name="rating"]').val(),staff:Object.keys($('input[name="staff"]').data()||{}).join(","),create:Object.keys($('input[name="create"]').data()||{}).join(","),confirm:Object.keys($('input[name="confirm"]').data()||{}).join(","),inv_type:Object.keys($('input[name="inv_type"]').data()||{}).join(","),profit:$('input[name="profit"]').val(),verified:$('input[name="verified"]').val(),craiglist:$('input[name="craiglist"]').val(),salary:$('input[name="salary"]').val(),tax:$('input[name="tax"]').val(),hours:$('input[name="hours"]').val()},function(t){page=0,doload=!1,$("#res_count").text(t.res_count),$(".userList").html(t.content),t.left_count>0?$(".btnLoad").removeClass("hdn"):$(".btnLoad").addClass("hdn"),t.salary?$("#salary").show():$("#salary").length&&$("#salary").hide(),t.hours?$("#hours").show():$("#hours").length&&$("#hours").hide(),$(".filterCtnr").length&&$(".filterCtnr").hide(),$(".totalTime").length&&t.total&&(t.total.total_sale?($("#purchase").html(t.total.total_purchase),$("#sale").html(t.total.total_sale),$("#proceed").html(t.total.total_proceed)):$(".totalTime > span").html(t.total),parseInt(t.total_q)&&$("#total_q").html(t.total_q))},"json")};$(window).scroll(function(){doload||!$(".userList").length||$(".btnLoad").hasClass("hdn")||$(window).scrollTop()+$(window).height()>=$(document).height()-500&&(doload=!0,Doload(document.getElementsByClassName("btnLoad")[0]))});var Doload=function(t){$(t).find("span").addClass("fa-spin"),page+=1,$.post($(t).attr("action")||location.pathname,{query:query,page:$(t).attr("page")||page,id:$(t).attr("data-id")||0,event:$('select[name="searchSel"]').val()||"",object:$('select[name="object"]').length?$('select[name="object"]').val():Object.keys($('input[name="object"]').data()||{}).join(","),date_start:$('#calendar > input[name="date"]').val(),date_finish:$('#calendar > input[name="fDate"]').val(),status:$('select[name="status"]').val(),group:$('select[name="group"]').val(),type:$('select[name="type"]').val(),instore:$('input[name="instore"]').val(),all:$('input[name="all"]').val(),updated:$('input[name="updated"]').val(),pickedup:$('input[name="pickedup"]').val(),action:$('select[name="action"]').val(),payment:$('select[name="payment"]').val(),rating:$('select[name="rating"]').val(),staff:Object.keys($('input[name="staff"]').data()||{}).join(","),create:Object.keys($('input[name="create"]').data()||{}).join(","),confirm:Object.keys($('input[name="confirm"]').data()||{}).join(","),inv_type:Object.keys($('input[name="inv_type"]').data()||{}).join(","),profit:$('input[name="profit"]').val(),verified:$('input[name="verified"]').val(),craiglist:$('input[name="craiglist"]').val(),salary:$('input[name="salary"]').val(),tax:$('input[name="tax"]').val(),hours:$('input[name="hours"]').val()},function(e){e.left_count>=0&&($(t).find("span").removeClass("fa-spin"),$(t).attr("action")?($(t).parent().find(".tBody").append(e.content),$(t).attr("page",parseInt($(t).attr("page"))+1)):$(".userList").append(e.content),e.left_count||$(t).addClass("hdn"),$("#page").checkbox(),$("#page").radio(),e.total&&$("#total").length&&$("#total").html((parseFloat($("#total").text())+parseFloat(e.total)).toFixed(2)),doload=!1)},"json")},Settings={delFranchise:function(t){$.post("/settings/delFranchise",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Client was successfully deleted",delay:2}),$("#client_"+t).addClass("deleted").find(".uMore li:last-child").remove()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendFranchise:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t).serializeArray(),l=null;n.append("id",a);for(var o=0;o<s.length;o++){if("email"==s[o].name){if(!s[o].value.length||!is_valid.email(s[o].value)){l=s[o].value.length?lang[2]:lang[3];break}}else if("name"==s[o].name){if(!s[o].value.length){l="Name can not be empty";break}}else if("timezone"==s[o].name){if(!s[o].value.length){l="Timezone can not be empty";break}}else if("ip"==s[o].name){if(!s[o].value.length){l="IP can not be empty";break}}else if("contract"==s[o].name&&!s[o].value.length){l="Contract can not be empty";break}n.append(s[o].name,s[o].value)}var c="",i=0;if($(".sPhone").each(function(t,e){if($(e).find("input").css("border","1px solid #ddd"),$(e).find("select").val()||$(e).find("input").val()){if(0==$(e).find('[name="phoneCode"]').val()||!$(e).find('[name="code"]').val()||!$(e).find('[name="part1"]').val())return $(e).find("input").css("border","1px solid #f00"),l="Please, check phone number",!1;c.length>0&&(c+=","),c+=$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()+" "+$(e).find('[name="part2"]').val(),1==$(e).find('[name="sms"]').val()&&(n.append("sms",$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()),i=1)}}),c.length?n.append("phone",c):l||(l="Phone can not be empty"),l)return alr.show({class:"alrDanger",content:l,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));$.ajax({type:"POST",processData:!1,contentType:!1,url:"/settings/sendFranchise",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),parseInt(t)>0?(alr.show({class:"alrSuccess",content:"Client was successfully "+(a?"saved":"added"),delay:2}),Page.get("/settings/franchise/edit/"+t)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendRefDiscounts:function(t,e){e.preventDefault();var a={},n=[],s=null;$(".refPoints").each(function(t,e){$.inArray($(e).find('input[name="ref"]').val(),n)<0?(n[t]=$(e).find('input[name="ref"]').val(),a[t]={ref:$(e).find('input[name="ref"]').val(),discount:$(e).find('input[name="discount"]').val()}):s="You enter discount amount for "+$(e).find('input[name="ref"]').val()+" refferals twice"}),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/settings/send_ref_discounts",a,function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Discounts were successfully sent",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addRefDicount:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Minial refferals"})}).append($("<input/>",{type:"number",name:"ref"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Discount %"})}).append($("<input/>",{type:"number",name:"discount"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},sendRef:function(t,e){e.preventDefault();var a={},n=[],s=null;$(".refPoints").each(function(t,e){$.inArray($(e).find('input[name="min_ref"]').val(),n)<0?(n[t]=$(e).find('input[name="min_ref"]').val(),a[t]={min_ref:$(e).find('input[name="min_ref"]').val(),points:$(e).find('input[name="points"]').val()}):s="You enter points amount for "+$(e).find('input[name="min_ref"]').val()+" refferals twice"}),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/settings/send_ref_points",a,function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Points were successfully sent",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addRefPoints:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Minial refferals"})}).append($("<input/>",{type:"number",name:"min_ref"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Points"})}).append($("<input/>",{type:"number",name:"points"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},addCurrency:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"name"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Symbol"})}).append($("<input/>",{type:"text",name:"symbol"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},addEmail:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Login"})}).append($("<input/>",{type:"text",name:"login"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Password"})}).append($("<input/>",{type:"password",name:"password"}))).append($("<div/>",{class:"sSide rSide",html:$("<label/>",{html:"Default"})}).append($("<input/>",{type:"checkbox",name:"default",onchange:"Settings.defaultEmail(this);"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"}))),$('input[name="checkbox"]').checkbox()},sendCurrency:function(t,e){e.preventDefault();var a={},n=[],s=null;$(".refPoints").each(function(t,e){$.inArray($(e).find('input[name="name"]').val(),n)<0?(n[t]=$(e).find('input[name="name"]').val(),a[t]={name:$(e).find('input[name="name"]').val(),symbol:$(e).find('input[name="symbol"]').val()}):s="You enter the same currency twice"}),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/settings/send_currency",a,function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Currency was successfully sent",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},defaultEmail:function(t,e){1==$(t).val()&&($('input[name="default"][value="1"]').attr("onchange","").val(0).trigger("click"),$(t).val(1).trigger("click"),$('input[name="default"]').attr("onchange","Settings.defaultEmail(this);"))},sendEmails:function(t,e){e.preventDefault();var a={},n=[],s=null;$(".optGroup").each(function(t,e){$(e).find('input[name="login"]').val()&&$(e).find('input[name="password"]').val()&&($.inArray($(e).find('input[name="login"]').val(),n)<0?(n[t]=$(e).find('input[name="login"]').val(),a[t]={login:$(e).find('input[name="login"]').val(),password:$(e).find('input[name="password"]').val(),default:$(e).find('input[name="default"]').val()}):s="You enter the same email twice")}),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/settings/send_emails",a,function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Emails was successfully sent",delay:2}):"no_def"==t?alr.show({class:"alrDanger",content:"Set default email, please",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendFormula:function(t,e){e.preventDefault();var a={},n=[],s=null;$(".refPoints").each(function(t,e){$.inArray($(e).find('input[name="min_price"]').val(),n)<0?(n[t]=$(e).find('input[name="min_price"]').val(),a[t]={min_price:$(e).find('input[name="min_price"]').val(),mark_up:$(e).find('input[name="mark-up"]').val()}):s="You enter mark-up amount for "+$(e).find('input[name="min_price"]').val()+" refferals twice"}),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/settings/send_price_formula",a,function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Mark-up was successfully sent",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addFormula:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Minial refferals"})}).append($("<input/>",{type:"number",step:"0.001",name:"min_price"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Mark-up"})}).append($("<input/>",{type:"number",step:"0.001",name:"mark-up"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},openRefferal:function(t,e){mdl.open({id:"editGroup",width:500,title:lang[153],content:'<div class="iGroup"><label>'+lang[154]+':</label><input type="text" name="refName" value="'+(e||"")+'"></div>\t\t\t\t\t<div class="sGroup"><button class="btn btnSubmit" type="submit" onclick="Settings.sendRefferal('+t+');"><span class="fa fa-save"></span> '+(t?lang[42]:lang[91])+"</button></div>"})},sendRefferal:function(t){var e={id:t};$('input[name="refName"]').val().length?(e.name=$('input[name="refName"]').val(),$.post("/settings/send_refferal",e,function(t){"OK"==t?(alr.show({class:"alrSuccess",content:lang[155],delay:2}),mdl.close("editGroup"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})):alr.show({class:"alrDanger",content:lang[16],delay:2})},delRefferal:function(t){$.post("/settings/del_refferal",{id:t},function(e){"OK"==e?$("#refferal_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},privileges:function(t){$('[name^="privileges"]').each(function(e,a){$(a).attr("name",a.name.replace(/privileges\[(\w+)\]\[(\w+)\]/g,function(e,a){return e.replace(a,t)}))}),$.post("/settings/privileges",{group:t},function(e){$.each(e,function(e,a){var n=$('[name="privileges['+t+"]["+e+']"]');n.find("option").prop("selected",!1).trigger("change"),$.isArray(a)?$.each(a,function(t,e){n.find('option[value="'+e+'"]').prop("selected",!0).trigger("change")}):"checkbox"==n.attr("type")?n.prop("checked",1==a).val(a):n.find('option[value="'+a+'"]').prop("selected",!0).trigger("change")})},"json")},save:function(t,e){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));for(var a={},n=$(t).find("[name]"),s=0;s<n.length;s++)a[n[s].name]=$(n[s]).val();console.log(a),$.post("/settings/save",a,function(t){if(loadBtn.stop($(e.target).find('button[type="submit"]')),"OK"==t)alr.show({class:"alrSuccess",content:lang[1],delay:2});else if("RELOAD"==t){alr.show({class:"alrSuccess",content:lang[1],delay:2});setTimeout(function(){location.reload()},2e3)}})},saveSMS:function(t,e){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));for(var a={},n=$(t).find("[name]"),s=0;s<n.length;s++)a[n[s].name]=$(n[s]).val();console.log(a),$.post("/settings/save_sms",a,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"OK"==t&&alr.show({class:"alrSuccess",content:lang[1],delay:2})})},tab:function(t,e){location.hash=t+(e?"#"+e:""),$(".uForm > .tab").hide(),$('.uForm > .tab[id="'+t+'"]').show(),$("#stitle").text(t),location.hash.match(/Groups/)?$(".btnAddGr").show():$(".btnAddGr").hide(),"general"!=t&&$("#"+t).html('<div class="spnCtnr"><span class="fa fa-cog fa-spin fa-3x fa-fw"></span></div>').load(location.pathname+"/"+t.toLocaleLowerCase(),Page.init)},addGroup:function(t,e,a,n,s,l){mdl.open({id:"editGroup",width:500,title:lang[144],content:'<div class="iGroup"><label>Group name:</label><input type="text" name="grName" value="'+(e||"")+'"></div>\t\t\t\t\t<div class="iGroup"><label>Paying per hour:</label><input type="checkbox" name="pay" '+(1==a?"checked":"")+'></div>\t\t\t\t\t<div class="iGroup"><label>Timer:</label><input type="checkbox" name="timer" '+(1==n?"checked":"")+'></div>\t\t\t\t\t<div class="iGroup"><label>Rating:</label><input type="checkbox" name="rating" '+(1==l?"checked":"")+'></div>\t\t\t\t\t<div class="iGroup"><label>Week hours:</label><input type="number" step="0.001" name="week_hours" value="'+s+'"></div>\t\t\t\t\t<div class="sGroup"><button class="btn btnSubmit" type="submit" onclick="Settings.sendGroup('+t+');"><span class="fa fa-save"></span> '+(t?lang[42]:lang[91])+"</button></div>",cb:function(){$("#page").checkbox()}})},sendGroup:function(t){var e={id:t};$('input[name="grName"]').val().length?(e.name=$('input[name="grName"]').val(),e.pay=$('input[name="pay"]').val(),e.timer=$('input[name="timer"]').val(),e.rating=$('input[name="rating"]').val(),e.week_hours=$('input[name="week_hours"]').val(),$.post("/settings/add_group",e,function(t){"OK"==t?(alr.show({class:"alrSuccess",content:lang[143],delay:2}),mdl.close("editGroup"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})):alr.show({class:"alrDanger",content:lang[16],delay:2})},delGroup:function(t){$.post("/settings/del_group",{id:t},function(e){"OK"==e?$("#group_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendForm:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a},s=null;if($.each($(t).find("[name]"),function(){if(["INPUT","SELECT","TEXTAREA"].indexOf(this.tagName)>=0){var t=$(this).val();if(!t)return s=this.name+" "+lang[142],!1;n[this.name]=t}}),s)return alr.show({class:"alrDanger",content:s,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));$.post("/settings/save_form",n,function(t){t&&Page.get("/settings/forms/edit/"+t),loadBtn.stop($(e.target).find('button[type="submit"]'))})},delForm:function(t){$.post("/settings/del_form",{id:t},function(e){"OK"==e?$("#form_"+t).remove():"no_del"==e?alr.show({class:"alrDanger",content:"You can not delete this form",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendPoints:function(t,e){e.preventDefault(),$.post("/settings/save_points",$(t).serializeArray(),function(t){"OK"==t?Page.get("/settings/points"):alr.show({class:"alrShow",content:lang[13],delay:2})})}},webcam={width:470,height:0,streaming:!1,video:null,canvas:null,photo:null,startbutton:null,startup:function(){webcam.video=document.getElementById("video"),webcam.canvas=document.getElementById("canvas"),webcam.photo=document.getElementById("photo"),webcam.startbutton=document.getElementById("startbutton"),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(t){if(navigator.mozGetUserMedia)webcam.video.mozSrcObject=t;else{var e=window.URL||window.webkitURL;webcam.video.src=e.createObjectURL(t)}webcam.video.play()},function(t){console.log("An error occured! "+t)}),webcam.video.addEventListener("canplay",function(t){webcam.streaming||(webcam.height=webcam.video.videoHeight/(webcam.video.videoWidth/webcam.width),isNaN(webcam.height)&&(webcam.height=webcam.width/(4/3)),webcam.video.setAttribute("width",webcam.width),webcam.video.setAttribute("height",webcam.height),webcam.canvas.setAttribute("width",webcam.width),webcam.canvas.setAttribute("height",webcam.height),webcam.streaming=!0)},!1),webcam.startbutton.addEventListener("click",function(t){webcam.takepicture(),t.preventDefault()},!1),webcam.clearphoto()},clearphoto:function(){var t=webcam.canvas.getContext("2d");t.fillStyle="#AAA",t.fillRect(0,0,webcam.canvas.width,webcam.canvas.height);var e=webcam.canvas.toDataURL("image/png");webcam.photo.setAttribute("src",e)},takepicture:function(){var t=webcam.canvas.getContext("2d");if(webcam.width&&webcam.height){webcam.canvas.width=webcam.width,webcam.canvas.height=webcam.height,t.drawImage(webcam.video,0,0,webcam.width,webcam.height);var e=webcam.canvas.toDataURL("image/png");webcam.photo.setAttribute("class",""),webcam.photo.setAttribute("src",e)}else webcam.clearphoto()}},user={concat_id:function(t,e,a){$.post("/users/concat",{ids:t+","+e,main:e},function(t){"OK"==t?$(a).parent().parent().remove():alr.show({class:"alrDanger",content:lang[13],delay:2})})},concat:function(t,e){var a=[],n="",s=null;$(t).parent().parent().find(".dublicate").each(function(){$(this).hasClass("none")||a.push($(this).attr("data-id"))}),a.indexOf($('input[name="dublicates['+e+']"]:checked').val())>=0&&(n=$('input[name="dublicates['+e+']"]:checked').val()),n.length?a.length<2&&(s="No profiles for concatenating"):s="Select main profile",s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/users/concat",{ids:a,main:n},function(e){"OK"==e?$(t).parent().parent().addClass("done").find(".dub-button").remove():alr.show({class:"alrDanger",content:lang[13],delay:2})})},dontConcat:function(t){$(t).parent().parent().toggleClass("none")},dublicateType:function(t){page=0,$.post("/users/dublicates",{page:0,type:t},function(t){$(".userList.noTbl").html(t.content),$("#page").radio()},"json")},spage:0,confirmApp:function(t,e,a){$.post("/users/confirm_app",{id:e,type:a},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Appointment was successfully "+(a?"confirmed":"diclined"),delay:2}),$(t).parent().remove()):"NO_ACC"==e?alr.show({class:"alrDanger",content:"You have no access to this action",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addApp:function(t,e,a){e.preventDefault(),loadBtn.start($(t).find("button"));var n={user_id:a},s=null;$('input[name="sdate"]').val()?$('input[name="time"]').val()?Object.keys($('input[name="object"]').data())[0]?new Date($('input[name="sdate"]').val()+" "+$('input[name="time"]').val())<new Date?s="Date can not be less from today's date":(n.date=$('input[name="sdate"]').val(),n.time=$('input[name="time"]').val(),n.object=Object.keys($('input[name="object"]').data())[0]):s="Select store":s="Enter time":s="Enter date",s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t).find("button"))):$.post("/users/send_app",n,function(e){loadBtn.stop($(t).find("button")),"OK"==e?(alr.show({class:"alrSuccess",content:"Appointment was successfully added",delay:2}),Page.get("/users/view/"+a)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},makeSuspention:function(t){$.post("/users/is_suspention",{id:t},function(e){"OK"==e.res?mdl.open({id:"makeSuspention",title:"Make suspention",content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Suspention"})}).append($("<select/>",{name:"suspention",html:e.suspentions}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Comment"})}).append($("<textarea/>",{name:"comment"}))).append(e.third?$("<div/>",{class:"sumCash",html:"This is third write up. User will get suspention"}):"").append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"user.sendSuspention(this, "+t+", "+e.third+")",html:"Send"})})),cb:function(){$("#page").select()}}):"no_acc"==e?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},sendSuspention:function(t,e,a){$.post("/users/send_suspention",{id:e,suspention:$('select[name="suspention"]').val(),comment:$('textarea[name="comment"]').val(),third:a},function(t){loadBtn.stop($(this)),t?"no_acc"==t?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):(alr.show({class:"alrSuccess",content:"You suspention was successfully sent",delay:2}),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},openWriteup:function(t,e){mdl.open({id:"openStatus",title:(t?"Edit":"Open")+" write up",content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"user.sendWriteup(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendWriteup:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/users/send_writeup",n,function(t){loadBtn.stop($(this)),t?"no_acc"==t?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delWriteup:function(t){t?$.post("/users/del_writeup",{id:t},function(e){"OK"==e?$("#writeup_"+t).remove():"no_acc"==e?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},dashConfirmOnsite:function(t){$.post("/users/dash_confirm_onsite",{id:t},function(e){parseInt(e)>0?(alr.show({class:"alrSuccess",content:"The service was successfully confirmed",delay:2}),$("#onsite_unconf_"+t).remove(),invoices.send_mail(e)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},dashDeleteOnsite:function(t){$.post("/users/del_onsite",{id:t,dash:1},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"The service was successfully deleted",delay:2}),$("#onsite_unconf_"+t).remove()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendEditOnsite:function(t,e){$.post("/users/onsite_update_date",{id:t,date_end:$('input[name="date_end"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Onsite service was successfully updated",delay:2}),Page.get(location.href),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},editOnsite:function(t){date=$("#onsite_"+t+" .dateEnd").html(),date.indexOf("inf")?date="":date=date.split("-"),mdl.open({id:"editOnsite",title:"On site service",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw dGroup",html:$("<label/>",{html:"End date"})}).append($("<input/>",{type:"text",class:"cl",name:"date_end",onclick:"closeCalendar(); $(this).next().show().parent().addClass('act');"})).append($("<div/>",{id:"calendar","data-year":date[0]||"","data-month":date[1]||"","data-day":date[2]||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"user.sendEditOnsite("+t+", this);",html:"Done"})})),cb:function(){$("#calendar").calendar(function(){$('input[name="date_end"]').val($('#calendar > input[name="date"]').val()),$(".dGroup > input + div").hide().parent().removeClass("act")})}})},sendUpdateStaff:function(t,e){$.post("/users/onsite_update_staff",{id:t,staff:Object.keys($('input[name="staff"]').data()).join(","),time:$('input[name="time"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Onsite service was successfully updated",delay:2}),Page.get(location.href),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},updateOnsiteStaff:function(t){$.post("/users/onsite_info",{id:t},function(e){e.id==t?$.post("/users/all",{staff:1},function(a){var n="",s=0;a.list&&$.each(a.list,function(t,e){n+='<li data-value="'+e.id+'">'+e.name+"</li>",s=e.id}),mdl.open({id:"addOnsite",title:"On site service",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Time"})}).append($("<input/>",{type:"time",name:"time"}))}).append($("<div/>",{class:"iGroup fw",id:"staff",html:$("<label/>",{html:"Staff"})}).append($("<input/>",{type:"hidden",name:"staff"})).append($("<ul/>",{class:"hdn",html:n}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"user.sendUpdateStaff("+t+", this);",html:"Done"})})),cb:function(){var t={};e.selected_staff_id>0&&(t[e.selected_staff_id]={name:e.name+" "+e.lastname}),$("#staff > ul").html(n).sForm({action:"/users/all",data:{lId:s,query:$("#staff > .sfWrap input").val()||"",staff:1},all:!1,select:t,s:!0,link:"users/view"},$('input[name="staff"]'))}})},"json"):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delOnsite:function(t){$.post("/users/del_onsite",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Onsite service was successfully deleted",delay:2}),$("#onsite_"+t).addClass("deleted").find(".uMore").html(""),$("#onsite_"+t).find(".os_right").html("")):alr.show({class:"alrDanger",content:lang[13],delay:2})})},onsiteStats:function(t){user.spage=0,$.post("/users/onsite_stats",{id:t},function(e){mdl.open({id:"onsiteStats",title:"Statictic",width:600,content:$("<div/>",{html:$("<div/>",{class:"stats",html:e.content})}).append($("<button/>",{class:"btn btnLoad"+(e.left_count>0?"":" hdn"),onclick:"user.doloadStats(this,"+t+");",html:"Load statistic"}))})},"json")},doloadStats:function(t,e){user.spage+=1,$.post("/users/onsite_stats",{id:e,page:user.spage},function(e){$(".stats").append(e.content),e.left_count||$(t).addClass("hdn")},"json")},delNote:function(t){$.post("/users/del_note",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Note was successfully deleted",delay:2}),$("#note_"+t).remove()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addNote:function(t,e){loadBtn.start($(e));var a={id:t};$('textarea[name="note"]').css("border-color","#ddd"),$('textarea[name="note"]').val()?(a.note=$('textarea[name="note"]').val(),$.post("/users/send_note",a,function(t){loadBtn.stop($(e)),"OK"==t?(alr.show({class:"alrSuccess",content:lang[77],delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})):($('textarea[name="note"]').css("border-color","#f00"),alr.show({class:"alrDanger",content:lang[78],delay:2}),loadBtn.stop($(e)))},createInvoice:function(t){mdl.open({id:"onsiteInvoice",title:"Service price",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Price for additional time"})}).append($("<input/>",{type:"number",name:"onsite_price",step:"0.001",min:0}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"user.sendOnsiteInvoice("+t+");",html:"Send"})}))})},sendOnsiteInvoice:function(t){$.post("/invoices/send_onsite",{id:t},function(t){t>0?(alr.show({class:"alrSuccess",content:"Invoice was successfully created",delay:2}),Page.get("/invoices/edit/"+t),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},playOnsite:function(t,e,a){mdl.open({id:"playService",title:"Choose store",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",id:"store",html:$("<label/>",{html:"Store"})}).append($("<input/>",{type:"hidden",name:"store"})).append($("<ul/>",{class:"hdn"}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Service type"})}).append($("<select/>",{name:"service_type",html:$("<option/>",{value:"call",html:lang[173]})}).append($("<option/>",{value:"time",html:lang[174]})))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Note"})}).append($("<textarea/>",{name:"onsite_note"}))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Message for user"})}).append($("<textarea/>",{name:"user_message"}))).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"user.updateOnsite("+t+", '"+e+"', "+a+");",html:"Done"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"Cancel"}))),cb:function(){1==$("#onsite_"+t).attr("data-calls")?$('select[name="service_type"]').find('option[value="call"]').attr("selected","selected"):1==$("#onsite_"+t).attr("data-time")&&$('select[name="service_type"]').find('option[value="time"]').attr("selected","selected"),$("select").select(),$.post("/users/objects",{},function(t){if(t){var e="",a=0;if($.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-tax="'+n.tax+'">'+n.name+"</li>",a=n.id}),t.list.length>1)$("#store > ul").html(e).sForm({action:"/users/objects",data:{lId:a,query:$("#store > .sfWrap input").val()||""},all:!1,select:$('input[name="store"]').data(),s:!0,link:"objects/edit"},$('input[name="store"]'));else if(1==t.list.length){var n={};n[t.list[0].id]={name:t.list[0].name},$('input[name="store"]').data(n),$("#store").append($("<div/>",{class:"storeOne",html:t.list[0].name}))}}},"json")}})},updateOnsiteNote:function(t,e,a){mdl.open({id:"playService",title:"Add note",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Note"})}).append($("<textarea/>",{name:"onsite_note"}))}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"user.updateOnsite("+t+", '"+e+"', "+a+");",html:"Done"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"Cancel"})))})},updateOnsite:function(t,e,a){var n=0;"play"!=e||Object.keys($('input[name="store"]').data()).join(",").length?("play"==e&&(n=Object.keys($('input[name="store"]').data()).join(",")),$.post("/users/update_onsite",{id:t,action:e,onsite:a,store:n,note:$('textarea[name="onsite_note"]').val(),user_message:$('textarea[name="user_message"]').val(),service_type:$('select[name="service_type"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Status Updated",delay:2}),Page.get(location.href),mdl.close()):"no_store"==t?alr.show({class:"alrDanger",content:"Please, select store",delay:2}):"done"==t?alr.show({class:"alrDanger",content:"This service is already "+("stop"==e?"stopped":"play"==e?"played":"paused")+". Please, reload page and try again",delay:2}):"complited"==t?alr.show({class:"alrDanger",content:"This service is already complited",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})):alr.show({class:"alrDanger",content:"Please, select store",delay:2})},addOnsite:function(t){$.post("/users/all",{staff:1},function(e){var a="",n=0;e.list&&$.each(e.list,function(t,e){a+='<li data-value="'+e.id+'">'+e.name+"</li>",n=e.id}),$.post("/users/objects",{},function(e){var s="",l=0;e.list&&$.each(e.list,function(t,e){s+='<li data-value="'+e.id+'">'+e.name+"</li>",l=e.id}),mdl.open({id:"addOnsite",title:"On site service",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw price",id:"object",html:$("<label/>",{html:"Store"})}).append($("<input/>",{type:"hidden",name:"object"})).append($("<ul/>",{class:"hdn",html:s}))}).append($("<div/>",{class:"iGroup fw price",id:"service",html:$("<label/>",{html:"Service"})}).append($("<input/>",{type:"hidden",name:"service"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup fw dGroup ",html:$("<label/>",{html:"Start date"})}).append($("<input/>",{type:"text",class:"cl",name:"date_start",onclick:"closeCalendar(); $(this).next().show().parent().addClass('act');"})).append($("<div/>",{id:"sCalendar"}))).append($("<div/>",{class:"iGroup fw dGroup ",html:$("<label/>",{html:"End date"})}).append($("<input/>",{type:"text",class:"cl",name:"date_end",onclick:"closeCalendar(); $(this).next().show().parent().addClass('act');"})).append($("<div/>",{id:"eCalendar"}))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Time"})}).append($("<input/>",{type:"time",name:"time"}))).append($("<div/>",{class:"iGroup fw",id:"staff",html:$("<label/>",{html:"Staff"})}).append($("<input/>",{type:"hidden",name:"staff"})).append($("<ul/>",{class:"hdn",html:a}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"user.sendService(this, "+t+");",html:"Done"})})),cb:function(){$("#sCalendar").calendar(function(){$('input[name="date_start"]').val($('#sCalendar > input[name="date"]').val()),$(".dGroup > input + div").hide().parent().removeClass("act")}),$("#eCalendar").calendar(function(){$('input[name="date_end"]').val($('#eCalendar > input[name="date"]').val()),$(".dGroup > input + div").hide().parent().removeClass("act")}),$(".uForm").on("click",function(t){$(t.target).hasClass("cl")||(console.log($(t.target).hasClass("cl")),$(".calendar").hide().parents(".iGroup").removeClass("act"))}),$("#object > ul").html(s).sForm({action:"/users/objects",data:{lId:l,query:$("#object > .sfWrap input").val()||""},all:!1,select:$('input[name="object"]').data(),s:!0,link:"objects/edit"},$('input[name="object"]'),user.getOnsite),user.getOnsite(),$("#staff > ul").html(a).sForm({action:"/users/all",data:{lId:n,query:$("#staff > .sfWrap input").val()||"",staff:1},all:!1,select:$('input[name="staff"]').data(),s:!0,link:"users/view"},$('input[name="staff"]'))}})},"json")},"json")},getOnsite:function(){$.post("/inventory/AllOnsite",{oId:Object.keys($('input[name="object"]').data()||{}).join(",")},function(t){var e="",a=0;t.list&&($.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'">'+n.name+"</li>",a=n.id}),$("#service > .sfWrap").length&&($('input[name="service"]').removeData(),$("#service > .sfWrap").remove(),$("#service").append($("<ul/>",{class:"hdn"}))),$("#service > ul").html(e).sForm({action:"/inventory/AllOnsite",data:{lId:a,oId:Object.keys($('input[name="object"]').data()||{}).join(","),query:$("#service > .sfWrap input").val()||""},all:!1,select:$('input[name="service"]').data(),s:!0,link:"inventory/onsite/edit"},$('input[name="service"]')))},"json")},sendService:function(t,e){loadBtn.start($(t));var a={id:e,date_start:$('input[name="date_start"]').val(),date_end:$('input[name="date_end"]').val(),time:$('input[name="time"]').val(),staff:Object.keys($('input[name="staff"]').data()).join(",")},n=null;Object.keys($('input[name="service"]').data()).join(",")?a.service=Object.keys($('input[name="service"]').data()).join(","):n="Please, choose service",Object.keys($('input[name="object"]').data()).join(",")?a.object=Object.keys($('input[name="object"]').data()).join(","):n="Please, choose object",n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):$.post("/users/send_service",a,function(e){loadBtn.stop($(t)),parseInt(e)>0?(alr.show({class:"alrSuccess",content:"The service was successfully added",delay:2}),Page.get(location.href),mdl.close(),invoices.send_mail(e)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},webPhoto:function(){mdl.open({id:"webPhoto",title:"Make webcam capture",content:$("<div/>",{html:$("<div/>",{class:"camera",html:$("<video/>",{id:"video"})}).append($("<div/>",{class:"aCenter",html:$("<button/>",{id:"startbutton",class:"btn btnWeb",type:"button",html:"Make capture"})})).append($("<img/>",{id:"photo",class:"hdn"}))}).append($("<canvas/>",{id:"canvas"})).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"user.accPhoto()",html:"Use photo"})})),cb:webcam.startup})},accPhoto:function(){$(".imgGroup > figure > img").attr("src",$("#photo").attr("src")).attr("new",1),$("dropdown").val(""),mdl.close()},newUsr:function(){mdl.open({id:"newUser",title:"New User",content:'<form class="uForm" method="post" onsubmit="user.addShort(this, event);">\t\t\t\t<input type="hidden" name="group_id[]" value="5">\t\t\t\t<div class="iGroup usr">\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t<input type="text" name="name">\t\t\t\t</div>\t\t\t\t<div class="iGroup usr">\t\t\t\t\t<label>'+lang[161]+'</label>\t\t\t\t\t<input type="text" name="lastname">\t\t\t\t</div>\t\t\t\t<div class="iGroup">\t\t\t\t\t<label>'+lang[162]+'</label>\t\t\t\t\t<input type="text" name="zipcode">\t\t\t\t</div>\t\t\t\t<div class="iGroup">\t\t\t\t\t<label>'+lang[163]+'</label>\t\t\t\t\t<input type="email" name="email">\t\t\t\t</div>\t\t\t\t<div class="iGroup">\t\t\t\t\t<label>'+lang[164]+'</label>\t\t\t\t\t<input type="text" name="phone">\t\t\t\t</div>\t\t\t\t<div class="sGroup">\t\t\t\t\t<button class="btn btnSubmit" type="submit"><span class="fa fa-save"></span> '+lang[28]+"</button>\t\t\t\t</div>\t\t\t</form>"})},addShort:function(t,e){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));for(var a=new FormData,n=$(t).serializeArray(),s=null,l=0;l<n.length;l++){if("email"==n[l].name){if(!n[l].value.length||!is_valid.email(n[l].value)){s=n[l].value.length?lang[2]:lang[3];break}}else if("phone"==n[l].name){if(!n[l].value.length||!is_valid.phone(n[l].value)){s=n[l].value.length?lang[4]:lang[5];break}}else if(!("name"!=n[l].name&&"lastname"!=n[l].name||$(t).find('input[name="company"]').val()||is_valid.name(n[l].value)&&is_valid.name(n[l].value))){s=lang[6];break}a.append(n[l].name,n[l].value)}if(s)return alr.show({class:"alrDanger",content:s,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));$.ajax({type:"POST",processData:!1,contentType:!1,url:"/users/send",data:a}).done(function(a){if(loadBtn.stop($(e.target).find('button[type="submit"]')),a>0){mdl.close(),alr.show({class:"alrSuccess",content:lang[8],delay:2});var n={};n[a]={name:$(t).find('input[name="name"]').val()+" "+$(t).find('input[name="lastname"]').val()},$('input[name="contact"]').data(n),$("#contact .sfWrap > div").length&&$("#contact .sfWrap > div").find("i").triger("click"),$("#contact .sfWrap > div").prepend($("<span/>",{class:"nc",id:a,html:$(t).find('input[name="name"]').val()+" "+$(t).find('input[name="lastname"]').val()}).append($("<i/>")))}else"err_email"==a?alr.show({class:"alrDanger",content:lang[165],delay:2}):"Name_not_valid"==a?alr.show({class:"alrDanger",content:"Name is incorrect",delay:2}):"Lastname_not_valid"==a?alr.show({class:"alrDanger",content:"Lastname is incorrect",delay:2}):"err_login"==a?alr.show({class:"alrDanger",content:"Login can not be empty",delay:2}):"err_image_type"==a?alr.show({class:"alrDanger",content:"Image type is incorrect",delay:2}):"err_file_size"==a?alr.show({class:"alrDanger",content:"File is too large",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},comSelect:function(t){0!=$(t).val()?(console.log(t),$(".com").show(),$(".usr").hide()):($(".com").hide(),$(".usr").show())},add:function(t,e,a,n,s){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var l=new FormData,o=$(t).serializeArray(),c=null;l.append("id",a);for(var i=0;i<o.length;i++){if("email"==o[i].name){if(!o[i].value.length||!is_valid.email(o[i].value)){c=o[i].value.length?lang[2]:lang[3];break}}else if("name"==o[i].name&&0==$(t).find('input[name="company"]').val()){if(!is_valid.name(o[i].value)||!o[i].value.length){c=lang[6];break}}else if("lastname"==o[i].name&&0==$(t).find('input[name="company"]').val()){if(!is_valid.name(o[i].value)||!o[i].value.length){c="Lastname can not be empty";break}}else if("cname"==o[i].name&&1==$('input[name="company"]').val()){if(!o[i].value.length){c="company name can not be empty";break}}else if("password"==o[i].name){if(o[i].value.length>0&&o[i].value!=$('input[name="password2"]').val()){c=lang[7];break}}else if("referral"==o[i].name&&0==o[i].value){c="Please, choose referal";break}$.inArray(o[i].name,["country","state","city","contact"])>=0?l.append(o[i].name,Object.keys($('input[name="'+o[i].name+'"]').data()).join(",")):l.append(o[i].name,o[i].value.trim())}var r="",d=0;if($(".sPhone").each(function(t,e){if($(e).find("input").css("border","1px solid #ddd"),$(e).find("select").val()||$(e).find("input").val()){if(0==$(e).find('[name="phoneCode"]').val()||!$(e).find('[name="code"]').val()||!$(e).find('[name="part1"]').val())return $(e).find("input").css("border","1px solid #f00"),c="Please, check phone number",!1;r.length>0&&(r+=","),r+=$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()+" "+$(e).find('[name="part2"]').val(),1==$(e).find('[name="sms"]').val()&&(l.append("sms",$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()),d=1)}}),r.length?(l.append("phone",r),console.log(r)):c||(c="Phone can not be empty"),d||l.append("sms",""),$(".dragndrop").length){var p=$(".dragndrop")[0].files;if(!$.isEmptyObject(p))for(var u in p)l.append("image",p[u])}if($(".imgGroup > figure > img").attr("new")){var m=$(".imgGroup > figure > img").attr("src");l.append("image",b64Blob(m.split(",")[1],"image/png")),l.append("blob",1)}if(c)return alr.show({class:"alrDanger",content:c,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));$(".dragndrop").length&&"FIGURE"!=$(".dragndrop").prev()[0].tagName&&a&&l.append("del_image",!0),n&&l.append("steps",n),s&&l.append("app",s),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/users/send",data:l}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0?(alr.show({class:"alrSuccess",content:lang[8],delay:2}),a?location.pathname.match(/\/users\/edit\/(.*)/i)?Page.get("/users/view/"+a):Page.get("/inventory/step/?user="+a):Page.get(n?"/inventory/step/?user="+t:s?"/users/add_appointment/?user="+t:"/users/view/"+t),$(".proUser").attr("id")=="u_"+t&&$("li.user > a > u").html($('input[name="name"]').val().trim()+" "+$('input[name="lastname"]').val().trim())):"err_email"==t?alr.show({class:"alrDanger",content:"Email exists or incorrect",delay:2}):"not_allowed"==t?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},del:function(t){$.post("/users/del",{id:t},function(e){"OK"==e?$("#user_"+t).length?$("#user_"+t).addClass("deleted").find('a[href="javascript:user.del('+t+');"]').attr("href","javascript:user.restore("+t+");").html('<span class="fa fa-times"></span> Restore user'):Page.get(location.href):alr.show({class:"alrDanger",content:lang[9],delay:2})})},restore:function(t){$.post("/users/restore",{id:t},function(e){"OK"==e?$("#user_"+t).length?$("#user_"+t).removeClass("deleted").find('a[href="javascript:user.restore('+t+');"]').attr("href","javascript:user.del("+t+");").html('<span class="fa fa-times"></span>  Delete user'):Page.get(location.href):alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendDetails:function(t,e){e.preventDefault(),$('textarea[name="emails"]').val()?(loadBtn.start($(e.target).find('button[type="submit"]')),$.post("/users/sendDetails",{data:$('textarea[name="emails"]').val()},function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"OK"==t?alr.show({class:"alrSuccess",content:lang[140],delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})):alr.show({class:"alrDanger",content:lang[141],delay:2})}},objects={addFormula:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Min price"})}).append($("<input/>",{type:"number",step:"0.001",name:"min_price"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Upcharge price"})}).append($("<input/>",{type:"number",step:"0.001",name:"mark-up"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},addExpanses:function(t){$(t).parent().before($("<div/>",{class:"iGroup optGroup refPoints",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"ex_name"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:"Value"})}).append($("<input/>",{type:"number",name:"ex_value",step:"0.001"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},add:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t).serializeArray(),l=null;n.append("id",a);for(var o=0;o<s.length;o++){if("email"==s[o].name){if(!s[o].value.length||!is_valid.email(s[o].value)){l=s[o].value.length?lang[2]:lang[3];break}}else if("phone"==s[o].name){if(!s[o].value.length||!is_valid.phone(s[o].value)){l=s[o].value.length?lang[4]:lang[5];break}}else if("name"==s[o].name){if(!s[o].value.length){l=lang[8];break}}else if("work_time_start"==s[o].name||"work_time_end"==s[o].name){if(!s[o].value.length){l="Working time can not be empty";break}}else if("timezone"==s[o].name&&!s[o].value.length){l="Timezone can not be empty";break}n.append(s[o].name,s[o].value)}a&&(n.append("managers",Object.keys($('input[name="managers"]').data()).join(",")),n.append("staff",Object.keys($('input[name="staff"]').data()).join(",")));var c={};$("#expanses .refPoints").length&&$("#expanses .refPoints").each(function(t,e){c[$(e).find('input[name="ex_name"]').val()]=$(e).find('input[name="ex_value"]').val()}),n.append("options",JSON.stringify(c));var i={},r=[];$("#purchase_price .refPoints").length&&$("#purchase_price .refPoints").each(function(t,e){$.inArray($(e).find('input[name="min_price"]').val(),r)<0?(r[t]=$(e).find('input[name="min_price"]').val(),i[$(e).find('input[name="min_price"]').val()]=$(e).find('input[name="mark-up"]').val()):l="You enter mark-up amount for "+$(e).find('input[name="min_price"]').val()+" refferals twice"}),n.append("purchase_price",JSON.stringify(i));var d=$(".dragndrop")[0].files;if(!$.isEmptyObject(d))for(var p in d)n.append("image",d[p]);if(l)return alr.show({class:"alrDanger",content:l,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));"FIGURE"!=$(".dragndrop").prev()[0].tagName&&n.append("del_image",!0),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/objects/send",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),a?Page.get("/objects/"):Page.get("/objects/edit/"+t))})},sel:function(t,e,a,n){$.post("/users/all",{id:t,gId:e,nIds:Object.keys($('input[name="'+n+'"]').data()).join(",")},function(s){s&&(items="",$.each(s.list,function(t,e){items+='<li data-value="'+e.id+'" data-image="'+e.image+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_"+t,title:a,content:'<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t<div class="sGroup"><button class="btn btnMdl" onclick="objects.get(\''+n+"', "+t+');">'+lang[139]+"</button></div>",cb:function(){nIds=[],$("#select_"+t).find("ul").sForm({action:"/users/all",data:{lId:lId,id:t,gId:e,query:$("#select_"+t).find("input").val(),nIds:Object.keys($('input[name="'+n+'"]').data()).join(",")},all:s.count<=20,select:$('input[name="'+n+'"]').data(),link:"users/view"},$('input[name="'+n+'"]'))}}))},"json")},get:function(t,e){mdl.close(),userAppend($("#managers"),$('input[name="managers"]').data()),userAppend($("#staff"),$('input[name="staff"]').data())},del:function(t){$.post("/objects/del",{id:t},function(e){"OK"==e?$("#object_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},rent:function(){$('input[name="rent_cost"]').val().length&&$("#rentTotal").text((parseFloat($('input[name="rent_cost"]').val())+parseFloat($('input[name="rent_cost"]').val()*$('input[name="tax"]').val()/100)).toFixed(2))},openLocation:function(t,e,a,n){mdl.open({id:"openLocation",title:(t?lang[17]:lang[18])+" "+lang[92],content:'<div class="iGroup">\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t</div>\t\t\t\t<div class="iGroup">\t\t\t\t\t<label>Count</label>\t\t\t\t\t<input type="text" name="count" value="'+(n||"")+'">\t\t\t\t</div>\t\t\t\t<div class="sGroup">\t\t\t\t\t<button class="btn btnSubmit" onclick="objects.sendLocation(this, '+(t||0)+", "+(a||0)+')">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t</div>"})},sendLocation:function(t,e,a){var n={id:e},l=null;(t=$(t).parents(".mdlBody")).find("input").css("border-color","#ddd"),loadBtn.start(t.find('button[type="submit"]')),t.find('input[name="name"]').val().length?(n.name=t.find('input[name="name"]').val(),n.object=a,n.count=t.find('input[name="count"]').val()):(l=lang[25],t.find('input[name="name"]').css("border-color","#f00")),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop(s.find('button[type="submit"]'))):$.post("/objects/save_location",n,function(e){loadBtn.stop(t.find('button[type="submit"]')),"OK"==e?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),console.log("fd"),mdl.close("openLocation"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delLocation:function(t){$.post("/objects/del_location",{id:t},function(e){"OK"==e?$("#location_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},report:function(t,e){loadBtn.start($(t));var a={},n=null;$('input[name="date"]').val()||e||(n="Please, choose period"),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):(e||(a.objects=Object.keys($('input[name="object"]').data()).join(","),a.date_start=$('#calendar > input[name="date"]').val(),a.date_finish=$('#calendar > input[name="fDate"]').val()),$.post("/objects/report_result",a,function(e){loadBtn.stop($(t)),e?($("#report").html(e.report).append($("<div/>",{class:"roTotal",html:"Total: "+e.total})),$("#report").next().hasClass("profile-loader")&&$("#report").next().remove()):$("#report").empty(),$("#page").select(),$("#page").tabs()},"json"))},miniReport:function(t,e,a){loadBtn.start($(t));var n={object:a,date_start:$('#calendar > input[name="date"]').val(),date_finish:$('#calendar > input[name="fDate"]').val(),type:e,status:$("#eo_"+a+' select[name="status"]').val()};$.post("/objects/mini_reports",n,function(s){loadBtn.stop($(t)),s&&($("#reps_"+a+" ."+e+("status_issues"==e?"_"+n.status:"")).length?$("#reps_"+a+" ."+e+("status_issues"==e?"_"+n.status:"")).replaceWith(s):$("#reps_"+a).prepend(s))})}},options={dragEl:{},parentEl:{},clickEl:{},add:function(t){var e=new Object,a=["input","number","textarea","checkbox","select"];e=$("<select/>",{name:"type"}).change(function(){"select"==$(this).val()?$(this).parents(".optGroup").append($("<div/>",{class:"selArea",html:$("<div/>",{class:"dClear"})}).append($("<label/>",{html:lang[137]})).append($("<input/>",{type:"checkbox",name:"sMul"})).append($("<div/>",{class:"dClear"})).append($("<div/>",{class:"selOpts",html:$("<label/>",{class:"lTitle",html:lang[136]})})).append($("<div/>",{class:"aRight",html:$("<button/>",{class:"btn atnAo",onclick:"options.addSel(this); return false;",html:lang[135]})}))).checkbox():$(this).parents(".optGroup").find(".selArea")&&$(this).parents(".optGroup").find(".selArea").remove()}),$.each(a,function(t,a){e.append($("<option/>",{value:a,html:lang[a]}))}),$(t).parent().before($("<div/>",{class:"iGroup optGroup",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:lang[134]})}).append($("<input/>",{name:"oName"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:lang[127]})}).append(e)).append($("<div/>",{class:"sSide rSide",html:$("<label/>",{html:lang[133]})}).append($("<input/>",{type:"checkbox",name:"req"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})).prepend($("<span/>",{class:"fa fa-bars",draggable:!0,ondragover:"options.dragover(event)",ondragstart:"options.dragstart(event)",ondragend:"options.dragend(event)",onmousedown:"$(this).parent().addClass('drag');",onmouseup:"$(this).parent().removeClass('drag');"}))),$("#page").select(),$("#page").checkbox()},addSel:function(t){$(t).parents(".selArea").find(".selOpts").append($("<div/>",{class:"dClear",html:$("<div/>",{class:"sSide w100",html:$("<input/>",{name:"opt",placeholder:lang[132]+"..."})})}).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})).prepend($("<span/>",{class:"fa fa-bars opt",draggable:!0,ondragover:"options.dragover(event)",ondragstart:"options.dragstart(event)",ondragend:"options.dragend(event)",onmousedown:"$(this).parent().addClass('drag');",onmouseup:"$(this).parent().removeClass('drag');"})))},dragstart:function(t){return options.clickEl=t.target,options.dragEl=t.target.parentNode,options.parentEl=options.dragEl.parentNode,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",options.dragEl.textContent),!1},dragend:function(t,e){return t.preventDefault(),options.dragEl.classList.remove("drag"),e&&e.apply(t.target),!1},dragover:function(t){t.preventDefault(),t.dataTransfer.dropEffect="move";var e=t.target;e&&e!==options.clickEl&&e.className==options.clickEl.className&&(e.parentNode.nextSibling==options.dragEl?options.parentEl.insertBefore(options.dragEl,e.parentNode):options.parentEl.insertBefore(options.dragEl,e.parentNode.nextSibling))}},inventory={delTransfer:function(t,e){$.post("/inventory/del_transfer",{id:t},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"Transfer was succefully deleted",delay:2}),$("#transfer_"+t).length?($("#transfer_"+t).addClass("deleted"),$(e).parent().remove()):$(e).parents(".uMore").remove()):"no_acc"==a?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},confirmTransferMdl:function(t){mdl.open({id:"transferpopup",title:"Transfer confirmation",content:$("<div/>",{class:"transferConf",html:$("<div/>",{html:lang[167]})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"inventory.confirmTransfer("+t+");",html:"Yes"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"No"})))})},confirmTransfer:function(t){$.post("/inventory/confirm_transfer",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Transfer was succefully confirmed",delay:2}),$("#transfer_"+t).length&&$("#transfer_"+t).removeClass("not-confirmed").addClass("confirmed"),$("#confirm_tr_"+t).remove(),$(".mdl").length&&mdl.close()):"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},confirmTransferRequest:function(t,e){$.post("/inventory/confirm_transfer_request",{id:t},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"Transfer request was succefully confirmed",delay:2}),$("#transfer_"+t).length&&$("#transfer_"+t).removeClass("request"),$(e).parent().remove()):"no_acc"==a?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},transfer:function(t,e,a){e.preventDefault(),loadBtn.start($(t).find('button[type="submit"]'));var n={},s=null;Object.keys($('input[name="from_object"]').data()).join(",")?Object.keys($('input[name="to_object"]').data()).join(",")?Object.keys($('input[name="to_object"]').data()).join(",")==Object.keys($('input[name="from_object"]').data()).join(",")?s="It can not be the same store":a||Object.keys($('input[name="receive_staff"]').data()).join(",")?$('input[name="trIds"]').val()?(n.from_object=Object.keys($('input[name="from_object"]').data()).join(","),n.to_object=Object.keys($('input[name="to_object"]').data()).join(","),n.receive_staff=a?0:Object.keys($('input[name="receive_staff"]').data()).join(","),n.trItems=$('input[name="trIds"]').val(),n.request=a||0):s="You must transfer something!":s="Plese, select staff who will be received inventory":s="Please, select store, witch inventory will be send to":s="Please, select store, witch inventory will be send from",s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t).find('button[type="submit"]'))):$.post("/inventory/make_transfer",n,function(e){loadBtn.stop($(t).find('button[type="submit"]')),"OK"==e?(alr.show({class:"alrSuccess",content:"Inventory was successfully transfered",delay:2}),Page.get("/inventory/transfer")):"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},openStoreStatus:function(t,e){mdl.open({id:"openStoreStatus",title:(t?lang[17]:lang[18])+lang[121],content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.sendStoreStatus(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendStoreStatus:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/inventory/sendStoreStatus",n,function(t){loadBtn.stop($(this)),t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStoreStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delStoreStatus:function(t){t?$.post("/inventory/delStoreStatus",{id:t},function(e){"OK"==e?$("#status_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},ownerPrice:function(t,e,a){$(a).html($("<input/>",{type:"number",name:"ownerPrice_"+t,value:$(a).html().replace(/[^0-9.]/g,""),min:0,step:"0.001",class:"quickEdit",oldvalue:$(a).html().replace(/[^0-9.]/g,""),currency:$(a).html().replace(/[0-9.\s]/g,""),onblur:"inventory.sendOwnerPrice("+t+", '"+e+"', this);"})),$(a).find("input").focus()},sendOwnerPrice:function(t,e,a){$('input[name="ownerPrice_'+t+'"]').val()?$.post("/inventory/owner_price",{id:t,type:e,price:$('input[name="ownerPrice_'+t+'"]').val()},function(t){$(a).parent().html($(a).attr("currency")+("OK"==t?$(a).val():$(a).attr("oldvalue"))),"OK"==t?alr.show({class:"alrSuccess",content:"Price was successfully updated",delay:2}):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):"empty"==t?alr.show({class:"alrDanger",content:"Price can not be 0 or less",delay:2}):alr.show({class:"alrDanger",content:err,delay:2})}):alr.show({class:"alrDanger",content:"Price can not be empty",delay:2})},addUpcharge:function(t,e,a){mdl.open({id:"addUpcharge",title:"Add request",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Price"})}).append($("<input/>",{type:"number",name:"price",step:"0.001",min:"0",value:a||""}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",html:"Send",onclick:"inventory.sendUpcharge(this"+(t?", "+t:"")+");"})}))})},sendUpcharge:function(t,e){loadBtn.start($(t));var a={id:e},n=null;$(t).parents(".uForm").find("input").css("border","1px solid #ddd"),$('input[name="name"]').val()?$('input[name="price"]').val()?(a.name=$('input[name="name"]').val(),a.price=$('input[name="price"]').val()):(n="Please, enter price",$('input[name="price"]').css("border","1px solid #f00")):(n="Please, enter name",$('input[name="name"]').css("border","1px solid #f00")),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):$.post("/inventory/send_upcharge",a,function(a){"forbidden"==a?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):"OK"==a?(Page.get(location.href),mdl.close(),alr.show({class:"alrSuccess",content:"Upcharge service was successfully "+(e?"edited":"added"),delay:2})):alr.show({class:"alrDanger",content:lang[13],delay:2}),loadBtn.stop($(t))})},delUpcharge:function(t){$.post("/inventory/del_upcharge",{id:t},function(e){"OK"==e?$("#upcharge_"+t).remove():"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})})},onsiteForms:function(t,e){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var a={};$(t);a.sms_form=$('textarea[name="sms_form"]').val(),a.email_form=$('textarea[name="email_form"]').val(),$.post("/inventory/send_onsite_forms",a,function(t){"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):"OK"==t?alr.show({class:"alrSuccess",content:"Forms were successfully saved",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))})},delRequest:function(t){$.post("/inventory/del_request",{id:t},function(e){"OK"==e?$("#request_"+t).remove():"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})})},requestConfirm:function(t){$.post("/inventory/confirm_request",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Request successfully confirmed",delay:2}),$("#request_"+t).removeClass("not-confirmed").addClass("confirmed").find(".nIssue > a").remove()):"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},changeRequestType:function(){"service"==$('select[name="type_request"]').val()?$(".typePrice").show():$(".typePrice").hide().find("input").val(0)},addRequest:function(t,e,a,n){mdl.open({id:"addRequest",title:"Add request",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Type"})}).append($("<select/>",{name:"type_request",onchange:"inventory.changeRequestType();",html:$("<option/>",{value:"type",html:"Type"})}).append($("<option/>",{value:"brand",html:"Brand"})).append($("<option/>",{value:"service",html:"Service"})))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"name",value:e||""}))).append($("<div/>",{class:"iGroup typePrice",style:"display: none;",html:$("<label/>",{html:"Price"})}).append($("<input/>",{type:"number",name:"price",step:"0.1",min:"0",value:n||""}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",html:"Send",onclick:"inventory.sendRequest(this"+(t?", "+t:"")+");"})})),cb:function(){$("#page").select(),$('select[name="type_request"]').val(a||"type").trigger("change")}})},sendRequest:function(t,e){loadBtn.start($(t));var a={id:e},n=null;$(t).parents(".uForm").find("input").css("border","1px solid #ddd"),$('input[name="name"]').val()?"service"!=$('select[name="type_request"]').val()||$('input[name="price"]').val()?(a.type=$('select[name="type_request"]').val(),a.name=$('input[name="name"]').val(),a.price=$('input[name="price"]').val()):(n="Please, enter price",$('input[name="price"]').css("border","1px solid #f00")):(n="Please, enter name",$('input[name="name"]').css("border","1px solid #f00")),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):$.post("/inventory/send_request",a,function(a){"forbidden"==a?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):"OK"==a?(Page.get(location.href),mdl.close(),alr.show({class:"alrSuccess",content:"Request was successfully "+(e?"edited":"added"),delay:2})):alr.show({class:"alrDanger",content:lang[13],delay:2}),loadBtn.stop($(t))})},addOnsite:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a},s=null,l=$(t);l.find("label").next().css("border","1px solid #ddd"),l.find(".iGroup").each(function(t,e){$.inArray($(e).find("label").next().attr("name"),["name","call"==$('select[name="type"]').val()?"calls":"time","price"])>=0&&!$(e).find("label").next().val()?(s="Please, enter "+$(e).find("label").text(),$(e).find("label").next().css("border","1px solid #f00")):n[$(e).find("label").next().attr("name")]=$(e).find("label").next().val()}),n.store=Object.keys(l.find('input[name="store"]').data()).join(","),s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/inventory/send_onsite",n,function(t){"forbidden"==t?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):t>0?(Page.get("/inventory/onsite/edit/"+t),alr.show({class:"alrSuccess",content:"On site service was successfully "+(a?"edited":"added"),delay:2})):alr.show({class:"alrDanger",content:lang[13],delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))})},delOnsite:function(t){$.post("/inventory/del_onsite",{id:t},function(e){"OK"==e?$("#onsite_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},confirmOnsite:function(t,e){$.post("/inventory/confirm_onsite",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Service successfully confirmed",delay:2}),$(e).parent().remove()):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},confirmed_flag:0,confirmed:function(t,e){if(this.confirmed_flag)return!1;this.confirmed_flag=1,$(e).removeAttr("onlick"),$.post("/inventory/confirm",{id:t},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"Service successfully confirmed",delay:2}),$("#inventory_"+t).length?$("#inventory_"+t).removeClass("not-confirmed").find(".confBtn > a").remove():$(e).parent().remove()):"no_acc"==a?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):($(e).attr("onclik","inventory.confirmed("+t+", this); return false;"),alr.show({class:"alrDanger",content:lang[13],delay:2})),inventory.confirmed_flag=0})},addModel:function(t,e,a){$.post("/inventory/allCategories",{id:t||"",type:"inventory",nIds:Object.keys(a||{}).join(",")},function(n){n&&(items="",$.each(n.list,function(t,e){items+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"add_model",title:(t?lang[17]:lang[18])+" Model",content:'<form  method="post" onsubmit="inventory.sendModel(this, event, '+(t||0)+');">\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="iGroup" id="brand">\t\t\t\t\t\t\t<label>Brand</label>\t\t\t\t\t\t\t<input type="hidden" name="brand">\t\t\t\t\t\t\t<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t<button class="btn btnSubmit">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t</div>\t\t\t\t\t</form>",cb:function(){nIds=[],$('input[name="brand"]').data(a),$("#brand > ul").sForm({action:"/inventory/allCategories",data:{lId:lId,query:$("#brand > input").val(),nIds:Object.keys(a||{}).join(",")+","+t},all:n.count<=20,select:a,s:!0},$('input[name="brand"]'))}}))},"json")},sendModel:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t);if(s.find(".iGroup > input").css("border","1px solid #ddd"),n.append("id",a),!s.find('input[name="name"]').val().length)return s.find('input[name="name"]').css("border","1px solid #f00"),alr.show({class:"alrDanger",content:lang[16],delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));n.append("name",s.find('input[name="name"]').val()),n.append("brand",Object.keys(s.find('input[name="brand"]').data()).join(",")),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/inventory/sendModel",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),Page.get(location.href),mdl.close())})},delModel:function(t){$.post("/inventory/delModel",{id:t},function(e){"OK"==e?$("#invModel_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},newType:function(){mdl.open({id:"newType",title:"New Type",content:$("<div/>",{class:"form",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"name"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"inventory.sendNewType(this);",html:"Send"})}))})},sendNewType:function(t){var e=$(t).parents(".form");loadBtn.start($(t)),e.find('input[name="name"]').val()?$.post("/inventory/new_type",{name:e.find('input[name="name"]').val()},function(t){t>0&&($('select[name="type_id"]').append($("<option/>",{value:t,html:e.find('input[name="name"]').val()})),$('select[name="type_id"]').next().remove(),$('select[name="type_id"]').val(t),$("#page").select(),mdl.close())}):alr.show({class:"alrDanger",content:"Name can not be empty",delay:2})},newBrand:function(){mdl.open({id:"newBrand",title:"New Brand",content:$("<div/>",{class:"form",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Name"})}).append($("<input/>",{type:"text",name:"name"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"inventory.sendNewBrand(this);",html:"Send"})}))})},sendNewBrand:function(t){var e=$(t).parents(".form");loadBtn.start($(t)),e.find('input[name="name"]').val()?$.post("/inventory/new_brand",{name:e.find('input[name="name"]').val()},function(t){if(t>0){var a={};a[t]={name:e.find('input[name="name"]').val()},$('input[name="category"]').data(a),$("#category .sfWrap > div").prepend($("<span/>",{class:"nc",id:t,html:e.find('input[name="name"]').val()}).append($("<i/>"))),mdl.close()}}):alr.show({class:"alrDanger",content:"Name can not be empty",delay:2})},dub:function(t){$.post("/inventory/dub_service",{id:t},function(t){t>0?(Page.get("/inventory/edit/service/"+t),alr.show({class:"alrSuccess",content:"Service was successfully dublicated",delay:2})):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("status_",""),pr:$(a).find("input").val()}}),e&&$.post("/inventory/stPriority",e,function(t){})},sendWarrantyPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("status_",""),pr:$(a).find("input").val()}}),e&&$.post("/inventory/stWarrantyPriority",e,function(t){})},getGroup:function(t,e,a){var n="",s=0;$.post("/inventory/allModels",{type:Object.keys($('input[name="category"]').length?$('input[name="category"]').data():$('input[name="brand"]').data()).join(",")},function(l){l&&($.each(l.list,function(t,e){n+='<li data-value="'+e.id+'">'+e.name+"</li>",s=e.id}),a||($("#model > input").removeData(),$("#model > input").next().remove(),$("#model").append($("<ul/>",{html:n}))),!brand_id&&model_id&&($("#model > input").data(model_id),model_id=""),$("#model > ul").sForm({action:"/inventory/allModels",data:{query:$("#model > .sfWrap input").val(),type:Object.keys($('input[name="category"]').length?$('input[name="category"]').data():$('input[name="brand"]').data()).join(",")},all:!1,select:$('input[name="model"]').data(),s:!0},$('input[name="model"]'),null,{type:"category"}),t&&$.post("/inventory",{type_id:t,inventory:e},function(t){$("#forms").html(t),Page.init(),$(".mdl").length&&(p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<20?20:p)+"px"))},"json"))},"json")},addGroup:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a,opts:{}},s=$(t),l=null;s.find("input").css("border","1px solid #ddd"),s.find('input[name="name"]').val().length?(n.name=s.find('input[name="name"]').val(),s.find(".optGroup").each(function(t,e){n.opts[t]={type:$(e).find('select[name="type"]').val(),req:$(e).find('input[name="req"]').val()},$(e).find('input[name="oName"]').val().length?n.opts[t].name=$(e).find('input[name="oName"]').val():(l=lang[16],$(e).find('input[name="oName"]').css("border-color","#f00")),n.opts[t].id=$(e).find('input[name="oName"]').attr("data-id"),"select"==n.opts[t].type&&(n.opts[t].mult=$(e).find('input[name="sMul"]').val(),n.opts[t].sOpts={},$(e).find('input[name="opt"]').each(function(e,a){$(a).val().length?n.opts[t].sOpts[$(a).attr("data-id")||e]=$(a).val():(l=lang[130],$(a).css("border-color","#f00"))}))})):(l=lang[16],s.find('input[name="name"]').css("border-color","#f00")),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/inventory/send",n,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"ERROR"==t?alr.show({class:"alrDanger",content:lang[13],delay:2}):(alr.show({class:"alrSuccess",content:lang[131]+("SAVE"==t?lang[24]:lang[23]),delay:2}),Page.get("/inventory/types/edit/"+a))})},del:function(t){$.post("/inventory/del",{id:t},function(e){"OK"==e?$("#inventory_"+t).length?$("#inventory_"+t).remove():Page.get("/inventory"):alr.show({class:"alrDanger",content:lang[9],delay:2})})},delGroup:function(t){$.post("/inventory/delGroup",{id:t},function(e){"OK"==e?$("#invGroup_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendCategory:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t);if(s.find(".iGroup > input").css("border","1px solid #ddd"),n.append("id",a),!s.find('input[name="name"]').val().length)return s.find('input[name="name"]').css("border","1px solid #f00"),alr.show({class:"alrDanger",content:lang[16],delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));n.append("name",s.find('input[name="name"]').val()),n.append("parent",Object.keys(s.find('input[name="parent"]').data())),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/inventory/sendCategory",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),Page.get(location.href),mdl.close("select_par"))})},delCategory:function(t){$.post("/inventory/delCategory",{id:t},function(e){"OK"==e?$("#invCategory_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},selParent:function(t,e,a){$.post("/inventory/allCategories",{nIds:Object.keys($('input[name="'+e+'"]').data()).join(","),id:a},function(n){n&&(items="",$.each(n.list,function(t,e){items+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_par",title:t,content:'<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t<div class="sGroup"><button class="btn btnMdl" onclick="inventory.getParent(\''+e+"');\">"+lang[130]+"</button></div>",cb:function(){nIds=[],$("#select_par").find("ul").sForm({action:"/inventory/allCategories",data:{lId:lId,query:$("#select_par").find("input").val(),nIds:Object.keys($('input[name="'+e+'"]').data()).join(",")+","+a},all:n.count<=20,select:$('input[name="'+e+'"]').data(),s:!0},$('input[name="'+el+'"]'))}}))},"json")},getParent:function(t){mdl.close("select_par")},addCategory:function(t,e,a,n){$.post("/inventory/allCategories",{id:t||"",nIds:Object.keys(a||{}).join(",")},function(n){n&&(items="",lId=0,$.each(n.list,function(t,e){items+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_par",title:(t?lang[17]:lang[18])+" "+lang[129],content:'<form  method="post" onsubmit="inventory.sendCategory(this, event, '+(t||0)+');">\t\t\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="iGroup" id="parent">\t\t\t\t\t\t\t\t\t<input type="hidden" name="parent">\t\t\t\t\t\t\t\t\t<div class="lbl">'+lang[128]+'</div>\t\t\t\t\t\t\t\t\t<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t\t\t<button class="btn btnSubmit">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</form>",cb:function(){nIds=[],$('input[name="parent"]').data(a),$("#parent > ul").sForm({action:"/inventory/allCategories",data:{lId:lId,query:$("#parent > .sfWrap input").val()||"",nIds:Object.keys(a||{}).join(",")+","+t},all:n.count<=20,select:a,s:!0},$('input[name="parent"]'))}}))},"json")},openType:function(t,e,a,n,s,l){$.post("/inventory/allCategories",{nIds:Object.keys(n||{}).join(","),type:a||""},function(a){if(a){var n="";$.each(a.list,function(t,e){n+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_par",title:(t?lang[17]:lang[18])+" "+lang[127],content:'<form  method="post" onsubmit="inventory.sendType(this, event, '+t+');">\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t<button class="btn btnSubmit">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t</div>\t\t\t\t\t</form>",cb:function(){if($("#page").select(),s){var t={};t[s]={name:l},$('input[name="brand"]').data(t)}}})}},"json")},sendType:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a,opts:{}},s=$(t),l=null;s.find("input").css("border","1px solid #ddd"),s.find('input[name="name"]').val().length?(n.name=s.find('input[name="name"]').val(),n.type=s.find('select[name="type"]').val()):(l=lang[16],s.find('input[name="name"]').css("border-color","#f00")),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/inventory/send",n,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"ERROR"==t?alr.show({class:"alrDanger",content:lang[13],delay:2}):(alr.show({class:"alrSuccess",content:lang[125]+("SAVE"==t?lang[24]:lang[23]),delay:2}),Page.get(location.href),mdl.close("select_par"))})},catChange:function(t,e){"service"!=t?$("#brand").show():$("#brand").hide()},addInv:function(t,e,a,n){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var s=new FormData,l=$(t),o=null;location.pathname.indexOf("service");if(s.append("id",a),l.find(".iGroup > input").css("border","1px solid #ddd"),l.find(".sWrap").css("border","1px solid #ddd"),l.find('input[name="category"]').length||l.find('input[name="category"]').next().find("input").val()||l.find('input[name="name"]').length)if(l.find('input[name="category"]').length||l.find('input[name="name"]').val().length)if(l.find('input[name="type_id"]').length&&!Object.keys(l.find('input[name="type_id"]').data()).join(","))o="Type can not be empty";else if(l.find('input[name="category"]').length&&!Object.keys(l.find('input[name="category"]').data()).join(","))o="Brand can not be empty";else if(!l.find('input[name="model"]').length||Object.keys(l.find('input[name="model"]').data()).join(",")||l.find('input[name="model"]').next().find("input").val())if(Object.keys(l.find('input[name="object"]').data()).join(","))if(!l.find('input[name="location"]').length||Object.keys(l.find('input[name="location"]').data()).join(",")||l.find('input[name="location"]').next().find("input").val())if(l.find('select[name="sublocation"] > option[value="1"]').length&&0==l.find('select[name="sublocation"]').val())o="Sublocation can not be empty";else if(l.find('input[name="smodel"]').length&&!l.find('input[name="smodel"]').val())o="Model specification can not be empty";else if(!l.find('input[name="serial"]').length||l.find('input[name="serial"]').val()||$(t).find('input[name="quantity"]').val()&&1!=$(t).find('input[name="quantity"]').val())if(0==$(t).find('select[name="type_id"]').val())o=lang[123];else{$(t).find('input[name="name"]').val()&&s.append("name",$(t).find('input[name="name"]').val()),s.append("price",$(t).find('input[name="price"]').val()),s.append("purchase-price",$(t).find('input[name="purchase-price"]').val()),s.append("smodel",$(t).find('input[name="smodel"]').val()||""),s.append("os",$(t).find('select[name="os"]').val()||""),s.append("vendor",$(t).find('select[name="vendor"]').val()||""),s.append("owner_type",$(t).find('select[name="owner_type"]').val()||"external"),s.append("location_count",$(t).find('select[name="sublocation"]').val()||""),s.append("os_version",$(t).find('input[name="os_version"]').val()||""),s.append("serial",$(t).find('input[name="serial"]').val()||""),s.append("barcode",$(t).find('input[name="barcode"]').val()||""),s.append("currency",$(t).find('select[name="currency"]').val()||""),s.append("purchase_currency",$(t).find('select[name="purchase_currency"]').val()||""),s.append("descr",$(t).find('textarea[name="descr"]').val()||""),s.append("purchace",$(t).find('input[name="purchace"]').val()||""),s.append("quantity",$(t).find('input[name="quantity"]').val()||""),s.append("main",$(t).find('input[name="main"]').val()),s.append("charger",$(t).find('input[name="charger"]').val()),s.append("opt_charger",$(t).find('input[name="opt_charger"]').val()),s.append("save_data",$(t).find('input[name="save_data"]').val()),s.append("sd_comment",$(t).find('textarea[name="sd_comment"]').val()),s.append("parts",$(t).find('input[name="parts"]').val()),s.append("time",$(t).find('input[name="time"]').val()),s.append("category_new",$(t).find('input[name="category"]').next().find("input").val()),s.append("category",Object.keys($(t).find('input[name="category"]').data()||{}).join(",")),s.append("type_new",$(t).find('input[name="type_id"]').next().find("input").val()),s.append("type",Object.keys($(t).find('input[name="type_id"]').data()||{}).join(",")),s.append("model_new",$(t).find('input[name="model"]').next().find("input").val()),s.append("model",Object.keys($(t).find('input[name="model"]').data()||{}).join(",")),s.append("location_new",l.find('input[name="location"]').next().find("input").val()),s.append("location",Object.keys(l.find('input[name="location"]').data()||{}).join(",")),s.append("object",Object.keys(l.find('input[name="object"]').data()||{}).join(",")),s.append("object_owner",Object.keys(l.find('input[name="object_owner"]').data()||{}).join(",")),s.append("status",Object.keys(l.find('input[name="status"]').data()||{}).join(",")),s.append("storeCat",Object.keys(l.find('input[name="storeCat"]').data()||{}).join(",")),s.append("store_status",Object.keys(l.find('input[name="store_status"]').data()||{}).join(","));var c={};if(n?(s.append("customer",l.find('input[name="customer"]').val()),s.append("intype","stock")):(s.append("customer",Object.keys(l.find('input[name="customer"]').data()||{}).join(",")),location.pathname.indexOf("service")>=0?s.append("intype","service"):s.append("intype","stock")),location.pathname.indexOf("service")>=0?(i=0,l.find("#steps > .iGroup").each(function(t,e){$(e).find("input").val()&&(c[t]={id:$(e).find("input").attr("data-id")||t,name:$(e).find("input").val()}),t++})):l.find("#forms > .iGroup").each(function(t,e){$(e).find("label").next().val()&&(c[$(e).find("label").next().attr("data-id")]=$(e).find("label").next().val())}),s.append("opts",JSON.stringify(c)),$(".dragndrop").length){var r=$(".dragndrop")[0].files,d=$(".dragndrop")[0].delete;if(d&&$.each(d,function(){s.append("delete[]",this.split("thumb_")[1])}),!$.isEmptyObject(r))for(var n in r)s.append("image[]",r[n])}}else o="Serial number can not be empty";else o="Location can not be empty";else o="Please, select store";else o="Model can not be empty";else o=lang[16],l.find('input[name="name"]').css("border-color","#f00");else o=lang[124];o?(alr.show({class:"alrDanger",content:o,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/inventory/send_inventory",data:s}).done(function(a){loadBtn.stop($(e.target).find('button[type="submit"]')),a?"no_acc"==a?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):"cat_exists"==a?alr.show({class:"alrDanger",content:"Brand exists",delay:2}):"tp_exists"==a?alr.show({class:"alrDanger",content:"Type exists",delay:2}):"mdl_exists"==a?alr.show({class:"alrDanger",content:"Model exists",delay:2}):"loc_exists"==a?alr.show({class:"alrDanger",content:"Locations exists. Check, please, maybe you can not use the location with current status",delay:2}):"no_object"==a?alr.show({class:"alrDanger",content:"Please, select object",delay:2}):"min_price"==a?alr.show({class:"alrDanger",content:"Min sale price can not be less than $"+parseFloat(min_price(parseFloat($(t).find('input[name="purchase-price"]').val()))).toFixed(2),delay:2}):a>0&&(alr.show({class:"alrSuccess",content:lang[122],delay:2}),location.pathname.indexOf("service")>=0?Page.get("/inventory/service"):$_GET("backusr")?Page.get("/users/view/"+parseInt($_GET("backusr"))):Page.get(n?"/issues/step/"+a:"/inventory/view/"+a)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},changeStType:function(t){console.log(t.value),0==t.value?(console.log(1),$("#points").show(),$("#addPoint").show(),$("#minus").hide(),$('input[name="forfeit"]').val(0)):($("#points").hide(),$("#addPoint").hide(),$("#minus").show())},openStatus:function(t,e,a,n,s,l,o,c){$.post("/settings/allForms",{},function(i){forms="",i&&$.each(i.list,function(t,e){forms+='<option value="'+e.id+'" '+(l==e.id?"selected":"")+">"+e.name+"</option>"}),mdl.open({id:"openStatus",title:(t?lang[17]:lang[18])+lang[121],cb:function(){l&&$('select[name="smForm"]').val(l),$("#page").select(),$("#page").checkbox(),1==s&&$('input[name="sms"]').val(1).trigger("click"),0!=n&&$('input[name="fine"]').val(1).trigger("click"),1==c&&$('input[name="percent"]').val(1).trigger("click"),e&&($.each(e,function(t,e){$("#points").html($("<div/>",{class:"iGroup pGroup",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:lang[116]})}).append($("<input/>",{type:"number",min:0,name:"time",value:t}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:lang[115]})}).append($("<input/>",{type:"number",min:0,name:"points",value:e}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))}),p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<20?20:p)+"px"))},content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:a||""}))}).append(0==o?$("<div/>",{class:"iGroup",html:$("<label/>",{html:"% from total"})}).append($("<input/>",{type:"checkbox",name:"percent",value:c?1:0})):"").append($("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[120]})}).append($("<input/>",{type:"checkbox",onchange:"inventory.changeStType(this);",name:"fine"}))).append($("<div/>",{id:"points",class:n?"hdn":""})).append($("<div/>",{id:"minus",class:n?"":"hdn",html:$("<div/>",{class:"iGroup fw",html:$("<input/>",{type:"text",name:"forfeit",value:n||"",placeholder:lang[120]})})})).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Send sms"})}).append($("<input/>",{type:"checkbox",name:"sms",onchange:"inventory.changeStSms(this);",value:s?1:0}))).append($("<div/>",{id:"sms",class:s?"":"hdn",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Form"})}).append($("<select/>",{name:"smsForm",html:forms}))})).append($("<div/>",{class:"iGroup sGroup",id:"addPoint",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.addPoint(this)",html:lang[119]})})).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.sendStatus(this, "+t+(o?", 1":"")+")",html:t?lang[113]:lang[91]})}))})},"json")},changeStSms:function(t){$(t).val()>0?$("#sms").removeClass("hdn"):$("#sms").addClass("hdn")},sendStatus:function(t,e,a){var n=$(t).parents(".mdlBody"),s={},l=null;e&&(s.id=e),a&&(s.warranty=1),n.find("input").css("border-color","#ddd"),n.find('input[name="name"]').val().length?(s.name=n.find('input[name="name"]').val(),s.forfeit=n.find('input[name="forfeit"]').val(),s.sms=n.find('input[name="sms"]').val(),s.percent=n.find('input[name="percent"]').val(),s.smsForm=n.find('select[name="smsForm"]').val(),s.pointGroup={},n.find(".pGroup").each(function(t,e){$(e).find('input[name="time"]').val().length?$(e).find('input[name="points"]').val().length?s.pointGroup[$(e).find('input[name="time"]').val()]=$(e).find('input[name="points"]').val():(l=lang[118],$(e).find('input[name="points"]').css("border-color","#f00")):(l=lang[119],$(e).find('input[name="time"]').css("border-color","#f00"))})):(l=lang[16],n.find('input[name="name"]').css("border-color","#f00")),l?alr.show({class:"alrDanger",content:l,delay:2}):$.post("/inventory/sendStatus",s,function(t){loadBtn.stop($(this)),t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delStatus:function(t,e){t?$.post("/inventory/delStatus",{id:t,warranty:e?1:0},function(e){"OK"==e?$("#status_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},statusHis:function(t){$.post("/inventory/status_history",{id:t},function(t){if(t){var e="";$.each(t.list,function(t,a){e+='<div class="iGroup stGroup"><label>'+a.status+"</label><label>"+a.name+" "+a.lastname+"</label><label>"+a.date+"</label></div>"}),mdl.open({id:"statusHis",width:800,title:lang[117],content:e})}},"json")},addPoint:function(t){e=$(t).parent(),$("#points").append($("<div/>",{class:"iGroup pGroup",html:$("<div/>",{class:"sSide",html:$("<label/>",{html:lang[116]})}).append($("<input/>",{type:"number",min:0,name:"time"}))}).append($("<div/>",{class:"sSide",html:$("<label/>",{html:lang[115]})}).append($("<input/>",{type:"number",min:0,name:"points"}))).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"}))),p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<20?20:p)+"px")},addLocation:function(t){$(t).parent().before($("<div/>",{class:"iGroup lGroup",html:$("<input/>",{type:"text",name:"location",placeholder:lang[92]})}).append($("<span/>",{class:"fa fa-times",onclick:"$(this).parent().remove();"})))},sendLocation:function(t,e,a,n){e.preventDefault();var s={id:a};n&&(s.warranty=1),$(t).find("input").css("border-color","#ddd"),loadBtn.start($(e.target).find('button[type="submit"]')),s.loc=Object.keys($('input[name="location"]').data()||{}).join(","),s.service=$('input[name="service"]').val(),s.inventory=$('input[name="inventories"]').val(),s.purchase=$('input[name="purchase"]').val(),s.remove_purchase=$('input[name="remove_purchase"]').val(),s.note=$('input[name="note"]').val(),n||(s.assigned=$('input[name="assigned"]').val()),$.post("/inventory/location",s,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"OK"==t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),Page.get("/inventory/"+(n?"warranty_statuses":"types/status"))):alr.show({class:"alrDanger",content:lang[13],delay:2})})},openOS:function(t,e){mdl.open({id:"openOS",title:(t?lang[17]:lang[18])+" OS",content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.sendOS(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendOS:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s="Name can not be empty",a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/inventory/save_os",n,function(t){loadBtn.stop($(this)),"OK"==t?(alr.show({class:"alrSuccess",content:lang[112],delay:2}),mdl.close("openOS"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delOS:function(t){t?$.post("/inventory/del_os",{id:t},function(e){"OK"==e?$("#os_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},openVendor:function(t,e){mdl.open({id:"openVendor",title:(t?lang[17]:lang[18])+" Vendor",content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.sendVendor(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendVendor:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s="Name can not be empty",a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/inventory/sendVendor",n,function(t){loadBtn.stop($(this)),"OK"==t?(alr.show({class:"alrSuccess",content:"Vendor was successfully saved",delay:2}),mdl.close("openVendor"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delVendor:function(t){t?$.post("/inventory/delVendor",{id:t},function(e){"OK"==e?$("#vendor_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},toObject:function(t){mdl.open({id:"openMove",title:lang[111],content:$("<div/>",{class:"form",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[110]})}).append($("<input/>",{type:"number",min:"0",step:"0.1",name:"purchase"}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[109]})}).append($("<input/>",{type:"number",name:"sale",min:"0",step:"0.1"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.sendToObject(this, "+t+")",html:lang[91]})}))})},tradeConfirm:function(t,e){mdl.open({id:"confirmTradein",title:"Tradein confirmation",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Price"})}).append($("<input/>",{type:"number",step:"0.1",min:"0",name:"price",value:e}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"inventory.sendTradeConf(this, "+t+")",html:"Confirm"})}))})},sendTradeConf:function(t,e){loadBtn.start($(t));var a={id:e,price:0};$(t).parents(".uForm").find('input[name="price"]').val()?(a.price=$(t).parents(".uForm").find('input[name="price"]').val(),$.post("/inventory/confirm_tradein",a,function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"You successfully confirmed tradein",delay:2}),Page.get(location.href),loadBtn.start($(t)),mdl.close()):(alr.show({class:"alrDanger",content:lang[13],delay:2}),loadBtn.stop($(t)))})):(alr.show({class:"alrDanger",content:"Please, enter price",delay:2}),loadBtn.stop($(t)))},sendToObject:function(t,e){var a=$(t).parents(".form");a.find('input[name="purchase"]').val().length?a.find('input[name="sale"]').val()?inventory.contToObject(e):mdl.open({id:"openSend",title:"Warning",content:$("<div/>",{class:"form",html:$("<div/>",{class:"warning",html:lang[107]})}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"inventory.contToObject("+e+")",html:lang[106]})}).append($("<button/>",{class:"btn btnSubmit red",onclick:'mdl.close("openSend")',html:lang[105]})))}):(alr.show({class:"alrDanger",content:lang[108],delay:2}),a.find('input[name="purchase"]').css("border-color","#f00"))},contToObject:function(t){var e={id:t,purchase:$("#openMove").find('input[name="purchase"]').val(),sale:$("#openMove").find('input[name="sale"]').val(),object:Object.keys($('input[name="object"]').data()).join(",")};$.post("/inventory/to_object",e,function(e){if("OK"==e){var a={};a.customer=Object.keys($('input[name="customer"]').data()).join(","),a.object=Object.keys($('input[name="object"]').data()).join(","),a.inventory=t,a.subtotal=-parseFloat($('input[name="purchase"]').val()),a.tax=0,a.total=a.subtotal,a.paid=0,a.purchase=1,$.post("/invoices/send",a,function(t){t>0?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),mdl.close("openMove"),Page.get("/invoices/view/"+t)):alr.show({class:"alrDanger",content:lang[13],delay:2})})}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},toStore:function(t){$.post("/inventory/to_store",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:lang[104],delay:2}),Page.get(location.href),mdl.close("openMove")):"no_images"==t?alr.show({class:"alrDanger",content:"Stock must have enough one image",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})}},purchases={cpage:0,reciveStock:function(t){mdl.open({id:"reciveStock",title:"Select specification",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",id:"type",html:$("<label/>",{html:"Type"})}).append($("<input/>",{type:"hidden",name:"type"})).append($("<ul/>",{class:"hdn"}))}).append($("<div/>",{class:"iGroup fw",id:"brand",html:$("<label/>",{html:"Brand"})}).append($("<input/>",{type:"hidden",name:"brand"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup fw",id:"model",html:$("<label/>",{html:"Model"})}).append($("<input/>",{type:"hidden",name:"model"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",html:"Send",onclick:"purchases.receiveMdl("+t+")"})})),cb:function(){$.post("/inventory/allCategories",{nIds:Object.keys($('input[name="brand"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#brand > ul").html(e).sForm({action:"/inventory/allCategories",data:{lId:a,query:$("#brand > .sfWrap input").val()||""},all:!1,select:$('input[name="brand"]').data(),s:!0},$('input[name="brand"]'),inventory.getGroup)}},"json"),$.post("/inventory/allTypes",{name:1,brand:Object.keys($('input[name="brand"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#type > ul").html(e).sForm({action:"/inventory/allTypes",data:{lId:a,query:$("#type > .sfWrap input").val()||"",name:1,brand:Object.keys($('input[name="brand"]').data()).join(",")||0},all:!1,select:$('input[name="type"]').data(),s:!0},$('input[name="type"]'))}},"json")}})},receiveMdl:function(t){mdl.open({title:"Receive purchase",content:$("<div/>",{class:"conQuestion",html:$("<div/>",{html:"Are you sure that you have received purchase #"+t+"?"})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"purchases.receive("+t+");",html:"Yes"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"No"})))})},receive:function(t){$.post("/purchases/receive",{id:t,type:$('input[name="type"]').length?Object.keys($('input[name="type"]').data())[0]:0,brand:$('input[name="brand"]').length?Object.keys($('input[name="brand"]').data())[0]:0,model:$('input[name="model"]').length?Object.keys($('input[name="model"]').data())[0]:0,model_new:$("#model .sfWrap input").length?$("#model .sfWrap input").val():""},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Purchase was successfully received",delay:2}),Page.get(location.href)):"no_info"==t?alr.show({class:"alrDanger",content:"Please, select fields",delay:2}):"mdl_exists"==t?alr.show({class:"alrDanger",content:"Model name exists",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},comments:function(t){purchases.cpage=0,$.post("/purchases/comments",{id:t},function(e){mdl.open({id:"cashComments",title:"Comments",content:$("<div/>",{html:$("<div/>",{class:"comments",html:e.content})}).append($("<button/>",{class:"btn btnLoad"+(e.left_count>0?"":" hdn"),onclick:"cash.doloadComments(this,"+t+");",html:"Load comments"})).append($("<div/>",{class:"commentForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Leave comment"})}).append($("<textarea/>",{name:"comment"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"purchases.sendComment("+t+");",html:"Send"})})))})},"json")},sendComment:function(t){$('textarea[name="comment"]').val()?$.post("/purchases/send_comment",{id:t,text:$('textarea[name="comment"]').val()},function(t){"OK"==t.res?(alr.show({class:"alrSuccess",content:"Comment was successfully added",delay:2}),$(".comments").append(t.html),$('textarea[name="comment"]').val(""),p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<70?70:p)+"px")):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json"):alr.show({class:"alrDanger",content:"Comment can not be empty",delay:2})},doloadComments:function(t,e){purchases.cpage+=1,$.post("/purchases/comments",{id:e,page:purchases.cpage},function(e){$(".comments").append(e.content),e.left_count||$(t).addClass("hdn")},"json")},rmaRestore:function(t){$.post("/purchases/rma_restore",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"Purchase was successfully restored",delay:2}),$("#purchase_"+t).hasClass("returnRequest")?$("#purchase_"+t).removeClass("returnRequest").find(".purchComments").remove():$("#purchase_"+t).remove()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},confirmDel:function(t,e){mdl.open({title:"Confirm deletion",content:$("<div/>",{class:"conQuestion",html:$("<div/>",{html:e?"Purchase was paid by customer! Are sure you want to delete it?":"Are you sure?"})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"purchases.del("+t+");",html:"Yes"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"No"})))})},confirmRma:function(t){mdl.open({title:"Confirm request",content:$("<div/>",{html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"RMA comment"})}).append($("<textarea/>",{name:"rma_comment",placeholder:"Comment are required"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"purchases.rma("+t+");",html:"Send"})}))})},rmaReadComment:function(t){$.post("/purchases/get_rma_comment",{id:t},function(e){mdl.open({id:"rma_comment",title:"Confirm RMA reason",content:$("<div/>",{html:$("<div/>",{class:"sumCash",html:e||"Request has no comment"})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn  btnSubmit ac",html:"Accept",onclick:"purchases.rma("+t+", 'confirm', 1);"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",html:"Dicline",onclick:"purchases.rma("+t+", 'confirm', 0);"})))})})},rma:function(t,e,a){$.post("/purchases/send_rma",{id:t,action:e,type:a,comment:$('textarea[name="rma_comment"]').length?$('textarea[name="rma_comment"]').val():""},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"confirm"==e?"Purchase returning was confirmed":"pickup"==e?"Purchase are picked up":"Return request was sent",delay:2}),e?"confirm"==e?$("#purchase_"+t).remove():$("#purchase_"+t).removeClass("unpaid").addClass("paid").find(".uMore li:last-child").remove():($("#purchase_"+t).addClass("returnRequest").find(".uMore li:last-child").remove(),$("#purchase_"+t).find(".uMore").append($("<span/>",{class:"fa fa-comment purchComments",onclick:"purchases.comments("+t+");"}))),$(".mdl").length&&mdl.close()):"no_acc"==a?alr.show({class:"alrDanger",content:"You have no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},confirm:function(t){$.post("/purchases/confirm_purchase",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Purchase was successfully confirmed",delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},changePrice:function(){price=$(".uForm").find('input[name="price"]').val().replace(/\D(\.?)\D/gi,""),$('input[name="total"]').val((price*$('input[name="quantity"]').val()).toFixed(2)),$('input[name="proceeds"]').val(((parseFloat($('input[name="sale"]').val())-parseFloat($('input[name="price"]').val()))*$('input[name="quantity"]').val()).toFixed(2))},getLink:function(t){var e=t.value.indexOf("http://")>=0||t.value.indexOf("https://")>=0?t.value:"http://"+t.value;$('button[type="submit"]').attr("disabled","disabled"),$.get("/parser?lnk="+e,function(e){switch(e){case"no_responce":alr.show({class:"alrDanger",content:lang[13],delay:2});break;default:$(t).parents(".uForm").find('input[name="name"]').val(e.title),$(t).parents(".uForm").find('input[name="price"]').val(e.price.replace(/[^0-9.]/g,"")),$(t).parents(".uForm").find('input[name="quantity"]').val(1),$(t).parents(".uForm").find('input[name="total"]').val(e.price.replace(/[^0-9.]/g,"")),$(t).parents(".uForm").find('input[name="tracking"]').val(e.code),e.image&&$(t).parents(".uForm").find(".imgGroup").removeClass("hdn").find("img").attr("src",e.image),e.estimated&&$(t).parents(".uForm").find('input[name="estimated"]').val(e.estimated)}$('button[type="submit"]').removeAttr("disabled")},"json")},send:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t).serializeArray(),l=null;n.append("id",a);for(var o=0;o<s.length;o++){if(!s[o].value.length&&!$('input[name="'+s[o].name+'"]').data()&&$.inArray(s[o].name,["comment","customer","tracking","ship-tracking","estimated"])<0&&s[o].name.length){l=lang[101]+s[o].name+lang[102],$('input[name="'+s[o].name+'"]').css("border-color","#f00");break}if(!$('input[name="'+s[o].name+'"]').val()&&"salename"==s[o].name){l="Sale name can not be empty",$('input[name="'+s[o].name+'"]').css("border-color","#f00");break}if($('input[name="'+s[o].name+'"]').val()<=0&&"sale"==s[o].name){l="Please, enter sale price",$('input[name="'+s[o].name+'"]').css("border-color","#f00");break}"object"==s[o].name?Object.keys($('input[name="object"]').data()).join(",")?n.append(s[o].name,Object.keys($('input[name="'+s[o].name+'"]').data()||{})):l="Please, select store":"customer"==s[o].name?n.append(s[o].name,Object.keys($('input[name="'+s[o].name+'"]').data()||{})):"price"==s[o].name?n.append(s[o].name,$('[name="price"]').val().replace(/(\D*)/i,"")):n.append(s[o].name,s[o].value)}if($(".imgGroup img").attr("src")?n.append("photo",$(".imgGroup img").attr("src")):n.append("del_photo",!0),n.append("currency",$('select[name="currency"]').val()),n.append("purchase_currency",$('select[name="purchase_currency"]').val()),l)return alr.show({class:"alrDanger",content:l,delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));$.ajax({type:"POST",processData:!1,contentType:!1,url:"/purchases/send",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"min_price"==t?alr.show({class:"alrDanger",content:"Min sale price can not be less than $"+parseFloat(min_price(parseFloat($('[name="price"]').val().replace(/(\D*)/i,"")))).toFixed(2),delay:2}):t.indexOf("min_price")>=0?alr.show({class:"alrDanger",content:"Min sale price can not be less than $"+t.split("_")[2],delay:2}):t>0?(alr.show({class:"alrSuccess",content:lang[8],delay:2}),$_GET("usr")?Page.get("/users/view/"+parseInt($_GET("usr"))):Page.get("/purchases/edit/"+t)):"enter_price"==t?alr.show({class:"alrDanger",content:"Please, enter price",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},del:function(t){$.post("/purchases/del",{id:t},function(e){"OK"==e?$("#purchase_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2}),$(".mdl").length&&mdl.close()})}},data,issues={confirmStoreIssue:function(t){$.post("/issues/confirm_store_issue",{id:t},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"You successfully confirmed issue",delay:2}),Page.get("/issues/view/"+t)):"confirmed"==e?(alr.show({class:"alrDanger",content:"Issue is already confirmed",delay:2}),$("#issue_store_"+t).remove()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},assignedConfirm:function(t,e){$.post("/issues/confirm_assigned",{id:t,type:e},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"You successfully "+(e?"confirmed":"diclined")+" request",delay:2}),$("#notif_"+t).remove()):"not_staff"==a?alr.show({class:"alrDanger",content:"You trying to "+(e?"confirmed":"diclined")+" not your request",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},assigned:function(t){$.post("/users/all",{staff:1},function(e){var a="",n=0;e.list&&$.each(e.list,function(t,e){a+='<li data-value="'+e.id+'">'+e.name+"</li>",n=e.id}),mdl.open({id:"assigned",title:"Switch assigned",content:$("<div/>",{html:$("<div/>",{class:"iGroup",id:"staff",html:$("<label/>",{html:"Staff"})}).append($("<input/>",{type:"hidden",name:"staff"})).append($("<ul/>"))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",html:"Send",type:"button",onclick:"issues.sendAssigned("+t+")"})})),cb:function(){$("#staff > ul").html(a).sForm({action:"/users/all",data:{lId:n,query:$("#staff > .sfWrap input").val()||"",staff:1},all:!1,s:!0,link:"users/view"},$('input[name="staff"]'))}})},"json")},sendAssigned:function(t){Object.keys($('input[name="staff"]').data()).join(",")?$.post("/issues/send_assigned",{id:t,staff:Object.keys($('input[name="staff"]').data()).join(",")},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"You successfully sent request for switching assigned staff",delay:2}),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})}):alr.show({class:"alrDanger",content:"Please, select staff",delay:2})},addRandomFeedback:function(t){var e=parseInt($("#feedback_"+t).attr("data-stars")),a="";for(j=1;j<=5;j++)a+='<span class="fa fa-star rStart mini r_'+e+(j<=e?" active":"")+'" ratting="'+j+'"></span>';mdl.open({id:"add_feedback",title:"Add feedback",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Rating"})}).append($("<div/>",{class:"stRating",id:"fb_ratting",html:a}))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Comment"})}).append($("<textarea/>",{name:"feed_comment",html:$("#comment_"+t).text()}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"issues.sendRandomFeedback(event, "+t+")",html:"Send"})}))}),$(".stRating > .fa-star").bind("mouseover mouseout click",function(t){switch(t.preventDefault(),t.type){case"mouseover":for(var e=$(t.target).attr("ratting"),a=0;a<e;a++)$(".stRating > .fa-star").eq(a).addClass("hover");break;case"mouseout":$(".stRating > .fa-star").removeClass("hover");break;case"click":e=$(t.target).attr("ratting");$("#fb_ratting").val(e),$(".stRating > .fa-star").removeClass("active");for(a=0;a<e;a++)$(".stRating > .fa-star").eq(a).addClass("active")}})},sendRandomFeedback:function(t,e){t.preventDefault(),loadBtn.start($(t.target));var a=parseInt($("#fb_ratting").val()),n=$('textarea[name="feed_comment"]').val();a>0?$.post("/issues/send_random_feedback",{user_id:e,ratting:a,comment:n},function(t){"OK"==t&&(alr.show({class:"alrSuccess",content:"Complete",delay:2}),mdl.close(),Page.get(location.href))}):alr.show({class:"alrDanger",content:lang.err_ratting,delay:2}),loadBtn.stop($(t.target))},confirmWarranty:function(t,e){$.post("/issues/confirm_warranty",{issue:t,device:e},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Warranty request was successfully confirmed",delay:2}),Page.get(location.href)):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},mdlWarranty:function(t,e){mdl.open({id:"warranty_mdl",title:"Warranty reason",content:$("<div/>",{class:"form",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Plase, enter warranty reason"})}).append($("<textarea/>",{id:"warranty_comment"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"issues.warranty("+t+", "+e+");",text:"Send"})}))})},warranty:function(t,e){$("#warranty_comment").val().trim().length>10?$.post("/issues/request_warranty",{issue:t,device:e,comment:$("#warranty_comment").val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Warranty request was successfully sent",delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})}):alr.show({class:"alrDanger",content:"Please, enter warranty reason. It must has enought 10 symbols",delay:3})},invisible:function(t,e){mdl.open({id:"inv_service",title:"Invisible service",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup price",id:"upcharge",html:$("<label/>",{html:"Upcharge service"})}).append($("<ul/>",{class:"hdn"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"issues.send_invisible("+t+");",html:"Send"})})),cb:function(){$.post("/inventory/allUpcharge",{nIds:Object.keys($('input[name="upcharge"]').data()||{}).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="$'+parseFloat(n.price).toFixed(2)+'">'+n.name+"</li>",a=n.id}),$("#upcharge > ul").html(e).sForm({action:"/inventory/allUpcharge",data:{lId:a,nIds:Object.keys($('input[name="upcharge"]').data()||{}).join(","),query:$("#upcharge > .sfWrap input").val()||""},all:!1,select:$('input[name="upcharge"]').data(),s:!0},$('input[name="upcharge"]'))}},"json")}})},send_invisible:function(t){$.post("/issues/send_invisible",{id:t,service:JSON.stringify($('input[name="upcharge"]').data())},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Service was successfully updated",delay:2}),mdl.close(),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},updateRate:function(t){},starFeedback:function(t,e,a,n){switch(e.preventDefault(),e.type){case"mouseover":for(var s=$(e.target).attr("ratting"),l=1;l<=s;l++)$(t).find("span").eq(l).addClass("hover");break;case"mouseout":$(t).find("span").removeClass("hover");break;case"click":var s=$(e.target).attr("ratting"),o=$(t).attr("data-rate");$(t).attr("data-rate",s),$(t).find("span").removeClass("active").removeClass("hover").removeClass("r_"+o);for(l=1;l<=s;l++)$(t).find("span").eq(l).addClass("active").addClass("r_"+s);a>0&&$.post("/issues/feedbacks_update_ratting",{id:a,ratting:s,random:n||0},function(t){console.log(t)})}},addFeedback:function(t,e){mdl.open({id:"add_feedback",title:"Add feedback",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Rating"})}).append($("<div/>",{class:"stRating",id:"fb_ratting",html:'<span class="fa fa-star rStart" ratting="1"></span><span class="fa fa-star rStart" ratting="2"></span><span class="fa fa-star rStart" ratting="3"></span><span class="fa fa-star rStart" ratting="4"></span><span class="fa fa-star rStart" ratting="5"></span>'}))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Comment"})}).append($("<textarea/>",{name:"feed_comment"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"issues.sendFeedback(event, "+t+", "+e+")",html:"Send"})}))}),$(".stRating > .fa-star").bind("mouseover mouseout click",function(t){switch(t.preventDefault(),t.type){case"mouseover":for(var e=$(t.target).attr("ratting"),a=0;a<e;a++)$(".stRating > .fa-star").eq(a).addClass("hover");break;case"mouseout":$(".stRating > .fa-star").removeClass("hover");break;case"click":e=$(t.target).attr("ratting");$("#fb_ratting").val(e),$(".stRating > .fa-star").removeClass("active");for(a=0;a<e;a++)$(".stRating > .fa-star").eq(a).addClass("active")}})},sendFeedback:function(t,e,a){t.preventDefault(),loadBtn.start($(t.target));var n=parseInt($("#fb_ratting").val()),s=$('textarea[name="feed_comment"]').val();n>0?$.post("/issues/send_feedback",{issue_id:e,ratting:n,comment:s},function(t){"OK"==t&&(alr.show({class:"alrSuccess",content:"Complete",delay:2}),mdl.close(),Page.get(location.href))}):alr.show({class:"alrDanger",content:lang.err_ratting,delay:2}),loadBtn.stop($(t.target))},editDiscount:function(t,e,a,n){$.post("/users/is_admin",{},function(e){adm=0,"OK"==e&&(adm=1),$.post("/invoices/allDiscounts",{},function(e){var s='<option value="0">Not selected</option>';$.each(e.list,function(t,e){s+='<option value="'+e.id+'"'+(e.id==a?" selected":"")+' data-price="'+e.price+'">'+e.name+"</option>"}),mdl.open({id:"discount_mdl",title:"Select discount",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Discount"})}).append($("<select/>",{name:"discount_id",html:s}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Reason"})}).append($("<textarea/>",{name:"reason",html:$("#discount_reason").val()}))).append($("<div/>",{class:"sGroup",html:adm&&!n?$("<button/>",{type:"button",class:"btn btnSubmit left",onclick:"issues.confirmDiscount("+t+");",html:"Confirm"}):""}).append($("<button/>",{type:"button",class:"btn btnSubmit",onclick:"issues.sendDiscount("+t+");",html:"Save"}))),cb:function(){$("#page").select()}})},"json")})},confirmDiscount:function(t){$.post("/issues/send_field",{id:t,field:"discount_confirmed",value:1,full:1},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Discount successfully confirmed",delay:2}),mdl.close(),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendDiscount:function(t){var e=$('select[name="discount_id"]').val();$.post("/issues/send_discount",{id:t,discount:'{"'+e+'":{"name":"'+$('select[name="discount_id"] > option[value="'+e+'"]').text()+'","price":"'+$('select[name="discount_id"] > option[value="'+e+'"]').attr("data-price")+'"}}',reason:$('textarea[name="reason"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Discount successfully updated",delay:2}),mdl.close(),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},newInv:function(){$.post("/inventory/allOS",{},function(t){if(t){var e="";$.each(t.list,function(t,a){e+='<option value="'+a.id+'">'+a.name+"</option>"})}},"json")},newServ:function(){},sendDev:function(t,e){e.preventDefault(),loadBtn.start($(t).find('button[type="submit"]'));var a=new FormData,n=$(t).parents(".form"),s=null;n.find(".iGroup > input").css("border","1px solid #ddd"),n.find(".sWrap").css("border","1px solid #ddd"),Object.keys(n.find('input[name="brand"]').data()).join(",")||n.find('input[name="brand"]').next().find("input").val().length?Object.keys(n.find('input[name="type_id"]').data()).join(",")||n.find('input[name="type_id"]').next().find("input").val().length?Object.keys(n.find('input[name="model"]').data()).join(",")||n.find('input[name="model"]').next().find("input").val().length?n.find('input[name="brand"]').length||n.find('input[name="name"]').val().length?0==n.find('select[name="type"]').val()?s=lang[123]:(n.find('input[name="name"]').val()&&a.append("name",n.find('input[name="name"]').val()),a.append("price",n.find('input[name="price"]').val()),a.append("smodel",n.find('input[name="smodel"]').val()||""),a.append("os",n.find('select[name="os"]').val()||""),a.append("os_version",n.find('input[name="os_ver"]').val()||""),a.append("serial",n.find('input[name="sn"]').val()||""),a.append("intype","stock"),a.append("type",Object.keys(n.find('input[name="type_id"]').data()||{}).join(",")),a.append("type_new",n.find('input[name="type_id"]').next().find("input").val()),a.append("category",Object.keys(n.find('input[name="brand"]').data()||{}).join(",")),a.append("category_new",n.find('input[name="brand"]').next().find("input").val()),a.append("model",Object.keys(n.find('input[name="model"]').data()||{}).join(",")),a.append("model_new",n.find('input[name="model"]').next().find("input").val()),a.append("exist_inventory",$('input[name="inventory_id"]').val()),$('input[name="issue_id"]').length&&a.append("issue_id",$('input[name="issue_id"]').val())):(s=lang[16],n.find('input[name="name"]').css("border-color","#f00")):s="Select model":s="Select type":s=lang[124],s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t).find('button[type="submit"]'))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/inventory/send_short_inventory",data:a}).done(function(e){if(loadBtn.stop($(t).find('button[type="submit"]')),e){if("no_obj"==e)alr.show({class:"alrDanger",content:"You issue device is not in store. Or you are not logged on store. Fix it and try again.",delay:2});else if("cat_exists"==e)alr.show({class:"alrDanger",content:"Brand exists",delay:2});else if("tp_exists"==e)alr.show({class:"alrDanger",content:"Type exists",delay:2});else if("mdl_exists"==e)alr.show({class:"alrDanger",content:"Model exists",delay:2});else if("loc_exists"==e)alr.show({class:"alrDanger",content:"Locations exists",delay:2});else if((e=JSON.parse(e)).id>0){var a={};a[e.id]={name:e.name,price:n.find('input[name="price"]').val()},$('input[name="inventory"]').data(a),$("#inventory .sfWrap > div").prepend($("<span/>",{class:"nc",id:e.id,"data-price":n.find('input[name="price"]').val(),html:e.name}).append($("<i/>"))),mdl.close("createDevice"),alr.show({class:"alrSuccess",content:lang[122],delay:2})}}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendServ:function(t,e){e.preventDefault(),loadBtn.start($(t).find('button[type="submit"]'));var a=new FormData,n=$(t).parents(".form"),s=null;n.find(".iGroup > input").css("border","1px solid #ddd"),n.find(".sWrap").css("border","1px solid #ddd"),n.find('input[name="name"]').val().length?0==n.find('select[name="type"]').val()?s=lang[123]:(n.find('input[name="name"]').val()&&a.append("name",n.find('input[name="name"]').val()),a.append("price",n.find('input[name="price"]').val()),a.append("intype","service"),a.append("type",Object.keys(n.find('input[name="type_id"]').data()||{}).join(",")),a.append("type_new",n.find('input[name="type_id"]').next().find("input").val()),a.append("category",Object.keys(n.find('input[name="brand"]').data()||{}).join(",")),a.append("category_new",n.find('input[name="brand"]').next().find("input").val()),a.append("model",Object.keys(n.find('input[name="model"]').data()||{}).join(",")),a.append("model_new",n.find('input[name="model"]').next().find("input").val())):(s=lang[16],n.find('input[name="name"]').css("border-color","#f00")),n.find("#forms > .iGroup").each(function(t,e){$(e).find("label").next().val()&&(options[$(e).find("label").next().attr("data-id")]=$(e).find("label").next().val())}),a.append("opts",JSON.stringify(options)),s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t).find('button[type="submit"]'))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/inventory/send_inventory",data:a}).done(function(e){if(loadBtn.stop($(t).find('button[type="submit"]')),e){if(alr.show({class:"alrSuccess",content:lang[122],delay:2}),"cat_exists"==e)alr.show({class:"alrDanger",content:"Brand exists",delay:2});else if("tp_exists"==e)alr.show({class:"alrDanger",content:"Type exists",delay:2});else if("mdl_exists"==e)alr.show({class:"alrDanger",content:"Model exists",delay:2});else if("loc_exists"==e)alr.show({class:"alrDanger",content:"Locations exists",delay:2});else if(e>0){var a={};a[e]={name:n.find('input[name="name"]').val(),price:n.find('input[name="price"]').val()},$('input[name="service"]').data(a),$("#service .sfWrap > div").prepend($("<span/>",{class:"nc",id:e,"data-price":n.find('input[name="price"]').val(),html:n.find('input[name="name"]').val()}).append($("<i/>"))),mdl.close("createDevice")}}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},updateStatus:function(t){$.post("/issues/is_warranty",{id:t},function(e){mdl.open({id:"stUpdate",title:"Update issue",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",id:"status",html:$("<label/>",{html:"Status"})}).append($("<input/>",{type:"hidden",name:"status"})).append($("<ul/>",{class:"hdn"}))}).append($("<div/>",{class:"iGroup fw hdn",id:"req_note",html:$("<label/>",{html:"Status note"})}).append($("<textarea/>",{name:"status_note"}))).append($("<div/>",{class:"iGroup fw",id:"location",warranty:e,html:$("<label/>",{html:"Location"})}).append($("<input/>",{type:"hidden",name:"location"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup fw",id:"sublocation",html:$("<label/>",{html:"Sublocation"})}).append($("<select/>",{name:"sublocation"}))).append($("<div/>",{class:"iGroup price bobject fw",id:"set_inventory",html:$("<label/>",{html:"Inventory"})}).append($("<ul/>"))).append($("<div/>",{class:"iGroup price fw",id:"set_services",html:$("<label/>",{html:"Services"})}).append($("<ul/>"))).append($("<div/>",{class:"iGroup fw price",id:"purchase",html:$("<label/>",{html:"Purchases"})}).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup fw price",html:$("<label/>",{html:"New purchase"})}).append($("<input/>",{type:"text",name:"new_purchase",onblur:"issues.newPur(this)"}))).append($("<div/>",{class:"iGroup tPrice",html:$("<label/>",{html:"Price"})}).append($("<div/>",{html:""}))).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Important note"})}).append($("<input/>",{type:"checkbox",name:"important",checked:$(".descrIssue").hasClass("important")}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"issues.sendUpdate("+t+", this"+(1==e?", 1":"")+")",html:"Send"})})),cb:function(){$("#page").checkbox(),$("#page").select();var t={},a={};location_count=$(".devLocation").attr("location_count"),count_id=location_count,0!=$(".devStatus").attr("data-id")&&(t[$(".devStatus").attr("data-id")]={name:$(".devStatus").text().replace("Status: ","")}),$(".devLocation").text().replace("Location: ","").length&&(a[$(".devLocation").attr("data-id")]={name:$(".devLocation").text().replace("Location: ",""),count:$(".devLocation").attr("data-count")}),$('input[name="status"]').data(t),status_id=t,$(".devLocation").text().replace("Location: ","").length&&(location_id=a,object_id=$(".devLocation").attr("data-object")),count_id=a,$.post("/inventory/allStatuses",{nIds:Object.keys($('input[name="status"]').data()).join(","),set_inventory:Object.keys($('input[name="set_inventory"]').data()).join(","),set_services:Object.keys($('input[name="set_services"]').data()).join(","),warranty:e},function(t){if(t){var a="",n=0;$.each(t.list,function(t,e){a+='<li data-value="'+e.id+'" data-req="'+e.note+'">'+e.name+"</li>",n=e.id}),$("#status > ul").html(a).sForm({action:"/inventory/allStatuses",data:{lId:n,nIds:Object.keys($('input[name="status"]').data()||{}).join(","),query:$("#status > .sfWrap input").val()||"",set_inventory:Object.keys($('input[name="set_inventory"]').data()).join(","),set_services:Object.keys($('input[name="set_services"]').data()).join(","),warranty:e},all:!1,select:$('input[name="status"]').data(),s:!0},$('input[name="status"]'),function(){getLocation(1),issues.reqNote()},{set_inventory:"set_inventory",set_services:"set_services"})}},"json"),$.post("/inventory/all",{type:"stock",noCust:1,nIds:Object.keys($('input[name="set_inventory"]').data()).join(",")},function(t){if(t){var e="",n=0;$.each(t.list,function(t,a){e+='<li data-value="'+a.id+'" data-price="'+currency_val[a.currency||"USD"].symbol+parseFloat(a.price).toFixed(2)+'" data-currency="'+(a.currency||"USD")+'" data-object="'+a.object+'">'+a.name+"</li>",n=a.id}),$("#set_inventory > ul").html(e).sForm({action:"/inventory/all",data:{lId:n,nIds:Object.keys($('input[name="set_inventory"]').data()||{}).join(","),query:$("#set_inventory > .sfWrap input").val()||"",type:"stock",noCust:1},all:!1,select:$('input[name="set_inventory"]').data(),link:"inventory/view"},$('input[name="set_inventory"]'),function(){total.miniTotal(a)})}},"json"),$.post("/purchases/all",{nIds:Object.keys($('input[name="purchase"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'">'+n.name+"</li>",a=n.id}),$("#purchase > ul").html(e).sForm({action:"/purchases/all",data:{nIds:Object.keys($('input[name="purchase"]').data()||{}).join(","),query:$("#purchase > .sfWrap input").val()||""},all:!1,select:$('input[name="purchase"]').data(),link:"purchases/edit"},$('input[name="purchase"]'))}},"json"),$.post("/inventory/all",{type:"service",object:$("#issue").attr("data-object"),nIds:Object.keys($('input[name="set_services"]').data()).join(",")},function(t){if(t){var e="",n=0;$.each(t.list,function(t,a){e+='<li data-value="'+a.id+'" data-price="'+currency_val[a.currency||"USD"].symbol+parseFloat(a.price).toFixed(2)+'" data-currency="'+(a.currency||"USD")+'">'+a.name+"</li>",n=a.id}),$("#set_services > ul").html(e).sForm({action:"/inventory/all",data:{lId:n,type:"service",object:$("#issue").attr("data-object"),nIds:Object.keys($('input[name="set_services"]').data()||{}).join(","),query:$("#set_services > .sfWrap input").val()||""},all:!1,select:$('input[name="set_services"]').data(),link:"inventory/service/edit"},$('input[name="set_services"]'),function(){total.miniTotal(a)})}},"json"),total.miniTotal(a)}})})},reqNote:function(){var t=$('input[name="status"]').data();(t=t[Object.keys(t)[0]]).req?$("#req_note").removeClass("hdn"):$("#req_note").addClass("hdn")},sendUpdate:function(t,e,a){loadBtn.start($(e).find('button[type="submit"]'));var n={id:t},s=$(e).parents(".uForm"),l=null;a&&(n.warranty=1),s.find(".iGroup").each(function(t,e){"descr"!=$(e).find("label").next().attr("name")||$(e).find("label").next().val()?"sublocation"==$(e).find("label").next().attr("name")&&$(e).find("label").next().find('option[value="1"]').length&&"0"==$(e).find("label").next().val()?l="Sublocation can not be empty":$.inArray($(e).find("label").next().attr("name"),["descr","price","new_purchase","salename"])&&$(e).find("label").next().val()?n[$(e).find("label").next().attr("name")]=$(e).find("label").next().val():"sublocation"==$(e).find("label").next().attr("name")&&$(e).find("label").next().val()?n[$(e).find("label").next().attr("name")]=$(e).find("label").next().val():n[$(e).find("label").next().attr("name")]="object"==typeof $(e).find("label").next().data()?Object.keys($(e).find("label").next().data()).join(","):$(e).find("label").next().val():l=lang[100]}),n.inventory_id=$('input[name="inventory_id"]').val(),n.important=$('input[name="important"]').val(),n.status_note=$('textarea[name="status_note"]').val(),n.set_inventory=JSON.stringify($('input[name="set_inventory"]').data()),n.set_services=JSON.stringify($('input[name="set_services"]').data()),n.purchases=JSON.stringify($('input[name="purchase"]').data()),$('input[name="new_purchase"]').val()&&(n.name=$(".pnName").text(),n.photo=$("#addService .pnThumb > img").attr("src"),n.price=$(".pnPrice").text().replace(/(\D*)/i,""),n.itemID=$(".itemId").text(),n.cprice=$('input[name="price"]').val()||0,n.link=$('input[name="new_purchase"]').val(),n.salename=$('input[name="salename"]').val(),0==$('input[name="price"]').val()&&(l="Price can not be 0"),$('input[name="salename"]').val()||(l="Sale name can not be empty")),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(e).find('button[type="submit"]'))):$.post("/issues/send_update",n,function(t){loadBtn.stop($(e).find('button[type="submit"]')),"set_service"==t?alr.show({class:"alrDanger",content:"This status needs enough one service",delay:2}):"set_inventory"==t?alr.show({class:"alrDanger",content:"This status needs enough one part",delay:2}):"assigned"==t?alr.show({class:"alrDanger",content:"You are not assigned to this issue",delay:2}):t>0?(alr.show({class:"alrSuccess",content:lang[74],delay:2}),Page.get(location.href),mdl.close()):"confirmed"==t?alr.show({class:"alrDanger",content:"You can not delete purchases. Someones are already ordered",delay:2}):"receive_purchases"==t?alr.show({class:"alrDanger",content:"You must receive all of the purchases to change the issue status",delay:2}):t.indexOf("min_price")>=0?alr.show({class:"alrDanger",content:"Min price for new purchase must be enought $"+t.split("_")[2],delay:2}):"no_note"==t?alr.show({class:"alrDanger",content:"Please, enter status note",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},pickUp:function(t,e){loadBtn.start($(e).find('button[type="submit"]'));var a={id:t,inventory_id:$('input[name="inventory_id"]').val()};$(e).parents(".uForm");$.post("/issues/pickup",a,function(a){loadBtn.stop($(e).find('button[type="submit"]')),"OK"==a?(alr.show({class:"alrSuccess",content:"Device was successfully picked up",delay:2}),Page.get("/issues/view/"+t),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},DoloadStats:function(t,e){page_stats+=1,$.post("/issues/doload_stats",{page:page_stats,id:e},function(e){$("#ChangeLog .stats_tbl").append(e.content),e.left_count||$(t).addClass("hdn")},"json")},add:function(t,e,a,n){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var s={inventory_id:n,id:a||0},l=$(t),o=null;l.find(".iGroup").each(function(t,e){"descr"!=$(e).find("label").next().attr("name")||$(e).find("label").next().val()?"location"!=$(e).find("label").next().attr("name")||Object.keys($(e).find("label").next().data()).join(",").length?"service"!=$(e).find("label").next().attr("name")||Object.keys($(e).find("label").next().data()).join(",").length?"descr"==$(e).find("label").next().attr("name")&&$(e).find("label").next().val()?s[$(e).find("label").next().attr("name")]=$(e).find("label").next().val():"location"==$(e).find("label").next().attr("name")||"status"==$(e).find("label").next().attr("name")?s[$(e).find("label").next().attr("name")]=Object.keys($(e).find("label").next().data()).join(","):s[$(e).find("label").next().attr("name")]=JSON.stringify($(e).find("label").next().data()):o="Services can not be empty":o="Location can not be empty":o=lang[100],s.inventory_id=$('input[name="inventory_id"]').val(),s.location_count=$('select[name="sublocation"]').val()}),l.find('select[name="sublocation"] > option[value="1"]').length&&0==l.find('select[name="sublocation"]').val()&&(o="Subocation can not be empty"),o?(alr.show({class:"alrDanger",content:o,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/issues/send",s,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t&&parseInt(t)>0?(alr.show({class:"alrSuccess",content:lang[74]+(a?lang[23]:lang[24]),delay:2}),Page.get("/issues/view/"+t)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},del:function(t){$.post("/issues/del",{id:t},function(e){"OK"==e?$("#issue_"+t).length?$("#issue_"+t).remove():Page.get("/"):alr.show({class:"alrDanger",content:lang[9],delay:2})})},addIssue:function(t,e,a,n,s,l,o,c){mdl.open({id:"addIssue",title:lang[99],content:$("<form/>",{method:"post",onsubmit:"issues.add(this, event,"+t+");",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[98]})}).append($("<label/>",{class:"mdlInfo",html:e}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[97]})}).append($("<label/>",{class:"mdlInfo",html:a}))).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[96]})}).append($("<textarea/>",{name:"descr",html:t?$("#issue_"+t+" > .isDescr").text().trim():""}))).append($("<div/>",{class:"iGroup sfGroup",id:"service",html:$("<label/>",{html:lang[95]})}).append($("<input/>",{type:"hidden",name:"service"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup sfGroup",id:"inventory",html:$("<label/>",{html:lang[94]})}).append($("<input/>",{type:"hidden",name:"inventory"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup sfGroup",id:"status",html:$("<label/>",{html:lang[93]})}).append($("<input/>",{type:"hidden",name:"status"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"iGroup sfGroup",id:"location",html:$("<label/>",{html:lang[92]})}).append($("<input/>",{type:"hidden",name:"location"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"submit",html:lang[91]})}).append($("<button/>",{class:"btn btnPurchase",html:lang[90],onclick:"issues.makePur(); return false;"}))),cb:function(){t&&getLocation(),$.post("/inventory/allStatuses",{nIds:Object.keys($('input[name="status"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#status > ul").html(e).sForm({action:"/inventory/allStatuses",data:{lId:a,nIds:Object.keys($('input[name="status"]').data()||{}).join(","),query:$("#status > .sfWrap input").val()||""},all:t.count<=20,select:$('input[name="status"]').data(),s:!0},$('input[name="status"]'))}},"json"),$.post("/inventory/all",{type:"stock",nIds:Object.keys($('input[name="inventory"]').data()).join(",")+(t?", "+t:"")},function(e){if(e){var a="",n=0;$.each(e.list,function(t,e){a+='<li data-value="'+e.id+'">'+e.name+"</li>",n=e.id}),$("#inventory > ul").html(a).sForm({action:"/inventory/all",data:{type:"stock",lId:n,nIds:Object.keys($('input[name="inventory"]').data()||{}).join(",")+(t?","+t:""),query:$("#inventory > .sfWrap input").val()||""},all:e.count<=20,select:$('input[name="inventory"]').data(),link:"inventory/view"},$('input[name="inventory"]'))}},"json"),$.post("/inventory/all",{type:"service",nIds:Object.keys($('input[name="service"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#service > ul").html(e).sForm({action:"/objects/all",data:{type:"service",lId:a,nIds:Object.keys($('input[name="service"]').data()||{}).join(","),query:$("#service > .sfWrap input").val()||""},all:t.count<=20,select:$('input[name="service"]').data(),link:"inventory/service/edit"},$('input[name="service"]'))}},"json")}})},toggleList:function(t,e){$(e.target).parents(".td").hasClass("w100")||$(e.target).parents(".td").hasClass("w5")||$(t).toggleClass("open").next().slideToggle()},addPur:function(t,e,a){mdl.open({id:"addPurchase",title:lang[89],content:$("<div/>",{html:$("<div/>",{class:"iGroup sfGroup fw",id:"object",html:$("<label/>",{html:"Store"})}).append($("<input/>",{type:"hidden",name:"object"})).append($("<ul/>"))}).append($("<div/>",{class:"iGroup sfGroup fw price bobject",id:"purchase",pIds:e,html:$("<label/>",{html:lang[66]})}).append($("<ul/>"))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"New purchase"})}).append($("<input/>",{type:"text",name:"new_purchase",onblur:"issues.newPur(this)"}))).append($("<div/>")).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"issues.sendPur(this, "+t+", '"+e+"', '"+a+"');",html:lang[42]})})),cb:function(){$.post("/invoices/objects",{},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-tax="'+n.tax+'">'+n.name+"</li>",a=n.id}),$("#object > ul").html(e).sForm({action:"/invoices/objects",data:{lId:a,query:$("#object> .sfWrap input").val()||""},all:t.count<=20,select:$('input[name="object"]').data(),s:!0},$('input[name="object"]'),issues.cbPur)}},"json"),issues.cbPur()}})},cbPur:function(){$("#purchase > ul").length||($("#purchase > .sfWrap").remove(),$("#purchase").append($("<ul/>"))),$.post("/purchases/all",{nIds:Object.keys($('input[name="purchase"]').data()).join(","),store:1,object_id:Object.keys($('input[name="object"]').data())[0]},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-object="'+n.object+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'">'+n.name+"</li>",a=n.id}),$("#purchase > ul").html(e).sForm({action:"/purchases/all",data:{nIds:Object.keys($('input[name="purchase"]').data()||{}).join(","),query:$("#purchase > .sfWrap input").val()||"",store:1,object_id:Object.keys($('input[name="object"]').data())[0]},all:t.count<=20,select:$('input[name="purchase"]').data(),link:"purchases/edit"},$('input[name="purchase"]'))}},"json")},newPur:function(t){$(t).parent().next().empty(),$.get("/parser?lnk="+t.value,function(e){switch(e){case"no_responce":alr.show({class:"alrDanger",content:lang[13],delay:2});break;default:var a=e.title,n=e.image||"",s=e.price,l=e.code;$(t).parent().next().append($("<div/>",{class:"pnThumb",html:n?$("<img/>",{src:n}):""})).append($("<div/>",{class:"pNewText",html:$("<div/>",{class:"pnName",html:a})})).append($("<div/>",{class:"itemId",html:l})).append($("<div/>",{class:"pnPrice",html:s})).append($("<input/>",{type:"number",class:"npPrice",name:"price",step:"0.001",min:"0",placeholder:"Sale price"})).append($("<input/>",{type:"text",class:"npPrice",name:"salename",placeholder:"Sale name"}))}},"json")},sendPur:function(t,e,a){form=$(t).parent().parent().parent();var n=new FormData,s=null;n.append("id",e),n.append("field","purchase_info"),loadBtn.start($(t)),$('input[name="purchase"]').data()||form.find('input[name="new_purchase"]').data()?$('input[name="purchase"]').data()&&(n.append("value",JSON.stringify($('input[name="purchase"]').data()||{})),form.find('input[name="new_purchase"]').val()&&(n.append("cid",a),n.append("name",$(".pnName").text()),n.append("photo",$("#addPurchase .pnThumb > img").attr("src")),n.append("price",$(".pnPrice").text().replace(/(\D*)/i,"")),n.append("itemID",$(".itemId").text()),n.append("cprice",$('input[name="price"]').val()||0),n.append("salename",$('input[name="salename"]').val()),n.append("link",$('input[name="new_purchase"]').val()),0==$('input[name="price"]').val()&&(s="Price can not be 0"),$('input[name="salename"]').val()||(s="Sale name can not be empty"))):s=lang[88],s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/issues/send_field",data:n}).done(function(a){loadBtn.stop($(t)),"OK"==a?(alr.show({class:"alrSuccess",content:lang[87]+(e?lang[23]:lang[24]),delay:2}),Page.get(location.href),mdl.close("addPurchase")):a.indexOf("min_price")>=0?alr.show({class:"alrDanger",content:"Min price for new purchase must be enought $"+a.split("_")[2],delay:2}):"confirmed"==a?alr.show({class:"alrDanger",content:"You can not delete purchases. Someones are already ordered",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addInv:function(t,e,a,n,s){name="stock"==a?"inventory":"service",mdl.open({id:"addService",title:lang[84]+(n?lang[85]:lang[86]),content:$("<div/>",{html:$("<div/>",{class:"iGroup sfGroup fw",id:"object",html:$("<label/>",{html:"Store"})}).append($("<input/>",{type:"hidden",name:"object"})).append($("<ul/>"))}).append($("<div/>",{class:"iGroup sfGroup fw price"+("stock"==a?" bobject":""),id:name,html:$("<label/>",{html:n?lang[82]:lang[83]})}).append($("<input/>",{type:"hidden",name:name})).append($("<ul/>"))).append("service"==a?$("<div/>",{class:"iGroup fw price bobject hdn reqP",id:"inventory",html:$("<label/>",{html:"Inventory"})}).append($("<ul/>",{class:"hdn"})):"").append("service"==a?$("<div/>",{class:"iGroup fw price hdn reqP bobject",id:"purchase",html:$("<label/>",{html:"Purchases"})}).append($("<ul/>",{class:"hdn"})):"").append("service"==a?$("<div/>",{class:"iGroup fw price hdn reqP",html:$("<label/>",{html:"New purchase"})}).append($("<input/>",{type:"text",name:"new_purchase",onblur:"issues.newPur(this)"})):"").append("service"==a?$("<div/>",{class:"hdn reqP"}):"").append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"issues.sendInv(this, "+t+", '"+(n?"stock":"service")+"', '"+e+"', '"+s+"');",html:lang[42]})})),cb:function(){$.post("/invoices/objects",{},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-tax="'+n.tax+'">'+n.name+"</li>",a=n.id}),$("#object > ul").html(e).sForm({action:"/invoices/objects",data:{lId:a,query:$("#object> .sfWrap input").val()||""},all:t.count<=20,select:$('input[name="object"]').data(),s:!0},$('input[name="object"]'),issues.cbInv)}},"json"),issues.cbInv(),"service"==a&&$('input[name="'+name+'"]').data($('input[name="set_services"]').data()),"stock"==a&&$('input[name="'+name+'"]').data($('input[name="set_inventory"]').data()),"service"==a&&issues.reqParts()}})},cbInv:function(){var t=$('input[name="service"]').length?"service":"inventory";$("#"+t+" > ul").length||($("#"+t+" > .sfWrap").remove(),$("#"+t).append($("<ul/>"))),$.post("/inventory/all",{type:$('input[name="service"]').length?"service":"stock",noCust:1,nIds:Object.keys($('input[name="'+t+'"]').data()).join(","),oId:Object.keys($('input[name="object"]').data())[0]},function(e){if(e){var a="",n=0;$.each(e.list,function(t,e){a+='<li data-value="'+e.id+'" data-price="'+currency_val[e.currency||"USD"].symbol+parseFloat(e.price).toFixed(2)+'" data-currency="'+(e.currency||"USD")+'"'+($('input[name="inventory"]').length?' data-object="'+e.object+'"':"")+">"+e.name+"</li>",n=e.id}),$("#"+t+" > ul").html(a).sForm({action:"/inventory/all",data:{type:$('input[name="service"]').length?"service":"stock",lId:n,nIds:Object.keys($('input[name="'+t+'"]').data()).join(","),query:$("#"+t+" > .sfWrap input").val()||"",oId:Object.keys($('input[name="object"]').data())[0]},all:!1,select:$('input[name="'+t+'"]').data(),link:"inventory/"+($('input[name="service"]').length?"service/edit":"view")},$('input[name="'+t+'"]'),$('input[name="service"]').length?issues.reqParts:"")}},"json"),"service"==t&&($("#inventory > ul").length||($("#inventory > .sfWrap").remove(),$("#inventory").append($("<ul/>"))),$.post("/inventory/all",{type:"stock",noCust:1,nIds:Object.keys($('input[name="set_inventory"]').data()).join(","),oId:Object.keys($('input[name="object"]').data())[0]},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-object="'+n.object+'">'+n.name+"</li>",a=n.id}),$("#inventory > ul").html(e).sForm({action:"/inventory/all",data:{type:"stock",lId:a,nIds:Object.keys($('input[name="set_inventory"]').data()).join(","),query:$("#inventory > .sfWrap input").val()||"",oId:Object.keys($('input[name="object"]').data())[0]},all:!1,select:$('input[name="set_inventory"]').data(),link:"inventory/view"},$('input[name="set_inventory"]'))}},"json"),$.post("/purchases/all",{nIds:Object.keys($('input[name="purchase"]').data()).join(","),object_id:Object.keys($('input[name="object"]').data())[0]},function(t){if($("#purchase > ul").length||($("#purchase > .sfWrap").remove(),$("#purchase").append($("<ul/>"))),t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-object="'+n.object+'">'+n.name+"</li>",a=n.id}),$("#purchase > ul").html(e).sForm({action:"/purchases/all",data:{nIds:Object.keys($('input[name="purchase"]').data()||{}).join(","),query:$("#purchase > .sfWrap input").val()||"",object_id:Object.keys($('input[name="object"]').data())[0]},all:!1,select:$('input[name="purchase"]').data(),link:"purchases/edit"},$('input[name="purchase"]'))}},"json"))},reqParts:function(){var t=0;$.each($('input[name="service"]').data(),function(e,a){a.req&&(t=1)}),t?$(".reqP").removeClass("hdn"):$(".reqP").addClass("hdn"),p=($(window).height()-$("#addService > .mdl").height())/2,$("#addService").css("padding-top",(p<20?20:p)+"px")},sendInv:function(t,e,a,n){form=$(t).parent().parent().parent();var s=new FormData,l=null,o="stock"==a?"inventory":"service";s.append("id",e),s.append("field","stock"==a?"inventory_info":"service_info"),loadBtn.start($(t)),form.find('input[name="'+o+'"]').data()?(s.append("value",JSON.stringify(form.find('input[name="'+o+'"]').data())),s.append("inventory",JSON.stringify($('input[name="set_inventory"]').data())),s.append("purchases",JSON.stringify($('input[name="purchase"]').data())),$('input[name="new_purchase"]').val()&&(s.append("cid",n),s.append("name",$(".pnName").text()),s.append("photo",$("#addService .pnThumb > img").attr("src")),s.append("price",$(".pnPrice").text().replace(/(\D*)/i,"")),s.append("itemID",$(".itemId").text()),s.append("cprice",$('input[name="price"]').val()||0),s.append("link",$('input[name="new_purchase"]').val()),s.append("salename",$('input[name="salename"]').val()),0==$('input[name="price"]').val()&&(l="Price can not be 0"),$('input[name="salename"]').val()||(l="Sale name can not be empty"))):l=lang[81],l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(t))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/issues/send_field",data:s}).done(function(a){loadBtn.stop($(t)),"OK"==a?(alr.show({class:"alrSuccess",content:lang[74]+(e?lang[23]:lang[24]),delay:2}),Page.get(location.href),mdl.close("addService")):"min_price"==a?alr.show({class:"alrDanger",content:"Min sale price can not be less than $"+parseFloat(min_price(parseFloat($(".pnPrice").text().replace(/(\D*)/i,"").replace(",","")))).toFixed(2),delay:2}):a.indexOf("min_price")>=0?alr.show({class:"alrDanger",content:"Min price for new purchase must be enought $"+a.split("_")[2],delay:2}):"req"==a?alr.show({class:"alrDanger",content:"You must enough one inventory or part to use this services",delay:2}):"confirmed"==a?alr.show({class:"alrDanger",content:"You can not delete purchases. Someones are already ordered",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delInv:function(t,e,a){var n={id:a,field:"stock"==e?"inventory_info":"service_info",value:t},s=$('input[name="'+("stock"==e?"set_inventory":"set_services")+'"]').data();delete s[t],n.value=JSON.stringify(s),$.post("/issues/del_field",n,function(a){if("OK"==a){alr.show({class:"alrSuccess",content:lang[74]+(t?lang[23]:lang[24]),delay:2}),"service"==e&&($("#service_com_"+t).remove(),$("#sSteps_"+t).remove(),$("#miniService_"+t).remove()),$("#"+("stock"==e?"inventory_":"service_")+t).remove(),total.fTotal();var n=$('input[name="'+("stock"==e?"set_inventory":"set_services")+'"]').data();delete n[t],$('input[name="'+("stock"==e?"set_inventory":"set_services")+'"]').removeData().data(n)}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},addStep:function(t,e){var a={id:e,sId:$(t).parent().parent().attr("id").replace("sSteps_",""),value:$(t).attr("id"),del:$(t).hasClass("done")?1:0},n=$(t).parents(".servSteps").find(".servTitle");$.post("/issues/send_step",a,function(e){"OK"!=e?alr.show({class:"alrDanger",content:lang[13],delay:2}):($(t).toggleClass("done"),n.find(".num").text($(t).hasClass("done")?parseInt(n.find(".num").text())+1:parseInt(n.find(".num").text())-1),n.find(".number").text((parseInt(n.find(".num").text())/parseInt(n.find(".full").text())*100).toFixed(0)))})},editDoit:function(t,e){$("#doit").hide().after($("<input/>",{type:"number",min:0,name:"doit",value:parseInt($("#doit").text())})),$("#doitBtn").removeClass("fa-pencil").addClass("fa-check").parent().attr("href","javascript:issues.sendDoit("+t+")")},editQuote:function(t,e){$("#quote").hide().after($("<input/>",{type:"number",min:0,name:"quote",value:parseInt($("#quote").text())})),$("#quoteBtn").removeClass("fa-pencil").addClass("fa-check").parent().attr("href","javascript:issues.sendQuote("+t+")")},sendDoit:function(t,e){var a={id:t,field:"doit",value:0,full:1},n=null;$('input[name="doit"]').val()?a.value=$('input[name="doit"]').val():(n=lang[80],$('input[name="doit"]').css("border-color","#f00")),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(event.target))):$.post("/issues/send_field",a,function(e){loadBtn.stop($(event.target)),e?(alr.show({class:"alrSuccess",content:lang[75],delay:2}),$("#doit").text("$"+parseFloat(a.value).toFixed(2)).show().next().remove(),$("#doitBtn").removeClass("fa-check").addClass("fa-pencil").parent().attr("href","javascript:issues.editDoit("+t+")")):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendQuote:function(t,e){var a={id:t,field:"quote",value:0,full:1},n=null;$('input[name="quote"]').val()?a.value=$('input[name="quote"]').val():(n=lang[80],$('input[name="quote"]').css("border-color","#f00")),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(event.target))):$.post("/issues/send_field",a,function(e){loadBtn.stop($(event.target)),e?(alr.show({class:"alrSuccess",content:lang[75],delay:2}),$("#quote").text("$"+parseFloat(a.value).toFixed(2)).show().next().remove(),$("#quoteBtn").removeClass("fa-check").addClass("fa-pencil").parent().attr("href","javascript:issues.editQuote("+t+")")):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addComment:function(t,e){mdl.open({id:"addComment",title:lang[79],content:$("<div/>",{class:"form",html:$("<div/>",{class:"iGroup fw",html:$("<textarea/>",{id:"comment",html:$("#service_com_"+t+" > span").text()})})}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",type:"button",onclick:"issues.sendComment('"+t+"', "+e+");",html:lang[79]})}))})},sendComment:function(t,e){var a={id:e,sId:t,value:$("#comment").val(),del:0};$.post("/issues/send_comment",a,function(t){"OK"!=t?alr.show({class:"alrDanger",content:lang[13],delay:2}):(Page.get(location.href),mdl.close())})},addNote:function(t){var e={id:t};$('textarea[name="note"]').css("border-color","#ddd"),$('textarea[name="note"]').val()?(e.note=$('textarea[name="note"]').val(),$.post("/issues/send_note",e,function(t){"OK"==t?(alr.show({class:"alrSuccess",content:lang[77],delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})):($('textarea[name="note"]').css("border-color","#f00"),alr.show({class:"alrDanger",content:lang[78],delay:2}))},pPrice:function(t,e,a,n){$(t).attr("ondblclick","").html($("<input/>",{type:"number",name:"pPrice",step:"0.1",min:"0",old:parseFloat($(t).text()),value:parseFloat($(t).text()),onblur:"issues.sendPPrice(this, '"+e+"', "+a+", '"+n+"')"})),$('input[name="pPrice"]').focus()},sendPPrice:function(t,e,a,n){var s={id:a,value:0,pur:e,type:n,old:$('input[name="pPrice"]').attr("old")},l=null;if($('input[name="pPrice"]').val())if(parseFloat($('input[name="pPrice"]').val())<parseFloat($('input[name="pPrice"]').attr("old")))l="You can only increase price";else{var o="purchase_info"==n?"purchase":"inventory_info"==n?"set_inventory":"set_services",c=$('input[name="'+o+'"]').data();c[e].price=$('input[name="pPrice"]').val(),$('input[name="'+o+'"]').data(c),s.value=JSON.stringify(c)}else l=lang[76],$('input[name="pPrice"]').css("border-color","#f00");l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(event.target))):$('input[name="pPrice"]').val()==$('input[name="pPrice"]').attr("old")?$(t).parent().text($('input[name="pPrice"]').val()).attr("ondblclick","issues.pPrice(this, '"+e+"', "+a+", '"+n+"')"):$.post("/issues/send_price",s,function(s){loadBtn.stop($(event.target)),s?"less"==s?alr.show({class:"alrDanger",content:"You can only increase price",delay:2}):(alr.show({class:"alrSuccess",content:lang[75],delay:2}),"service_info"==n?($("#miniService_"+e).find(".msPrice").text($('input[name="pPrice"]').val()).attr("ondblclick","issues.pPrice(this, '"+e+"', "+a+", '"+n+"')"),$("#service_"+e).find(".servPrice").text($('input[name="pPrice"]').val()).attr("ondblclick","issues.pPrice(this, '"+e+"', "+a+", '"+n+"')")):$(t).parent().text($('input[name="pPrice"]').val()).attr("ondblclick","issues.pPrice(this, '"+e+"', "+a+", '"+n+"')"),total.fTotal()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delPur:function(t,e){var a={id:e,field:"purchase_info",value:t,value_id:t,del:!0},n=$('input[name="purchase"]').data();delete n[t],a.value=JSON.stringify(n),$.post("/issues/del_field",a,function(e){if("OK"==e){alr.show({class:"alrSuccess",content:lang[74]+(t?lang[23]:lang[24]),delay:2}),$("#purchase_"+t).remove(),total.fTotal();var a=$('input[name="purchase"]').data();delete a[t],$('input[name="purchase"]').removeData().data(a)}else"confirmed"==e?alr.show({class:"alrDanger",content:"You can not delete this purchase, it's already ordered",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})}},tax=0,invoices={sendDiscountCode:function(t,e){loadBtn.start($(e)),$('input[name="dis_code"]').val()?$.post("/invoices/add_discount_code",{id:t,code:$('input[name="dis_code"]').val()},function(t){loadBtn.stop($(e)),"OK"==t?(alr.show({class:"alrSuccess",content:"Code successfully added",delay:2}),Page.get(location.href)):"no_user"==t?alr.show({class:"alrDanger",content:"It's not customer's discount code",delay:2}):"no_date"==t?alr.show({class:"alrDanger",content:"Code has expired",delay:2}):"no_code"==t?alr.show({class:"alrDanger",content:"Code does not exist",delay:2}):"used"==t?alr.show({class:"alrDanger",content:"Code is already used",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})}):alr.show({class:"alrDanger",content:"Please, enter code",delay:2})},addStoreDiscount:function(t,e){mdl.open({id:"addDiscountCode",title:"Enter discount code",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Discount code"})}).append($("<input/>",{type:"text",name:"dis_code"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"invoices.sendDiscountCode("+t+", this);",html:"Send"})}))})},createEsimate:function(t){Object.keys($('input[name="customer"]').data())[0]?$.post("/invoices/send_estimate",{id:t,customer:Object.keys($('input[name="customer"]').data())[0]},function(e){"OK"==e?(alr.show({class:"alrSuccess",content:"You successfully created invoice",delay:2}),Page.get("/invoices/view/"+t)):alr.show({class:"alrDanger",content:lang[13],delay:2})}):alr.show({class:"alrDanger",content:"Plese, select customer",delay:2})},estimateToInv:function(t){mdl.open({id:"estimate",title:"Select customer",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw",id:"customer",html:$("<label/>",{html:"Customer"})}).append($("<input/>",{type:"hidden",name:"customer"})).append($("<ul/>"))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",html:"Send",onclick:"invoices.createEsimate("+t+")"})})),cb:function(){$.post("/users/all",{gId:5,nIds:Object.keys($('input[name="customer"]').data()).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#customer > ul").html(e).sForm({action:"/users/all",data:{gId:5,lId:a,nIds:Object.keys($('input[name="customer"]').data()||{}).join(","),query:$("#customer > .sfWrap input").val()||""},all:!1,select:$('input[name="customer"]').data(),s:!0,link:"users/view"},$('input[name="customer"]'))}},"json")}})},confirmDiscountInvoice:function(t){$.post("/invoices/confirm_discount_invoise",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Discount was successfully confirmed",delay:2}),Page.get(location.href)):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to this action",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},refundDecline:function(t){$.post("/invoices/refund_decline",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Refund was successfully declined",delay:2}),Page.get(location.href)):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to this action",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendRefundRequest:function(t){$.post("/invoices/refund_request",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Refund request was successfully sent",delay:2}),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},refundConfirm:function(t){$.post("/invoices/refund_confirm",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Refund was successfully confirmed",delay:2}),Page.get(location.href)):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to this action",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},refundRequest:function(t){mdl.open({id:"mdlRefund",title:"Refund request",content:$("<div/>",{class:"conQuestion",html:$("<div/>",{html:"Are you sure?"})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",type:"button",onclick:"invoices.sendRefundRequest("+t+");",html:"Yes"})}).append($("<button/>",{class:"btn btnSubmit dc",type:"button",onclick:"mdl.close();",html:"No"})))})},send_mail:function(t){$.post("/invoices/send_mail/",{id:t},function(t){"OK"==t?alr.show({class:"alrSuccess",content:"Mail was successfully sent",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},openDiscount:function(t,e,a,n){$.post("/users/is_admin",{},function(n){mdl.open({id:"openDiscount",title:(t?lang[17]:lang[18])+" Discount",content:'<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[73]+'</label>\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[72]+'</label>\t\t\t\t\t\t\t<input type="number" name="percent" value="'+(a||0)+'" step="0.1" min=""0>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t'+($("#discount_"+t).hasClass("not-confirmed")&&"OK"==n?'<button class="btn btnSubmit left" onclick="invoices.confirmDiscount(this, '+(t||0)+')">Confirm</button>':"")+'\t\t\t\t\t\t\t<button class="btn btnSubmit" onclick="invoices.sendDiscount(this, '+(t||0)+')">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t</div>"})})},confirmDiscount:function(t,e){loadBtn.start($(t)),$.post("/invoices/confirm_discount",{id:e},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Discount was successfully confirmed",delay:2}),$("#discount_"+e).removeClass("not-confirmed").addClass("confirmed"),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},sendDiscount:function(t,e){var a={id:e},n=null;(t=$(t).parents(".mdlBody")).find("input").css("border-color","#ddd"),loadBtn.start(t.find('button[type="submit"]')),t.find('input[name="name"]').val()?t.find('input[name="percent"]').val()?(a.name=t.find('input[name="name"]').val(),a.percent=t.find('input[name="percent"]').val()):(n=lang[25],t.find('input[name="percent"]').css("border-color","#f00")):(n=lang[25],t.find('input[name="name"]').css("border-color","#f00")),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop(t.find('button[type="submit"]'))):$.post("/invoices/send_discount",a,function(e){loadBtn.stop(t.find('button[type="submit"]')),e?(alr.show({class:"alrSuccess",content:lang[71],delay:2}),mdl.close("openDiscount"),$(".userList").prepend($("<div/>",{class:"sUser "+e.confirmed,id:"discount_"+e.id,html:$("<a/>",{class:"uInfo",html:a.name})}).append($("<div/>",{class:"pInfo",html:a.percent})).append($("<div/>",{class:"uMore",html:$("<span/>",{class:"fa fa-ellipsis-h",onclick:"$(this).next().toggle(0)"})}).append($("<ul/>",{html:$("<li>",{html:$("<a/>",{href:"javascript:invoices.openDiscount("+e.id+', "'+a.name+'", '+a.percent+")",html:$("<span/>",{class:"fa fa-pencil"})}).append(lang[70])})}).append($("<li>",{html:$("<a/>",{href:"javascript:invoices.delDiscount("+e.id+")",html:$("<span/>",{class:"fa fa-times"})}).append(lang[69])})))))):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delDiscount:function(t){$.post("/invoices/del_discount",{id:t},function(e){"OK"==e?$("#discount_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},addInventory:function(){mdl.open({id:"addInv",title:lang[18],width:600,content:$("<div/>",{class:"form",html:$("<div/>",{class:"tabs",html:$("<div/>",{class:"tab","data-title":lang[68],id:"inv",html:$("<div/>",{id:"inventory",class:"iGroup price quantity",html:$("<ul/>")})})}).append($("<div/>",{class:"tab","data-title":lang[67],id:"serv",html:$("<div/>",{id:"services",class:"iGroup price",html:$("<ul/>")})})).append($("<div/>",{class:"tab","data-title":"Order parts",id:"purch",html:$("<div/>",{id:"purchases",class:"iGroup",html:$("<ul/>")})}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"New purchase"})}).append($("<input/>",{type:"text",name:"new_purchase",onblur:"issues.newPur(this)"}))).append($("<div/>"))).append($("<div/>",{class:"tab","data-title":"Buy from customer",id:"buy_inventory",html:$("<div/>",{id:"tradein",class:"iGroup",html:$("<ul/>")})}).append($("<div/>",{class:"newTradeins",id:"newTradein",html:$("<table/>",{class:"tradein_table",html:$("<thead/>",{html:$("<tr/>",{html:$("<th/>",{html:"Name"})}).append($("<th/>",{html:"Purchase price"})).append($("<th/>",{html:"Sale price"}))})}).append($("<tbody/>"))})))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"invoices.chooseInv();",html:lang[65]})})),cb:function(){$("#page").tabs(),$.post("/inventory/all",{noCust:1,type:"stock",nIds:Object.keys($('input[name="inventory"]').data()||{}).join(","),oId:Object.keys($('input[name="object"]').data()||{}).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-catname="'+n.catname+'" data-quantity="'+n.quantity+'">'+n.name.replace("'","")+"</li>",a=n}),$("#inventory > ul").html(e).sForm({action:"/inventory/all",data:{lId:a,noCust:1,type:"stock",nIds:Object.keys($('input[name="inventory"]').data()||{}).join(","),query:$("#inventory > .sfWrap input").val()||""},all:!1,select:$('input[name="inventory"]').data(),link:"inventory/view"},$('input[name="inventory"]'))}},"json"),$.post("/inventory/all",{noCust:1,type:"service",object:Object.keys($('input[name="object"]').data())[0]},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-catname="'+n.catname+'">'+n.name.replace("'","")+"</li>",a=n}),$("#services > ul").html(e).sForm({action:"/inventory/all",data:{lId:a,noCust:1,type:"service",object:Object.keys($('input[name="object"]').data())[0],query:$("#services > .sfWrap input").val()||""},all:!1,select:$('input[name="services"]').data(),link:"inventory/service/edit"},$('input[name="services"]'))}},"json"),$.post("/purchases/all",{nIds:Object.keys($('input[name="purchases"]').data()||{}).join(",")},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price.replace(/[^0-9.]/g,"").trim()).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-catname="">'+n.name.replace("'","")+"</li>",a=n}),$("#purchases > ul").html(e).sForm({action:"/purchases/all",data:{lId:a,nIds:Object.keys($('input[name="purchases"]').data()||{}).join(","),query:$("#purchases > .sfWrap input").val()||""},all:!1,select:$('input[name="purchases"]').data(),link:"purchases/edit"},$('input[name="purchases"]'))}},"json"),$.post("/inventory/all",{nIds:Object.keys($('input[name="purchases"]').data()||{}).join(","),user:Object.keys($('input[name="customer"]').data()||{}).join(","),by_user:1},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'" data-price="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.price.replace(/[^0-9.]/g,"").trim()).toFixed(2)+'" data-purchase="'+currency_val[n.currency||"USD"].symbol+parseFloat(n.purchase.replace(/[^0-9.]/g,"").trim()).toFixed(2)+'" data-currency="'+(n.currency||"USD")+'" data-catname="">'+n.name.replace("'","")+"</li>",a=n}),$("#tradein > ul").html(e).sForm({action:"/inventory/all",data:{lId:a,nIds:Object.keys($('input[name="tradein"]').data()||{}).join(","),query:$("#tradein > .sfWrap input").val()||"",user:Object.keys($('input[name="customer"]').data()||{}).join(","),by_user:1},all:!1,select:$('input[name="tradein"]').data(),link:"inventory/view"},$('input[name="tradein"]'),invoices.newTradein)}},"json")}})},newTradein:function(){var t=Object.keys($('input[name="tradein"]').data());console.log(t),$("#newTradein tbody > tr").each(function(e,a){$.inArray($(a).attr("data-id"),t)<0&&$(a).remove()}),$('input[name="tradein"]').data()?$.each($('input[name="tradein"]').data(),function(t,e){$("#trade_mdl_"+t).length||$("#newTradein tbody").append($("<tr/>",{id:"trade_mdl_"+t,"data-id":t,html:$("<td/>",{class:"tr_name",currency:e.currency,html:e.name})}).append($("<td/>",{class:"tr_purchase",html:$("<input/>",{type:"number",step:"0.001",name:"purchase",value:e.purchase})})).append($("<td/>",{class:"tr_sale",html:$("<input/>",{type:"number",step:"0.001",name:"sale",value:e.price})})))}):$("#newTradein tbody").clear()},chooseInv:function(){var t={};$("#newTradein tbody > tr").length?($("#newTradein tbody > tr").each(function(e,a){t[$(a).attr("data-id")]={name:$(a).find(".tr_name").text(),purchase:$(a).find(".tr_purchase > input").val(),price:$(a).find(".tr_sale > input").val(),currency:$(a).find(".tr_name").attr("currency")},$(a).find('input[name="sale"]').css("border-color","#ddd"),$(a).find('input[name="purchase"]').css("border-color","#ddd")}),$('input[name="tradein"]').removeData().data(t),$.post("/invoices/send_prices",{tradein:t,object:Object.keys($('input[name="object"]').data())[0]},function(t){"OK"==t?invoices.sendPurchase():t.length?"min_price"==(t=JSON.parse(t)).error?($.each(t.ids,function(t,e){$("#trade_mdl_"+e+' input[name="sale"]').css("border-color","#f00")}),alr.show({class:"alrDanger",content:"Check min prices for sale",delay:2})):"empty_price"==t.error&&($("#trade_mdl_"+t.id+' input[name="sale"]').css("border-color","#f00"),$("#trade_mdl_"+t.id+' input[name="purchase"]').css("border-color","#f00"),alr.show({class:"alrDanger",content:"Prices can not be empty",delay:2})):alr.show({class:"alrDanger",content:lang[13],delay:2})})):invoices.sendPurchase()},sendPurchase:function(){var t=new FormData;$('input[name="new_purchase"]').val().length?$('input[name="price"]').val()?$('input[name="salename"]').val()?(t.append("name",$(".pnName").text()),t.append("photo",$("#purch .pnThumb > img").attr("src")),t.append("price",$(".pnPrice").text().replace(/(\D*)/i,"")),t.append("cprice",$('input[name="price"]').val()),t.append("salename",$('input[name="salename"]').val()),t.append("itemID",$(".itemId").text()),t.append("link",$('input[name="new_purchase"]').val()),t.append("customer_id",Object.keys($('input[name="customer"]').data())[0]),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/invoices/newPurchase",data:t}).done(function(t){if(console.log(t),loadBtn.stop($(event.target)),"min_price"==t)alr.show({class:"alrDanger",content:"Min sale price can not be less than $"+parseFloat(min_price(parseFloat($(".pnPrice").text().replace(/(\D*)/i,"")))).toFixed(2),delay:2});else if(t>0){alr.show({class:"alrSuccess",content:"Purchase successfully created",delay:2});var e=$('input[name="purchases"]').data();e[t]={name:$(".pnName").text(),price:$('input[name="price"]').val()},$('input[name="purchases"]').data(e),invoices.selectAll()}else alr.show({class:"alrDanger",content:lang[13],delay:2})})):alr.show({class:"alrDanger",content:"Please enter sale name",delay:2}):alr.show({class:"alrDanger",content:"Please enter sale price",delay:2}):invoices.selectAll()},selectAll:function(){if(Object.keys($('input[name="inventory"]').data()).join(",")||Object.keys($('input[name="tradein"]').data()).join(",")||Object.keys($('input[name="services"]').data()).join(",")||Object.keys($('input[name="invoices"]').data()).join(",")||Object.keys($('input[name="purchases"]').data()).join(",")){var t=$('input[name="inventory"]').data(),e=$('input[name="services"]').data(),a=($('input[name="invoices"]').data(),$('input[name="purchases"]').data()),n=$('input[name="tradein"]').data();invoices.eachService(t,"stock"),invoices.eachService(e,"service"),invoices.eachService(a,"purchase"),invoices.eachService(n,"tradein"),mdl.close("addInv"),invoices.total()}else alr.show({class:"alrDanger",content:"You did not choose the service!",delay:2})},eachService:function(t,e){t&&$.each(t,function(t,a){$(".mInvoice #tr_"+e+"_"+t).length||$(".tbl.payInfo.mInvoice").append($("<div/>",{class:"tr itm",id:"tr_"+e+"_"+t,"data-id":t,"data-type":e,html:$("<div/>",{class:"td",html:$("<span/>",{class:"fa fa-times del",onclick:'invoices.delInvItem(this, "'+e+'", '+t+")"})}).append(" "+a.name)}).append($("<div/>",{class:"td w10",html:"stock"==e?$("<input/>",{type:"number",name:"quantity",class:"quickEdit",max:a.quantity,min:"1",value:"1",onchange:"changeQuantity(this);",onkeyup:"changeQuantity(this);"}):"1"})).append($("<div/>",{class:"td w100"+("tradein"==e?" nPay trIn":""),price:a.price,ondblclick:"tradein"==e?"":"invoices.changeMorePrice(this, "+t+", '"+e+"');",html:currency_val[a.currency||"USD"].symbol+("tradein"==e?"-"+parseFloat(a.purchase.replace(/[^0-9.]/g,"").trim()).toFixed(2):(parseFloat("string"==typeof a.price?a.price.replace(/[^0-9.]/g,"").trim():a.price)||0).toFixed(2))})).append($("<div/>",{class:"td w10",html:"tradein"==e?"no":"yes"})))})},changeMorePrice:function(t,e,a){$(t).html($("<input/>",{type:"number",name:"morePrice_"+e,value:$(t).html().replace(/[^0-9.]/g,""),min:0,step:"0.001",class:"quickEdit",oldvalue:$(t).html().replace(/[^0-9.]/g,""),currency:$(t).html().replace(/[0-9.\s]/g,""),onblur:"invoices.sendMorePrice(this, "+e+", '"+a+"');"})),$(t).find("input").focus()},sendMorePrice:function(t,e,a){if(parseFloat($('input[name="morePrice_'+e+'"]').val())<=parseFloat($('input[name="morePrice_'+e+'"]').attr("oldvalue")))alr.show({class:"alrDanger",content:"Price can not be less than "+$('input[name="morePrice_'+e+'"]').attr("oldvalue"),delay:2}),$(t).parent().html($(t).attr("currency")+$(t).attr("oldvalue"));else{$(t).parent().html($(t).attr("currency")+$(t).val());var n=$('input[name="'+("stock"==a?"inventory":a+"s")+'"]').data();n[e].price=$(t).val(),$('input[name="'+("stock"==a?"inventory":a+"s")+'"]').data(n)}},delInvItem:function(t,e,a){e="stock"==e?"inventory":"tradein"==e?e:e+"s",$(t).parent().parent().remove(),delete $('input[name="'+e+'"]').data()[a],invoices.total()},delInInvoice:function(t,e){$(t).parents(".tbl").remove(),invoices.total(),$.post("/invoices/del_invoice",{id:e,del:$(t).parents(".inTbl").attr("data-id")})},total:function(t){var e=0,a=0,n=0,s=0,l=$('input[name="object"]').data()[Object.keys($('input[name="object"]').data())].tax,o=1;$(".tbl.payInfo.discount").length&&(o=(100+parseFloat($(".tbl.payInfo.discount .w100").text().replace(/[^0-9.]/g,"")))/100),$(".payInfo:not(.discount)").each(function(t,a){$(a).find('div > .td.w100:not(".nPay")').each(function(t,e){$(e).parent().hasClass("discountTr")?s*=(100+parseFloat($(e).text().replace(/[^0-9.]/g,"")))/100:s+=parseFloat($(e).text().replace(/[^0-9.]/g,""))}),e+=s,s=0}),$(".td.w100.trIn").each(function(t,e){n+=parseFloat($(e).find("input").length?$(e).find("input").val():$(e).text().replace(/[^0-9.]/g,""))}),$(".td.w100.onsite_add_price").each(function(t,a){e+=parseFloat($(a).find("input").length?$(a).find("input").val():$(a).text().replace(/[^0-9.]/g,""))}),a=(e*=o)+n,$("#subtotal").text(a.toFixed(2)),$("#tax").text((e*l/100).toFixed(2)),$("#total").text((a+parseFloat($("#tax").text().replace(/[^0-9.]/g,""))).toFixed(2)),$("#due").text((parseFloat($("#total").text().replace(/[^0-9.]/g,""))-parseFloat($("#paid").text().replace(/[^0-9.]/g,""))||0).toFixed(2));var c=($('input[name="services"]').data().length?$('input[name="services"]').data():"")||($('input[name="inventory"]').data().length?$('input[name="inventory"]').data():"")||($('input[name="purchases"]').data().length?$('input[name="purchases"]').data():"")||($('input[name="tradein"]').data().length?$('input[name="tradein"]').data():"");$(".currency").text(c?currency_val[c[Object.keys(c)[0]].currency||"USD"].symbol:"$")},create:function(t,e,a){loadBtn.start($(t));var n={id:e,services:""},s=null,l=0;$('input[name="object"]').data()[Object.keys($('input[name="object"]').data())].tax;!a&&($('input[name="customer"]').length?!Object.keys($('input[name="customer"]').data()).join(",").length:0)&&parseFloat($("#total").text())>quick_sell?s="Customer can not be empty if amount more then $50":Object.keys($('input[name="object"]').data()).join(",").length?Object.keys($('input[name="services"]').data()).join(",").length||Object.keys($('input[name="inventory"]').data()).join(",").length||Object.keys($('input[name="tradein"]').data()).join(",").length||Object.keys($('input[name="purchases"]').data()).join(",").length||$('[data-type="onsite"]').length?(n.customer=$('input[name="customer"]').length?Object.keys($('input[name="customer"]').data()).join(","):0,n.object=Object.keys($('input[name="object"]').data()).join(","),n.inventory=JSON.stringify($('input[name="inventory"]').data()),n.services=JSON.stringify($('input[name="services"]').data()),n.purchases=JSON.stringify($('input[name="purchases"]').data()),n.tradein=JSON.stringify($('input[name="tradein"]').data()),n.estimate=a||0,$('input[name="onsite_price"]').length&&(n.add_onsite_price=$('input[name="onsite_price"]').val()),$(".payInfo.mInvoice > div > .td.w100").each(function(t,e){l+=parseFloat($(e).text())}),n.subtotal=$("#subtotal").text(),n.tax=$("#tax").text(),n.total=$("#total").text(),n.paid=parseFloat($("#paid").text()),e&&(n.invoices="",$(".inTbl").each(function(t,e){n.invoices+=$(e).attr("data-id")+","}))):s=lang[62]:s=lang[63],s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(t))):$.post("/invoices/send",n,function(e){loadBtn.stop($(t)),parseInt(e)>0?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),location.pathname.match(/(.*)\/invoices\/?(.*)?/i)[2].indexOf("edit")<0&&Page.get("/invoices/view/"+e)):"no_customer"==e?alr.show({class:"alrDanger",content:"You must select customer if total sum < $"+parseFloat(quick_sell).toFixed(),delay:2}):"confirmed"==e?alr.show({class:"alrDanger",content:"You can not delete purchases. Someones are already ordered",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},update:function(t){$.post("/invoices/update",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Invoice was successfully updated",delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},partial:function(t,e,a){loadBtn.start($(e));var n={id:t},s=null;$('input[name="partial"]').css("border-color","#ddd"),parseFloat($('input[name="partial"]').val())>Math.abs(parseFloat($("#due").text()))?(s=lang[61],$('input[name="partial"]').css("border-color","#f00")):parseFloat($('input[name="partial"]').val())?(n.partial=parseFloat($('input[name="partial"]').val()),n.purchace=a):(s=lang[60],$('input[name="partial"]').css("border-color","#f00")),s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(e))):$.post("/invoices/partial",n,function(t){loadBtn.stop($(e)),"OK"==t?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},discount:function(t,e,a){a&&a(null,t),loadBtn.start($(e));var n={id:t,discount:$('select[name="discount"]').val()};$.post("/invoices/discount",n,function(t){loadBtn.stop($(e)),"OK"==t?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},merge:function(t,e,a){a&&a(null,t),loadBtn.start($(e));var n={id:t},s=null;Object.keys($('input[name="invoices"]').data()).join(",")?n.invoice=Object.keys($('input[name="invoices"]').data()).join(","):s=lang[59],s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(e))):$.post("/invoices/add_invoice",n,function(t){loadBtn.stop($(e)),"OK"==t?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},del:function(t){$.post("/invoices/del",{id:t},function(e){"OK"==e?$("#invoice_"+t).length?$("#invoice_"+t).remove():Page.get("/invoices/"):"confirmed"==e?alr.show({class:"alrDanger",content:"You can not delete invoice. Some purchases are already ordered",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})})},issCreate:function(t,e,a,n){var s={issue:t,discount:parseFloat($("#discount").text())>0?'{"'+$("#discount").attr("data-id")+'":{"name":"'+$("#discount").attr("data-name")+'","percent":"'+$("#discount").text()+'"}}':""};s.customer=e,s.object=a,s.subtotal=parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,"")),s.tax=(parseFloat($("#doit").text().replace(/[^0-9.]/g,""))>0?parseFloat($("#doit").text().replace(/[^0-9.]/g,"")):parseFloat($("#totalPrice").text().replace("$","")))*parseFloat($("#tax").text())/100,s.total=s.subtotal+s.tax,s.paid=0,$.post("/invoices/send",s,function(t){t>0?(alr.show({class:"alrSuccess",content:lang[58],delay:2}),Page.get("/invoices/view/"+t)):"issue_invoice"==t?alr.show({class:"alrDanger",content:"The issue already has invoice",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},saveForm:function(t,e,a){e.preventDefault(),loadBtn.start($(t).find('button[type="submit"]'));var n={};$('textarea[name="content"]').val()?(n.content=$('textarea[name="content"]').val(),$.post("/invoices/save_"+(a?"email_":"")+"form",n,function(e){loadBtn.stop($(t).find('button[type="submit"]')),"OK"==e?alr.show({class:"alrSuccess",content:lang[56],delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})):(loadBtn.stop($(t).find('button[type="submit"]')),alr.show({class:"alrDanger",content:lang[57],delay:2}))},makePayment:function(t,e,a){loadBtn.start($(t));var n={};("cash"!=$('select[name="method"]').val()||a)&&Math.abs(parseFloat($('input[name="cash"]').val()))>Math.abs(parseFloat($("#due").text()))?(loadBtn.stop($(t)),alr.show({class:"alrDanger",content:"Amount exceeds due",delay:2})):parseFloat($('input[name="check"]').val())||"check"!=$('select[name="method"]').val()?(n.id=e,n.method=$('select[name="method"]').val(),n.amount=parseFloat($('input[name="cash"]').val())-($('input[name="rest"]').length?parseFloat($('input[name="rest"]').val()):0),n.check=$('input[name="check"]').val(),$.post("/invoices/make_tran",n,function(e){loadBtn.stop($(t)),"OK"==e?(alr.show({class:"alrSuccess",content:"Transaction is done",delay:2}),Page.get(location.href),mdl.close()):"null_invoice"==e?alr.show({class:"alrDanger",content:"Amount can not be null",delay:2}):"hasissue"==e.split("_")[0]?(alr.show({class:"alrDanger",content:"This device has purchases attached. Please, cancel all purchases if you do not need them for repair before taking ownership.",delay:4}),Page.get("/issues/view/"+e.split("_")[1])):alr.show({class:"alrDanger",content:lang[13],delay:2})})):(loadBtn.stop($(t)),alr.show({class:"alrDanger",content:"Enter check number",delay:2}))},makeTran:function(t,e,a){0==$('select[name="method"]').val()?alr.show({class:"alrDanger",content:"Please, select payment method",delay:2}):$('input[name="cash"]').val()?parseFloat($('input[name="cash"]').val())<parseFloat($("#due").text())?mdl.open({id:"appliedPartial",title:"Partial payment",content:$("<div/>",{class:"aCenter",html:"Are you applied to make partial payment?"}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit ac",onclick:"invoices.makePayment(this, "+t+", "+a+");",html:"Yes"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",onclick:"mdl.close();",html:"No"})))}):invoices.makePayment(e,t,a):alr.show({class:"alrDanger",content:"Please, enter amount",delay:2})},createRefund:function(t,e){var a={},n=0,s=$('textarea[name="refund_comment"]').val(),l="USD";$('input[type="checkbox"]').each(function(t,e){if(n||(l=$(e).parent().parent().attr("data-currency")||"USD"),1==$(e).val()){var s=$(e).attr("name").split("_"),o=parseFloat($(e).parent().next().find("input").length?$(e).parent().next().find("input").val():$(e).parent().next().text());a[s[1]]={name:$(e).parent().text(),price:(parseFloat($(e).parent().next().next().text().replace(/[^0-9.]/g,"").trim())/o*-1).toString(),currency:$(e).parent().parent().attr("data-currency")||"USD",type:s[0],items:o.toString()},n++}}),!s||s.trim().length<10?alr.show({class:"alrDanger",content:"Comment are required and must have enough 10 symbols",delay:2}):n?$.post("/invoices/create_refund",{refund_id:e,refund_info:JSON.stringify(a),refund_comment:s,currency:l},function(t){parseInt(t)>0?(alr.show({class:"alrSuccess",content:"Refund request was created",delay:2}),Page.get("/invoices/view/"+t)):alr.show({class:"alrDanger",content:lang[13],delay:2})}):alr.show({class:"alrDanger",content:"Please, select items",delay:2})}},bugs={add:function(t,e){var a="",n="",s="";if(t){a=$("#bug_"+t).find(".bugTitle > div:first-child > i").text(),n=$("#bug_"+t).find(".bugContent > div:first-child").html();s="";$("#bug_"+t).find(".thumbnails > .thumb").each(function(t,e){s+='<div class="thumb">'+$(e).html()+'<span class="fa fa-times" onclick="delete_image(this);"></span></div>'})}mdl.open({id:"bugAdd",title:lang[55],content:$("<div/>",{class:"bugForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:lang[54]})}).append($("<input/>",{type:"text",name:"title",value:a||""}))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:lang[53]})}).append($("<textarea/>",{name:"content",html:n||""}))).append($("<div/>",{class:"iGroup imgGroup",html:$("<label/>",{html:lang[52]})}).append($("<div/>",{class:"dragndrop",html:$("<span/>",{class:"fa fa-download"})}).append("Click or drag and drop file here")).append($("<div/>",{class:"thumbnails",html:s||""}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",html:lang[18],type:"button",onclick:"bugs.send(this, "+(t||0)+", "+(e||0)+");"})}))}),$(".dragndrop").upload({count:0,multiple:!0,max:5,check:function(t){var e=this;if(t.error)"max"==t.error?alr.show({class:"alrDanger",content:lang[51],delay:2}):"type"==t.error?alr.show({class:"alrDanger",content:lang[50],delay:2}):"size"==t.error&&alr.show({class:"alrDanger",content:lang[49],delay:2});else{var a=new Image;a.src=URL.createObjectURL(t.file),a.setAttribute("onclick","showPhoto(this.src);"),$("#bugAdd .thumbnails").append($("<div>",{class:"thumb",html:a}).append($("<span/>",{class:"fa fa-times"}).click(function(){delete e.files[t.file.name],$(this).parent().remove()})))}}})},send:function(t,e,a){loadBtn.start($(t));var n=new FormData,s=null;if(e&&n.append("id",e),$(t).parents(".bugForm").find("label").next().css("border","1px solid #ddd"),$(t).parents(".bugForm").find(".iGroup:not(.imgGroup)").each(function(t,e){$(e).find("label").next().val()||"Comment"==$(e).find("label").text().trim()?$(e).find("label").next().attr("name")==$(e).attr("id")?n.append(Object.keys($(e).find("label").next().attr("name"),$(e).find("label").next().data()).join(",")):(n.append($(e).find("label").next().attr("name"),$(e).find("label").next().val()),"comment"==$(e).find("label").next().attr("name")&&n.append("dev",1),1==a&&n.append("status","improvement")):(s=$(e).text()+" can not be empty",$(e).find("label").next().css("border","1px solid #f00"))}),$(".dragndrop").length){var l=$(".dragndrop")[0].files,o=$(".dragndrop")[0].delete;if(o&&$.each(o,function(){n.append("delete[]",this.split("thumb_")[1])}),!$.isEmptyObject(l))for(var c in l)n.append("image[]",l[c])}s?(loadBtn.stop($(t)),alr.show({class:"alrDanger",content:s,delay:2})):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/bugs/send",data:n}).done(function(n){if(loadBtn.stop($(t)),n){var s="";(n=JSON.parse(n)).images&&$.each(n.images,function(t,e){s='<div class="thumb"><img src="/uploads/images/bugs/'+n.id+"/thumb_"+e+'" onclick="showPhoto(this.src);"></div>'}),e?($("#bug_"+n.id+" .bugTitle > div:first-child > i").html($('input[name="title"]').val()),$("#bug_"+n.id+" .bugContent > div:first-child").html($('textarea[name="content"]').val()),$('select[name="status"]').val()&&$("#bug_"+n.id+" .bugTitle > div:first-child > span").removeClass($("#bug_"+n.id+" .bugTitle > div:first-child > span").attr("class")).addClass("st_"+$('select[name="status"]').val()).html($('select[name="status"]').val().replace("_"," ")),o&&$.each(o,function(){$("#bug_"+n.id+" .bugContent > .thumbnails").find('img[src*="'+this.split("thumb_")[1]+'"]').parent().remove(),$("#bug_"+n.id+" .bugComment > .thumbnails").find('img[src*="'+this.split("thumb_")[1]+'"]').parent().remove()}),$('textarea[name="comment"]').length?$("#bug_"+e+" .bugComment").length?$("#bug_"+e+" .bugComment").removeAttr("class").addClass("bugComment cm_"+$('select[name="status"]').val()).html(n.user+": <span>"+$('textarea[name="comment"]').val()+'</span><div class="thumbnails">'+s+"</div>"):$("#bug_"+e+" .bugContent").append($("<div/>",{class:"bugComment cm_"+$('select[name="status"]').val(),html:n.user+": <span>"+$('textarea[name="comment"]').val()+'</span><div class="thumbnails">'+s+"</div>"})):$("#bug_"+n.id+" .bugContent > .thumbnails").append(s)):$(".userList.bug").prepend($("<div/>",{class:"sUser bug",id:"bug_"+n.id,html:$("<div/>",{class:"bugTitle",html:$("<div/>",{html:$("<i/>",{html:$('input[name="title"]').val()})}).prepend($("<b/>",{html:"#"+n.id+" "})).append("<span/>",{class:"fa fa-pencil bEdit",onclick:"bugs.add({id});"}).append($("<span/>",{class:a?"st_improvement":"st_opened",html:a?"improvement":"opened"}))}).append($("<div/>",{class:"date",html:n.user}).append($("<span/>",{html:"|"})).append(n.date))}).append($("<div/>",{class:"bugContent",html:$("<div/>",{html:$('textarea[name="content"]').val()})}).append($("<div/>",{class:"thumbnails",html:s})))),mdl.close()}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},edit:function(t){var e="",a="";t&&($("#bug_"+t).find(".bugComment > .thumbnails > .thumb").each(function(t,a){e+='<div class="thumb">'+$(a).html()+'<span class="fa fa-times" onclick="delete_image(this);"></span></div>'}),a=$("#bug_"+t+" .bugComment > span").text()),mdl.open({id:"editBug",title:lang[48],content:$("<div/>",{class:"bugForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[47]})}).append($("<select/>",{name:"status",html:$("<option/>",{value:"opened",html:lang[46]})}).append($("<option/>",{value:"processed",html:lang[45]})).append($("<option/>",{value:"closed",html:lang[44]})).append($("<option/>",{value:"rejected",html:lang[43]})).append($("<option/>",{value:"improvement",html:"Improvement"})).append($("<option/>",{value:"final_closed",html:"Final closed"})))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:lang[27]})}).append($("<textarea/>",{name:"comment",html:a||""}))).append($("<div/>",{class:"iGroup imgGroup",html:$("<label/>",{html:lang[52]})}).append($("<div/>",{class:"dragndrop",html:$("<span/>",{class:"fa fa-download"})}).append("Click or drag and drop file here")).append($("<div/>",{class:"thumbnails",html:e||""}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",html:lang[42],type:"button",onclick:"bugs.send(this, "+t+");"})})),cb:function(){$('select[name="status"]').val($("#bug_"+t+" .bugTitle > div:first-child > span:not(.fa)").attr("class").replace("st_","")),$("#page").select()}}),$(".dragndrop").upload({count:0,multiple:!0,max:5,check:function(t){var e=this;if(t.error)"max"==t.error?alr.show({class:"alrDanger",content:lang[51],delay:2}):"type"==t.error?alr.show({class:"alrDanger",content:lang[50],delay:2}):"size"==t.error&&alr.show({class:"alrDanger",content:lang[49],delay:2});else{var a=new Image;a.src=URL.createObjectURL(t.file),a.setAttribute("onclick","showPhoto(this.src);"),$("#editBug .thumbnails").append($("<div>",{class:"thumb",html:a}).append($("<span/>",{class:"fa fa-times"}).click(function(){delete e.files[t.file.name],$(this).parent().remove()})))}}})}},cash={cpage:0,amount_cash:0,amount_credit:0,amount_hands:0,amount_system:0,show:1,currency:"USD",sendUpdateInfo:function(t,e,a,n,s,l){$(e).attr("old-value")==$('input[name="cash_val"]').val()?$(e).parent().html("$ "+$(e).attr("old-value")):$.post("/cash/update_info",{id:t,cash_id:l,field:s,value:$('input[name="cash_val"]').val()},function(t){"OK"==t.res?(alr.show({class:"alrSuccess",content:"Value was succefully saved",delay:2}),$("#stat_"+l).replaceWith(t.html)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},updateInfo:function(t,e,a,n,s,l){var o=parseFloat($(e).text().replace(/\D\s/i,""));$(e).html($("<input/>",{type:"number",name:"cash_val",onblur:"cash.sendUpdateInfo("+t+', this, "'+a+'", "'+n+'", "'+s+'", "'+l+'");',value:o,"old-value":o,class:"quickEdit"})),$('input[name="cash_val"]').focus()},openCash:function(t,e){cash.amount_cash=0,cash.amount_credit=0,cash.amount_hands=0,cash.amount_system=0,$.post("/cash/open",{id:Object.keys($('input[name="object"]').data()).join(","),action:e,type:"cash"},function(t){"DONE"==t.amount?alr.show({class:"alrDanger",content:lang[148]+("open"==e?lang[149]:lang[150])+lang[147],delay:2}):"ERR"==t.amount?alr.show({class:"alrDanger",content:lang[39]+("open"==e?lang[40]:lang[41]),delay:2}):"no_action"==t.amount?alr.show({class:"alrDanger",content:"Please, reload page and select action",delay:2}):(cash.amount_cash=t.amount,cash.amount_system=t.amount,cash.show=t.show,cash.currency=t.currency,mdl.open({id:"openCash",title:"open"==e?lang[38]:lang[151],content:$("<div/>",{class:"mdlCash",html:$("<div/>",{class:"sumCash",html:1==t.show?"Enter Total Drawer Amount<br> "+currency_val[t.currency||"USD"].symbol+t.amount:"Enter Total Drawer Amount"})}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Amount"})}).append($("<input/>",{type:"number",min:"0",step:"0.1",name:"hands"}))).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn  btnSubmit ac",html:lang[30],onclick:"close"==e?"cash.acceptClose('cash', '"+e+"', 0, '"+("NO"==t?"0":t)+"', this);":"cash.accept('cash', '"+e+"', null, null, this);",ondblclick:"return false;"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",html:lang[29],onclick:"mdl.close();"})))}))},"json")},confirmDicline:function(t,e,a){mdl.close("openCash"),mdl.open({id:"decOpenCash",title:"open"==e?lang[38]:lang[151],content:$("<div/>",{class:"mdlCash",html:$("<div/>",{class:"sumCash",html:"Are you sure you want to "+e+" cash?"})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn  btnSubmit ac",html:lang[30],onclick:"cash.dicline('cash', '"+e+"', '"+a+"');"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",html:"Recalculate",onclick:"mdl.close();"})))})},accept:function(t,e,a,n,s){if(loadBtn.start($(s)),parseFloat("cash"==t?cash.amount_cash:cash.amount_credit)!=parseFloat($('input[name="hands"]').val())&&"open"==e)cash.amount_hands=$('input[name="hands"]').val(),cash.amount_cash=$('input[name="hands"]').val(),cash.amount_credit=$('input[name="hands"]').val(),$(".mdl").hide(),cash.dicline(t,e,a);else{var l=new FormData,o=null;if("close"==e?($(".mdl input").css("border","1px solid #ddd"),$('input[name="out"]').val()||"out"!=n?$('input[name="leave"]').val()||n?(l.append("system",cash.amount_system),"out"==n?l.append("out",$('input[name="out"]').val()):l.append("amount",$('input[name="leave"]').val())):(o="Please, enter value",$('input[name="leave"]').css("border","1px solid #f00")):(o="Please, enter value",$('input[name="out"]').css("border","1px solid #f00"))):(l.append("amount",$('input[name="hands"]').val()),l.append("system",cash.amount_system)),$('input[name="hands"]').length&&(cash.amount_hands=$('input[name="hands"]').val()),l.append("lack",cash.amount_system-cash.amount_hands),l.append("type",t),l.append("action","dicline"),l.append("acType",e),l.append("d",a||0),l.append("object",Object.keys($('input[name="object"]').data()).join(",")),l.append("currency",cash.currency),o)alr.show({class:"alrDanger",content:o,delay:2});else{if($(".dragndrop").length){var c=$(".dragndrop")[0].files;if(!$.isEmptyObject(c))for(var i in c)l.append("image",c[i])}$.ajax({type:"POST",dataType:"json",processData:!1,contentType:!1,url:"/cash/send",data:l}).done(function(s){if(s){if(mdl.close(),"open"==e&&"cash"==t){$(".btnOCash").attr("onclick","cash.openCash('cash', 'close')").html(lang[34]);o=setTimeout(function(){cash.openCredit(),clearTimeout(o)},2e3)}else if("close"==e&&"cash"==t&&($(".btnOCash").attr("onclick","cash.openCash('cash', 'open')").html(lang[33]),"out"==n))var o=setTimeout(function(){cash.leave(t,e,s.id),clearTimeout(o)},500);$("#cashHistory .noContent")&&$(".noContent").remove(),a?$("#stat_"+a+" .td:nth-child(5)").html("$"+l.amount):"cash"==t?$("#cashHistory .tBody").prepend($("<div/>",{class:"tr"+(Math.abs(l.lack)>.001?" dicline":""),id:"stat_"+s.id,onclick:a?" cash.adminAccept("+s.id+");":"",html:$("<div/>",{class:"td wIds",html:$('input[name="object"]').data()[Object.keys($('input[name="object"]').data()).join(",")].name})}).append($("<div/>",{class:"td",html:"cash<br>credit"})).append($("<div/>",{class:"td",html:(1==cash.show?currency_val[cash.currency||"USD"].symbol+parseFloat(cash.amount_system).toFixed(2):" --- ")+'<br><span class="creditArea"></span>'})).append($("<div/>",{class:"td",html:(1==cash.show?currency_val[cash.currency||"USD"].symbol+parseFloat(cash.amount_hands||0).toFixed(2):" --- ")+(l.lack>.001?'<span class="minLack">-'+parseFloat(l.lack).toFixed(2)+"</span>":l.lack<-.001?'<span class="plusLack">'+parseFloat(l.lack).toFixed(2)+"</span>":"")+'<br><span class="creditArea"></span>'})).append($("<div/>",{class:"td",html:1==cash.show?currency_val[cash.currency||"USD"].symbol+parseFloat(l.amount||0).toFixed(2):" --- "})).append($("<div/>",{class:"td",html:lang[e]})).append($("#drops").length?$("<div/>",{class:"td",html:"close"==e?currency_val[cash.currency||"USD"].symbol+l.out:"---"}):"").append($("<div/>",{class:"td",html:s.date})).append($("<div/>",{class:"td",html:s.user})).append($("<div/>",{class:"td",style:"width: 50px",html:$("<a/>",{href:"close"==e?"/invoices/history/?type="+t+"&date="+s.ddate+"&object="+Object.keys($('input[name="object"]').data()).join(",")+"&object_name="+$('input[name="object"]').data()[Object.keys($('input[name="object"]').data()).join(",")].name:"",onclick:"Page.get(this.href); return false;",html:"Invoices"})}))):"credit"==t&&"open"==e&&($("#cashHistory .tBody .tr:first-child .td:nth-child(3) .creditArea").html(1==cash.show?"$ "+parseFloat(cash.amount_system).toFixed(2):" --- "),$("#cashHistory .tBody .tr:first-child .td:nth-child(4) .creditArea").html((1==cash.show?"$ "+parseFloat(cash.amount_hands||0).toFixed(2):" --- ")+(l.lack>.001?'<span class="minLack">-'+parseFloat(l.lack).toFixed(2)+"</span>":l.lack<-.001?'<span class="plusLack">'+parseFloat(l.lack).toFixed(2)+"</span>":"")))}else alr.show({class:"alrDanger",content:lang[13],delay:2})})}}},dicline:function(t,e,a){$(".mdl").hide(),mdl.open({id:"mdlDicline",title:lang[36],content:$("<div/>",{class:"diclineForm",html:$("<div/>",{class:"amNot",html:$("<div/>",{html:"Are you sure?"})})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn  btnSubmit ac",html:lang[30],onclick:"cash.sendDicline('"+t+"', '"+e+"'"+(a?", "+a:"")+", this);"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",html:"Recalculate",onclick:"mdl.close();"})))})},sendDicline:function(t,e,a,n){loadBtn.start($(n));var s=new FormData;if(s.append("amount","cash"==t?cash.amount_cash:cash.amount_credit),s.append("system",cash.amount_system),s.append("lack",cash.amount_system-("cash"==t?cash.amount_cash:cash.amount_credit)),s.append("type",t),s.append("action","dicline"),s.append("acType",e),s.append("object",Object.keys($('input[name="object"]').data()).join(",")),s.append("currency",cash.currency),$(".dragndrop").length){var l=$(".dragndrop")[0].files;if(!$.isEmptyObject(l))for(var o in l)s.append("image",l[o])}$.ajax({type:"POST",dataType:"json",processData:!1,contentType:!1,url:"/cash/send",data:s}).done(function(a){if(a.id>0){if(mdl.close(),"close"==e)$(".btnOCash").attr("onclick","cash.openCash('cash', 'open')").html(lang[33]),cash.acceptClose(t,e,a.id,0,1);else if("open"==e&&"cash"==t){$(".btnOCash").attr("onclick","cash.openCash('cash', 'close')").html(lang[34]);var n=setTimeout(function(){cash.openCredit(),clearTimeout(n)},2e3)}$("#cashHistory .noContent")&&$(".noContent").remove(),$("#cashHistory .tBody").prepend($("<div/>",{class:"tr dicline",id:"stat_"+a.id,onclick:"cash.adminAccept("+a.id+");",html:$("<div/>",{class:"td wIds",html:$('input[name="object"]').data()[Object.keys($('input[name="object"]').data()).join(",")].name})}).append($("<div/>",{class:"td",html:"cash"})).append($("<div/>",{class:"td",html:1==cash.show?currency_val[cash.currency||"USD"].symbol+s.system:" --- "})).append($("<div/>",{class:"td",html:(1==cash.show?currency_val[cash.currency||"USD"].symbol+(s.system-s.lack):" --- ")+(s.lack>.001?'<span class="minLack">-'+parseFloat(s.lack).toFixed(2)+"</span>":s.lack<-.001?'<span class="plusLack">'+parseFloat(-1*s.lack).toFixed(2)+"</span>":"")})).append($("<div/>",{class:"td",html:1==cash.show?currency_val[cash.currency||"USD"].symbol+(s.amount||0):" --- "})).append($("<div/>",{class:"td",html:lang[e]})).append($("#drops").length?$("<div/>",{class:"td",html:"close"==e?currency_val[cash.currency||"USD"].symbol+"0":"---"}):"").append($("<div/>",{class:"td",html:a.date})).append($("<div/>",{class:"td",html:a.user})).append($("<div/>",{class:"td",style:"width: 50px",html:"close"==e?$("<a/>",{href:"/invoices/history/?type="+t+"&date="+a.ddate+"&object="+Object.keys($('input[name="object"]').data()).join(",")+"&object_name="+$('input[name="object"]').data()[Object.keys($('input[name="object"]').data()).join(",")].name,onclick:"Page.get(this.href); return false;",html:"Invoices"}):""})))}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},change:function(t){$('input[name="out"]').val(parseFloat($('input[name="out"]').attr("data-value"))-$(t).val())},acceptClose:function(t,e,a,n,s){cash.amount_cash=parseFloat($('input[name="hands"]').val()),cash.amount_hands=parseFloat($('input[name="hands"]').val()),parseFloat($('input[name="hands"]').val())==cash.amount_cash||s?(mdl.close(),mdl.open({id:"mdlClose",title:"Input cash",content:$("<div/>",{class:"diclineForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Drop Amount"})}).append($("<input/>",{type:"number",min:0,step:.1,placeholder:0,name:"out"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",html:lang[28],onclick:"cash.accept('cash', '"+e+"', "+(a||0)+", 'out', this);",ondblclik:"return false;"})}))})):cash.dicline(t,e,a)},leave:function(t,e,a){console.log(a),mdl.open({id:"mdlClose",title:"Input cash",content:$("<div/>",{class:"diclineForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:lang[32]})}).append($("<input/>",{type:"number",min:0,step:.1,placeholder:0,name:"leave"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",html:lang[28],onclick:"cash.accept('cash', '"+e+"', "+(a||0)+", null, this);",ondblclick:"return false;"})}))})},openCredit:function(){cash.amount_cash=0,cash.amount_credit=0,cash.amount_hands=0,cash.amount_system=0,cash.currency="USD",$.post("/cash/open",{id:Object.keys($('input[name="object"]').data()).join(","),action:"open",type:"credit"},function(t){t&&("DONE"==t.amount?alr.show({class:"alrDanger",content:"Yu can not open cash twice a day",delay:2}):(cash.amount_system=t.amount,cash.currency=t.currency,mdl.open({id:"openCredit",title:lang[31],content:$("<div/>",{class:"mdlCredit",html:$("<div/>",{class:"sumCash",html:1==cash.show?"Credit Settlement<br> "+currency_val[t.currency||"USD"].symbol+t.amount:"Credit Settlement"})}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Amount"})}).append($("<input/>",{type:"number",min:"0",step:"0.1",name:"hands"}))).append($("<div/>",{class:"iGroup imgGroup fw",html:$("<label/>",{html:"Credit Settelement"})}).append($("<div/>",{class:"dragndrop",html:$("<span/>",{class:"fa fa-download"})}).append("Click or drag and drop file here"))).append($("<div/>",{class:"cashGroup",html:$("<button/>",{type:"button",class:"btn  btnSubmit ac",html:lang[30],onclick:"cash.accept('credit', 'open', null, null, this);",ondblclick:"return false;"})}).append($("<button/>",{type:"button",class:"btn btnSubmit dc",html:lang[29],onclick:"cash.dicline('credit', 'open', "+("NO"==t?"0":t)+", this);"}))),cb:function(){$(".dragndrop").upload({check:function(t){var e=this;if(t.error)"type"==t.error?alr.show({class:"alrDanger",content:"You can load only jpeg, jpg, png, gif images",delay:2}):"size"==t.error&&alr.show({class:"alrDanger",content:"Upload size for images is more than allowable",delay:2});else{(new Image).src=URL.createObjectURL(t.file);var a=$(".dragndrop").prev();"FIGURE"==a[0].tagName&&a.remove(),$(this).before($("<figure/>",{html:$("<img/>",{src:URL.createObjectURL(t.file)})}).append($("<span/>",{class:"fa fa-times"}).click(function(){e.files={},$(this).parent().remove()})))}}})}})))},"json")},adminAccept:function(t){$.post("/cash/getComment",{id:t},function(e){e&&mdl.open({id:"admAccept",title:"Leave a comment",content:$("<div/>",{class:"comForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:e.user})}).append($("<div/>",{class:"userComment",html:e.content}))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:lang[27]})}).append($("<textarea/>",{name:"comment"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",html:lang[28],onclick:"cash.sendAdm("+t+");"})}))})},"json")},sendAdm:function(t){var e={id:t},a=null;$('textarea[name="comment"]').css("border","1px solid #ddd"),$('textarea[name="comment"]').val()?e.comment=$('textarea[name="comment"]').val():(a=lang[26],$('textarea[name="comment"]').css("border","1px solid #f00")),a?alr.show({class:"alrDanger",content:a,delay:2}):$.post("/cash/sendCom",e,function(e){"OK"==e?($("#stat_"+t).removeClass("dicline").find(".td").first().prepend(' <span class="fa fa-check"></span>'),mdl.close()):alr.show({class:"alrDanger",content:lang[13],delay:2})})},selectObject:function(){page=0,$.post("/cash",{id:Object.keys($('input[name="object"]').data()).join(","),page:page,query:"",type:$('select[name="type"]').val(),action:$('select[name="action"]').val(),status:$('select[name="status"]').val(),staff:Object.keys($('input[name="staff"]').data()).join(","),date_start:$('#calendar input[name="date"]').val(),date_end:$('#calendar input[name="fDate"]').val()},function(t){t?(cash.amount_cash=0,cash.amount_credit=0,cash.show=1,$("#cashHistory").removeClass("hdn").find(".tBody").html(t.content),$(".tbl + button").addClass(t.more),0==page&&$(".btnOCash").removeAttr("disabled").attr("onclick","cash.openCash('cash', '"+(t.status||"open")+"')").html((t.status||"Open ")+" cash"),t.left_count?$(".btnLoad").removeClass("hdn"):$(".btnLoad").addClass("hdn"),$(".filterCtnr").hide()):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},doload:function(t){page+=1,$.post(location.pathname,{id:Object.keys($('input[name="object"]').data()).join(",")||0,query:query,page:page,type:$('select[name="type"]').val(),action:$('select[name="action"]').val(),status:$('select[name="status"]').val(),staff:Object.keys($('input[name="staff"]').data()).join(","),date_start:$('#calendar input[name="date"]').val(),date_end:$('#calendar input[name="fDate"]').val()},function(e){$(".tBody").append(e.content),e.left_count||$(t).addClass("hdn")},"json")},comments:function(t){cash.cpage=0,$.post("/cash/comments",{id:t},function(e){mdl.open({id:"cashComments",title:"Comments",content:$("<div/>",{html:$("<div/>",{class:"comments",html:e.content})}).append($("<button/>",{class:"btn btnLoad"+(e.left_count>0?"":" hdn"),onclick:"cash.doloadComments(this,"+t+");",html:"Load commetns"})).append($("<div/>",{class:"commentForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Leave comment"})}).append($("<textarea/>",{name:"comment"}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"cash.sendComment("+t+");",html:"Send"})})))})},"json")},sendComment:function(t){$('textarea[name="comment"]').val()?$.post("/cash/send_comment",{id:t,text:$('textarea[name="comment"]').val()},function(t){"OK"==t.res?(alr.show({class:"alrSuccess",content:"Comment was successfully added",delay:2}),$(".comments").append(t.html),$('textarea[name="comment"]').val(""),p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<70?70:p)+"px")):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json"):alr.show({class:"alrDanger",content:"Comment can not be empty",delay:2})},doloadComments:function(t,e){cash.cpage+=1,$.post("/cash/comments",{id:e,page:cash.cpage},function(e){$(".comments").append(e.content),e.left_count||$(t).addClass("hdn")},"json")}},categories={dragEl:{},mouse:{},parentEl:{},clickEl:{},dragstart:function(t){return options.mouse=t,options.clickEl=t.target,options.dragEl=t.target.parentNode,options.parentEl=options.dragEl.parentNode,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",options.dragEl.textContent),console.log(options.mouse),!1},dragend:function(t,e){return t.preventDefault(),options.dragEl.classList.remove("drag"),e&&e.apply(t.target),!1},dragover:function(t){t.preventDefault(),t.dataTransfer.dropEffect="move";var e=t.target;e&&e!==options.clickEl&&e.className==options.clickEl.className&&(e.parentNode.nextSibling==options.dragEl?options.parentEl.insertBefore(options.dragEl,e.parentNode):options.parentEl.insertBefore(options.dragEl,e.parentNode.nextSibling))}},store={id:0,sendServiceCategory:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t);if(s.find(".iGroup > input").css("border","1px solid #ddd"),n.append("id",a),!s.find('input[name="name"]').val().length)return s.find('input[name="name"]').css("border","1px solid #f00"),alr.show({class:"alrDanger",content:lang[16],delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));n.append("name",s.find('input[name="name"]').val()),n.append("parent",Object.keys(s.find('input[name="parent"]').data())),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/store/sendServiceCategory",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),Page.get(location.href),mdl.close("select_par"))})},delServiceCategory:function(t){$.post("/store/delServiceCategory",{id:t},function(e){"OK"==e?$("#invCategory_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},addServiceCategory:function(t,e,a,n){$.post("/store/allServiceCategories",{id:t||"",nIds:Object.keys(a||{}).join(",")},function(n){n&&(items="",lId=0,$.each(n.list,function(t,e){items+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_par",title:(t?lang[17]:lang[18])+" "+lang[129],content:'<form  method="post" onsubmit="store.sendServiceCategory(this, event, '+(t||0)+');">\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="iGroup" id="parent">\t\t\t\t\t\t\t<input type="hidden" name="parent">\t\t\t\t\t\t\t<div class="lbl">'+lang[128]+'</div>\t\t\t\t\t\t\t<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t<button class="btn btnSubmit">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t</div>\t\t\t\t\t</form>",cb:function(){nIds=[],$('input[name="parent"]').data(a),$("#parent > ul").sForm({action:"/store/allServiceCategories",data:{lId:lId,query:$("#parent > .sfWrap input").val()||"",nIds:Object.keys(a||{}).join(",")+","+t},all:n.count<=20,select:a,s:!0},$('input[name="parent"]'))}}))},"json")},sendDiscount:function(){var t=null;$('input[name="amount"]').val()?Object.keys($('input[name="customer"]').data())[0]||(t="Customer can not be null"):t="Amount can not be null",t?alr.show({class:"alrDanger",content:t,delay:2}):$.post("/store/send_discount",{amount:$('input[name="amount"]').val(),customer:Object.keys($('input[name="customer"]').data())[0]},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Discount was successfully added",delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},addDiscount:function(t){mdl.open({id:"add_discount",title:"Add discount",content:$("<div/>",{class:"uForm",html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:"Amount, %"})}).append($("<input/>",{type:"number",name:"amount",min:"0",step:"0.001"}))}).append($("<div/>",{class:"iGroup",id:"customer",html:$("<label/>",{html:"Customer"})}).append($("<input/>",{type:"hidden",name:"customer"})).append($("<ul/>",{class:"hdn"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"store.sendDiscount(this);",html:"Send"})})),cb:function(){$.post("/users/all",{gId:5},function(t){if(t){var e="",a=0;$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$("#customer > ul").html(e).sForm({action:"/users/all",data:{gId:5,lId:a,nIds:Object.keys($('input[name="customer"]').data()).join(","),query:$("#customer > .sfWrap input").val()},all:!1,select:$('input[name="customer"]').data(),s:!0,link:"users/view"},$('input[name="customer"]'))}},"json")}})},delDiscount:function(t){$.post("/store/del_discount",{id:t},function(e){"OK"==e?$("#discount_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},updateOrderStatus:function(t,e){$.post("/store/get_order_status",{id:t,status:e},function(e){mdl.open({id:"orderStatus",title:"Update status",content:$("<div/>",{html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Status"})}).append($("<select/>",{name:"status",html:e}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"store.sendUpdateStatus("+t+");",html:"Update"})})),cb:function(){$("#page").select()}})})},sendUpdateStatus:function(t){$.post("/store/update_order_status",{id:t,status:$('select[name="status"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Status was successfully updates",delay:2}),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delOrder:function(t){t?$.post("/store/delOrder",{id:t},function(e){"OK"==e?$("#order_"+t).length?$("#order_"+t).remove():Page.get("/store/orders"):alr.show({class:"alrDanger",content:lang[9],delay:2})}):$("#order_"+t).length?$("#order_"+t).remove():Page.get("/store/orders")},openPayment:function(t,e){mdl.open({id:"openStatus",title:(t?lang[17]:lang[18])+" payment method",content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"store.sendPayment(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendPayment:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/store/sendPayment",n,function(t){loadBtn.stop($(this)),t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:"Payment method was successfully sent",delay:2})},"json")},delPayment:function(t,e){t?$.post("/store/delPayment",{id:t,warranty:e?1:0},function(e){"OK"==e?$("#payment_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},sendPaymentPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("payment_","")}}),e&&$.post("/store/stPaymentPriority",e,function(t){})},openDelivery:function(t,e,a,n){forms="",currency_val&&$.each(currency_val,function(t,e){forms+='<option value="'+t+'" '+(n==t||!n&&"USD"==t?"selected":"")+">"+t+"("+e.symbol+")</option>"}),mdl.open({id:"openStatus",title:(t?lang[17]:lang[18])+" delivery method",cb:function(){$("#page").select()},content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"iGroup curGroup",html:$("<label/>",{html:"Form"})}).append($("<div/>",{class:"cur",html:$("<select/>",{name:"currency",html:forms})})).append($("<input/>",{type:"number",name:"price",min:0,step:.001,value:a||0}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"store.sendDelivery(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendDelivery:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?(n.name=a.find('input[name="name"]').val(),n.price=a.find('input[name="price"]').val(),n.currency=a.find('select[name="currency"]').val()):(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/store/sendDelivery",n,function(t){loadBtn.stop($(this)),t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:"Delivery method was successfully sent",delay:2})},"json")},delDelivery:function(t,e){t?$.post("/store/delDelivery",{id:t,warranty:e?1:0},function(e){"OK"==e?$("#delivery_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},sendDeliveryPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("delivery_","")}}),e&&$.post("/store/stDeliveryPriority",e,function(t){})},openStatus:function(t,e,a,n,s){$.post("/settings/allForms",{},function(l){forms='<option value="0">Not seleted</option>',l&&$.each(l.list,function(t,e){forms+='<option value="'+e.id+'" '+(a==e.id?"selected":"")+">"+e.name+"</option>"}),mdl.open({id:"openStatus",title:(t?lang[17]:lang[18])+lang[121],cb:function(){$("#page").select()},content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Form"})}).append($("<select/>",{name:"form",html:forms}))).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Color"})}).append($("<input/>",{type:"text",name:"color",class:"colorPicker",value:n||""}))).append($("<div/>",{class:"iGroup",html:$("<label/>",{html:"Alternative color"})}).append($("<input/>",{type:"text",name:"alt_color",class:"colorPicker",value:s||""}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"store.sendStatus(this, "+t+")",html:t?lang[113]:lang[91]})})),cb:function(){$("#page").colorPicker(),$("#page").select()}})},"json")},sendStatus:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?(n.name=a.find('input[name="name"]').val(),n.form=a.find('select[name="form"]').val(),n.color=a.find('input[name="color"]').val(),n.alt_color=a.find('input[name="alt_color"]').val()):(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/store/sendOrderStatus",n,function(t){loadBtn.stop($(this)),t?(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delStatus:function(t,e){t?$.post("/store/delOrderStatus",{id:t,warranty:e?1:0},function(e){"OK"==e?$("#status_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},sendPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("status_","")}}),e&&$.post("/store/stPriority",e,function(t){})},sendSlide:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t).serializeArray(),l=null;n.append("id",a);for(var o=0;o<s.length;o++){if("name"==s[o].name&&!s[o].value.length){l="The field can not be empty";break}n.append(s[o].name,s[o].value)}switch($(t).find('select[name="link_type"]').val()){case"none":n.append("link_id","");break;case"custom":n.append("link_id",$(t).find('input[name="custom"]').val());break;case"item":case"categry":case"blog":n.append("link_id",Object.keys($(t).find('input[name="'+$(t).find('select[name="link_type"]').val()+'"]').data()).join(","))}$(".dragndrop").each(function(t,e){if($(e).length){var a=$(e)[0].files;if(!$.isEmptyObject(a))for(var s in a)n.append($(e).attr("data-type"),a[s])}if($(e).parents(".imgGroup").find("figure > img").attr("new")){var l=$(e).parents(".imgGroup").find("figure > img").attr("src");n.append($(e).attr("data-type"),b64Blob(l.split(",")[1],"image/png")),n.append("blob",1)}}),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/store/send_slide",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0?(alr.show({class:"alrSuccess",content:"Slide was succefully "+(a?lang[23]:lang[24]),delay:2}),Page.get("/store/slider/edit/"+t)):"err_file_size"==t?alr.show({class:"alrDanger",content:"Uploaded photos are too large",delay:2}):"err_image_type"==t?alr.show({class:"alrDanger",content:"Uploaded photos are have wrong type",delay:2}):"no_access"==t?alr.show({class:"alrDanger",content:"You hav no access to do that",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},delSlide:function(t){$.post("/store/del_slide",{id:t},function(e){"OK"==e?$("#slide_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},selectIcon:function(t){$('input[name="icon"]').val($(t).attr("class").replace("fa fa-","")).next().attr("class",$(t).attr("class")),mdl.close()},openServiceIcon:function(){mdl.open({id:"selectIcon",title:"Select Icon",content:'<div class="mdlIcons">\t\t\t\t<span class="fa fa-address-book" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-address-book-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-address-card" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-address-card-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-adjust" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-american-sign-language-interpreting" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-anchor" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-archive" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-area-chart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-arrows" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-arrows-h" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-arrows-v" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-asl-interpreting" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-assistive-listening-systems" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-asterisk" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-at" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-audio-description" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-automobile" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-balance-scale" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-ban" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bank" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bar-chart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bar-chart-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-barcode" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bars" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bath" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery-empty" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery-full" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery-half" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery-quarter" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-battery-three-quarters" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bed" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-beer" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bell" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bell-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bell-slash" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bell-slash-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bicycle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-binoculars" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-birthday-cake" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-blind" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bluetooth" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bluetooth-b" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bolt" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bomb" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-book" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bookmark" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bookmark-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-braille" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-briefcase" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bug" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-building" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-building-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bullhorn" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bullseye" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-bus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cab" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calculator" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar-check-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar-minus-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar-plus-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-calendar-times-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-camera" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-camera-retro" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-car" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-caret-square-o-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-caret-square-o-left" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-caret-square-o-right" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-caret-square-o-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cart-arrow-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cart-plus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-certificate" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-check" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-check-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-check-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-check-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-check-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-child" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-circle-o-notch" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-circle-thin" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-clock-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-clone" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-close" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cloud" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cloud-download" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cloud-upload" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-code" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-code-fork" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-coffee" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cog" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cogs" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-comment" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-comment-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-commenting" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-commenting-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-comments" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-comments-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-compass" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-copyright" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-creative-commons" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-credit-card" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-credit-card-alt" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-crop" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-crosshairs" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cube" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cubes" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-cutlery" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-dashboard" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-database" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-deaf" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-deafness" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-desktop" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-diamond" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-dot-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-download" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-drivers-license" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-drivers-license-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-edit" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-ellipsis-h" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-ellipsis-v" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-envelope" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-envelope-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-envelope-open" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-envelope-open-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-envelope-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-eraser" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-exchange" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-exclamation" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-exclamation-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-exclamation-triangle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-external-link" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-external-link-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-eye" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-eye-slash" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-eyedropper" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-fax" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-feed" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-female" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-fighter-jet" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-archive-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-audio-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-code-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-excel-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-image-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-movie-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-pdf-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-photo-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-picture-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-powerpoint-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-sound-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-video-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-word-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-file-zip-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-film" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-filter" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-fire" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-fire-extinguisher" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-flag" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-flag-checkered" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-flag-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-flash" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-flask" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-folder" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-folder-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-folder-open" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-folder-open-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-frown-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-futbol-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-gamepad" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-gavel" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-gear" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-gears" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-gift" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-glass" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-globe" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-graduation-cap" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-group" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-grab-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-lizard-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-paper-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-peace-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-pointer-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-rock-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-scissors-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-spock-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hand-stop-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-handshake-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hard-of-hearing" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hashtag" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hdd-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-headphones" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-heart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-heart-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-heartbeat" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-history" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-home" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hotel" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-1" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-2" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-3" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-end" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-half" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-hourglass-start" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-i-cursor" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-id-badge" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-id-card" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-id-card-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-image" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-inbox" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-industry" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-info" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-info-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-institution" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-key" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-keyboard-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-language" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-laptop" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-leaf" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-legal" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-lemon-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-level-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-level-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-life-bouy" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-life-buoy" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-life-ring" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-life-saver" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-lightbulb-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-line-chart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-location-arrow" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-lock" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-low-vision" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-magic" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-magnet" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mail-forward" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mail-reply" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mail-reply-all" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-male" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-map" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-map-marker" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-map-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-map-pin" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-map-signs" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-meh-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-microchip" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-microphone" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-microphone-slash" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-minus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-minus-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-minus-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-minus-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mobile" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mobile-phone" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-money" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-moon-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mortar-board" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-motorcycle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-mouse-pointer" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-music" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-navicon" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-newspaper-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-object-group" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-object-ungroup" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-paint-brush" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-paper-plane" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-paper-plane-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-paw" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-pencil" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-pencil-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-pencil-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-percent" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-phone" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-phone-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-photo" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-picture-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-pie-chart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plane" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plug" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plus-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plus-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-plus-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-podcast" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-power-off" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-print" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-puzzle-piece" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-qrcode" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-question" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-question-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-question-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-quote-left" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-quote-right" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-random" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-recycle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-refresh" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-registered" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-remove" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-reorder" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-reply" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-reply-all" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-retweet" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-road" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-rocket" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-rss" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-rss-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-s15" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-search" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-search-minus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-search-plus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-send" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-send-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-server" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-share" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-share-alt" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-share-alt-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-share-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-share-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-shield" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-ship" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-shopping-bag" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-shopping-basket" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-shopping-cart" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-shower" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sign-in" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sign-language" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sign-out" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-signal" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-signing" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sitemap" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sliders" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-smile-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-snowflake-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-soccer-ball-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-alpha-asc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-alpha-desc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-amount-asc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-amount-desc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-asc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-desc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-numeric-asc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-numeric-desc" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sort-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-space-shuttle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-spinner" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-spoon" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-square" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-square-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star-half" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star-half-empty" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star-half-full" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star-half-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-star-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sticky-note" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sticky-note-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-street-view" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-suitcase" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-sun-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-support" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tablet" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tachometer" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tag" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tags" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tasks" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-taxi" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-television" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-terminal" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-0" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-1" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-2" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-3" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-4" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-empty" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-full" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-half" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-quarter" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thermometer-three-quarters" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thumb-tack" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thumbs-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thumbs-o-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thumbs-o-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-thumbs-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-ticket" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-times" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-times-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-times-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-times-rectangle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-times-rectangle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tint" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-left" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-off" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-on" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-right" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-toggle-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-trademark" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-trash" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-trash-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tree" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-trophy" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-truck" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tty" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-tv" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-umbrella" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-universal-access" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-university" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-unlock" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-unlock-alt" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-unsorted" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-upload" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-circle" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-circle-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-plus" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-secret" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-user-times" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-users" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-vcard" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-vcard-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-video-camera" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-volume-control-phone" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-volume-down" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-volume-off" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-volume-up" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-warning" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-wheelchair" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-wheelchair-alt" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-wifi" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-window-close" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-window-close-o" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-window-maximize" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-window-minimize" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-window-restore" onclick="store.selectIcon(this);"></span>\t\t\t\t<span class="fa fa-wrench" onclick="store.selectIcon(this);"></span>\t\t\t</div>'})},sendService:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a},s=null;$(t).find(".iGroup").each(function(t,e){!$(e).find("label").next().val()&&$.inArray($(e).find("label").next().attr("name"),["name","content"])>0?(s="The field can not be empty",$(e).find("label").next().css("border-color","#f00")):$(e).find("label").next().attr("name")&&($(e).find("label").next().css("border-color","#ddd"),n[$(e).find("label").next().attr("name")]=$(e).find("label").next().val())}),$('textarea[name="content"]').val()?n.content=$('textarea[name="content"]').val():s="Description can not be empty",n.price=$('input[name="price"]').val(),n.currency=$('select[name="currency"]').val(),n.category=$('input[name="category"]').data()?Object.keys($('input[name="category"]').data())[0]:0,n.blog=$('input[name="blog"]').data()?Object.keys($('input[name="blog"]').data())[0]:0,s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/store/send_service",n,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t<=0?alr.show({class:"alrDanger",content:lang[13],delay:2}):(alr.show({class:"alrSuccess",content:"Service was successfully "+(a?lang[23]:lang[24]),delay:2}),Page.get("/store/services/edit/"+t))})},delService:function(t){$.post("/store/del_service",{id:t},function(e){"OK"==e?$("#service_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendPost:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={id:a},s=null;$(t).find(".iGroup").each(function(t,e){!$(e).find("label").next().val()&&$.inArray($(e).find("label").next().attr("name"),["name","descr"])>0?(s="The field can not be empty",$(e).find("label").next().css("border-color","#f00")):$(e).find("label").next().attr("name")&&($(e).find("label").next().css("border-color","#ddd"),n[$(e).find("label").next().attr("name")]=$(e).find("label").next().val())}),$('textarea[name="content"]').val()?n.content=$('textarea[name="content"]').val():s=lang[25],s?(alr.show({class:"alrDanger",content:s,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.post("/store/send_post",n,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t.id<=0?alr.show({class:"alrDanger",content:lang[13],delay:2}):(alr.show({class:"alrSuccess",content:lang[22]+(a?lang[23]:lang[24]),delay:2}),t.delivery?(store.id=t.id,store.mail(t.delivery,0,!0)):Page.get("/store/blog/edit/"+t.id))},"json")},delBlog:function(t){$.post("/store/del_post",{id:t},function(e){"OK"==e?$("#post_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},mail:function(t,e,a){a&&($("#all").text(t.count),$("#sended").text(0)),$.post("/store/delivery",{lid:lid},function(t){$("#sended").text(parseInt($("#sended").text())+1),t.delivery?store.mail(t.delivery,t.lId,!1):Page.get("/store/blog/edit/"+store.id)})},addCategory:function(t,e,a){$.post("/store/allCategories",{id:t||"",nIds:Object.keys(a||{}).join(",")},function(n){n&&(items="",$.each(n.list,function(t,e){items+='<li data-value="'+e.id+'">'+e.name+"</li>",lId=e.id}),mdl.open({id:"select_par",title:(t?lang[17]:lang[18])+lang[19],content:'<form  method="post" onsubmit="store.sendCategory(this, event, '+(t||0)+');">\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<label>'+lang[20]+'</label>\t\t\t\t\t\t\t<input type="text" name="name" value="'+(e||"")+'">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="iGroup">\t\t\t\t\t\t\t<input type="hidden" name="parent">\t\t\t\t\t\t\t<div class="lbl">'+lang[21]+'</div>\t\t\t\t\t\t\t<ul class="hdn">'+items+'</ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="sGroup">\t\t\t\t\t\t\t<button class="btn btnSubmit">'+(t?lang[17]:lang[18])+"</button>\t\t\t\t\t\t</div>\t\t\t\t\t</form>",cb:function(){nIds=[],$('input[name="parent"]').data(a),$("#select_par").find("ul").sForm({action:"/store/allCategories",data:{lId:lId,query:$("#select_par").find("input").val(),nIds:Object.keys(a||{}).join(",")+","+t},all:n.count<=20,select:a,s:!0},$('input[name="parent"]'))}}))},"json")},sendCategory:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t);if(s.find(".iGroup > input").css("border","1px solid #ddd"),n.append("id",a),!s.find('input[name="name"]').val().length)return s.find('input[name="name"]').css("border","1px solid #f00"),alr.show({class:"alrDanger",content:lang[16],delay:2}),void loadBtn.stop($(e.target).find('button[type="submit"]'));n.append("name",s.find('input[name="name"]').val()),n.append("parent",Object.keys(s.find('input[name="parent"]').data())),$.ajax({type:"POST",processData:!1,contentType:!1,url:"/store/sendCategory",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),Page.get(location.href),mdl.close("select_par"))})},delCategory:function(t){$.post("/store/delCategory",{id:t},function(e){"OK"==e?$("#invCategory_"+t).remove():alr.show({class:"alrDanger",content:lang[9],delay:2})})},sendIntroducing:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n={},s=$(t);n.title=s.find('input[name="title"]').val(),n.content=s.find('textarea[name="content"]').val(),$.post("/store/save_introducing",n,function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),"OK"==t?alr.show({class:"alrSuccess",content:lang[15],delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})})},sortCategory:function(){var t={};$(".userList ol > li").each(function(e,a){t[$(a).attr("data-id")]={sort:$(a).index(),parent:$(a).parent().parent().attr("data-id")||0}}),$.post("/store/cat_priority",t,function(){})}},total={single:function(t,e){$(e).text(0),$(t).each(function(t,a){$(e).text((parseFloat($(e).text().replace(/[^0-9.]/g,""))+parseFloat($(a).text().replace(/[^0-9.]/g,""))).toFixed(2))}),$(e).prepend($("#issue").attr("data-currency"))},fTotal:function(){total.single(".servPrice","#serv_total"),total.single(".miniServPrice","#miniServ_total"),total.single(".invPrice","#inv_total"),total.single(".purPrice","#pur_total"),total.single("#serv_total, #inv_total, #pur_total","#totalPrice"),$("#doit").text($("#doit").text().replace(/[0-9.\s]/g,"")+(parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,""))*((100-parseFloat($("#discount").text()))/100)).toFixed(2)),parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,""))>0&&!$("#create_invoice").length&&!$("#view_invoice").length&&$(".uMore > ul").append($("<li>",{id:"create_invoice",html:$("<a/>",{href:"javascript:invoices.issCreate("+parseInt($("#issue").attr("data-id"))+", "+parseInt($("#issue").attr("data-customer"))+", "+parseInt($("#issue").attr("data-object"))+", "+parseInt($("#issue").attr("data-discount"))+");",html:$("<span/>",{class:"fa fa-credit-card"})}).append("Create invoice")})),parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,""))!=parseFloat($("#totalPrice").attr("data-total"))&&$.post("/issues/send_total",{id:parseInt($("#totalPrice").attr("data-id")),total:parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,""))},function(t){$("#totalPrice").attr("data-total",parseFloat($("#totalPrice").text().replace(/[^0-9.]/g,"")))})},miniTotal:function(t){var e=$("#pur_total").length?parseFloat($("#pur_total").text().replace(/[^0-9.]/g,"")).toFixed(2):0;$('input[name="set_inventory"]').data()&&$.each($('input[name="set_inventory"]').data(),function(t,a){e=(parseFloat(e)+parseFloat(a.price.replace(/[^0-9.]/g,""))).toFixed(2)}),$('input[name="set_services"]').data()&&$.each($('input[name="set_services"]').data(),function(t,a){e=(parseFloat(e)+parseFloat(a.price.replace(/[^0-9.]/g,""))).toFixed(2)}),$(".tPrice > div").html($("#doit").text().replace(/[0-9.\s]/g,"")+e)}},timer={time:void 0,tick:void 0,getCreate:function(t,e,a,n){$(t).replaceWith('<input type="time" value="'+e+'" onblur="timer.changeSeconds(this, '+a+", '"+n+"')\">")},winStart:function(){timer.time=parseInt($(".timerClock").attr("value")),timer.timeStart($(".timerClock").next().find(".fa").hasClass("fa-pause"),!0)},timeStart:function(t,e){var a=timer;a.tick=setTimeout(function(){$(".timerClock").attr("value",parseInt($(".timerClock").attr("value"))+1),a.time+=t?1:0,s=a.time%60,m=(a.time%3600-s)/60,h=Math.abs((a.time%86400-s-60*m)/3600),s=Math.abs(s),m=Math.abs(m),$(".timerClock").text((a.time<0?"-":"")+h+":"+(m<10?"0"+m:m)+":"+(s<10?"0"+s:s)),t&&a.timeStart(!0)},e?0:1e3)},confirm:function(t){var e="";switch(t){case"start":e=lang[156],side=1;break;case"pause":e=lang[157],side=0;break;case"stop":side=0,e=lang[158]}$.post("/timer/getTime",{side:side,event:t},function(a){mdl.open({id:"confirmation",title:"Please, confirm",content:$("<div/>",{class:"aCenter",html:$("<div/>",{html:e+"<br>"+a})}).append($("<div/>",{class:"cashGroup",html:$("<button/>",{class:"btn btnSubmit ac",onclick:"timer.accept('"+t+"');",html:lang[159]})}).append($("<button/>",{class:"btn btnSubmit dc",onclick:"mdl.close();",html:lang[160]})))})})},accept:function(t){var e=$(".timerClock").next().find(".fa"),a={};$.post("/timer",{a:t,id:$(".timerClock").attr("data-id")},function(n){if(n.indexOf("}")>0&&(a=JSON.parse(n)),"IP"==n)alr.show({class:"alrDanger",content:"You can not login from this IP",delay:2});else if(a.id>0&&n.indexOf("}")>0){switch(t.trim()){case"start":e.removeClass("fa-play").addClass("fa-pause").attr("onclick","timer.confirm('pause')"),$(".timerClock").attr("data-id",a.id),timer.timeStart(!0);break;case"pause":case"stop":e.removeClass("fa-pause").addClass("fa-play").attr("onclick","timer.confirm('start')"),timer.timeStop(t)}mdl.close(),1==a.cash&&Page.get("/cash")}else n?alr.show({class:"alrDanger",content:n,delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},timeStop:function(t){$(".timerClock").attr("data-id")>0?(clearTimeout(timer.tick),"stop"==t&&$(".timerClock").attr("data-id","")):alr.show({class:"alrDanger",content:lang[14],delay:2})},changeSeconds:function(t,e,a){t.value&&($(t).replaceWith("<span onclick=\"timer.getCreate(this, '"+t.value+"', "+e+", '"+a+"')\">"+t.value+"</span>"),$.post("/timer/create_time",{time:t.value,id:e,type:a},function(t){"OK"==t&&$.getJSON(location.href,function(t){$("#page").html(t.content)})}))},week:function(){$("#week").length?mdl.close("week"):$.post("/timer/week",{},function(t){t&&mdl.open({id:"week",width:"700px",class:"weekInfo",title:"Your punch card for this week",content:t})})}},analytics={online_users:function(){$.post("/analytics/online_users",data,function(t){parseInt(t)&&$("#visitors_online > span").html(parseInt(t))})},site_visitors:function(t){var e=$(t).parents(".filterCtnr"),a={date_start:$('#calendar5 > input[name="date"]').val(),date_finish:$('#calendar5 > input[name="fDate"]').val()};loadBtn.start($(t)),date=[$('#calendar5 > input[name="date"]').val(),$('#calendar5 > input[name="fDate"]').val()],$.post("/analytics/site_stat",a,function(a){if(loadBtn.stop($(t)),a){var n=Math.min.apply(null,a.data.visitors.map(function(t){return t[1]})),s=Math.max.apply(null,a.data.hosts.map(function(t){return t[1]})),l=(s-n?round100(parseInt((s-n)/10),100,!0):n)||0;n=round100(n,l),s=round100(s,l,!0),"Infinity"==Math.abs(n)&&(n=0),"Infinity"==Math.abs(s)&&(s=0),$("#site_stat_plot").empty(),makeStat.init({id:"site_stat_plot",s:60,w:1140,h:450,x:[0,a.last||23,a.step,a.labels,(date&&date[0]==date[1]?lang[145]:lang[146])+": "],y:[n,s,l,!0,"Count: "],data:[{id:"hosts",points:a.data.hosts,color:"#36b1e6"},{id:"visitors",points:a.data.visitors,color:"#ff0000"}]}),e.hide(),$("#visitors_online > span").html(a.data.online)}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},inventory_plot:function(t){var e=$(t).parents(".filterCtnr"),a={date_start:$('#calendar_plot > input[name="date"]').val(),date_finish:$('#calendar_plot > input[name="fDate"]').val(),object:Object.keys($('input[name="object_stat"]').data()).join(","),inventory:1};loadBtn.start($(t)),date=[$('#calendar_plot > input[name="date"]').val(),$('#calendar_plot > input[name="fDate"]').val()],$.post("/analytics/sold_plot",a,function(a){if(loadBtn.stop($(t)),a){var n=a.data,s=Math.min.apply(null,n.profit.map(function(t){return t[1]})),l=Math.max.apply(null,n.sold.map(function(t){return t[1]})),o=(l-s?round100(parseInt((l-s)/10),100,!0):s)||0;s=round100(s,o),l=round100(l,o,!0),"Infinity"==Math.abs(s)&&(s=0),"Infinity"==Math.abs(l)&&(l=0),$("#stat").empty(),makeStat.init({id:"stat",s:60,w:1140,h:450,x:[0,a.last||23,a.step,a.labels,(date?date[0]==date[1]?lang[145]:lang[146]:lang[145])+": "],y:[s,l,o,!0,"Sales: $"],data:[{points:n.sold,color:"#36b1e6"},{points:n.purchase,color:"#ff0000"},{points:n.profit,color:"#b7bd06"}]}),e.hide()}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},tradein_plot:function(t){var e=$(t).parents(".filterCtnr"),a={date_start:$('#calendar_plot > input[name="date"]').val(),date_finish:$('#calendar_plot > input[name="fDate"]').val(),object:Object.keys($('input[name="object_stat"]').data()).join(","),tradein:1,purchases:1};loadBtn.start($(t)),date=[$('#calendar_plot > input[name="date"]').val(),$('#calendar_plot > input[name="fDate"]').val()],$.post("/analytics/sold_plot",a,function(a){if(loadBtn.stop($(t)),a){var n=a.data,s=Math.min.apply(null,n.profit.map(function(t){return t[1]})),l=Math.max.apply(null,n.sold.map(function(t){return t[1]})),o=(l-s?round100(parseInt((l-s)/10),100,!0):s)||0;s=round100(s,o),l=round100(l,o,!0),"Infinity"==Math.abs(s)&&(s=0),"Infinity"==Math.abs(l)&&(l=0),$("#stat").empty(),makeStat.init({id:"stat",s:60,w:1140,h:450,x:[0,a.last||23,a.step,a.labels,(date?date[0]==date[1]?lang[145]:lang[146]:lang[145])+": "],y:[s,l,o,!0,"Sales: $"],data:[{points:n.sold,color:"#36b1e6",id:"sold"},{points:n.purchase,color:"#ff0000",id:"purchase"},{points:n.profit,color:"#b7bd06",id:"profit"}]}),e.hide()}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},new_users:function(t){loadBtn.start($(t)),$.post("/analytics/new_users",{date_start:$('#calendar4 > input[name="date"]').val(),date_finish:$('#calendar4 > input[name="fDate"]').val()},function(e){if(loadBtn.stop($(t)),e){var a=e.data,n=Math.min.apply(null,a.map(function(t){return t[1]})),s=Math.max.apply(null,a.map(function(t){return t[1]})),l=(s-n?round100(parseInt(s-n),10,!0):n)||0;n=round100(n,l),s=round100(s,l,!0),"Infinity"==Math.abs(n)&&(n=0),"Infinity"==Math.abs(s)&&(s=0),$("#users_plot").empty(),makeStat.init({id:"users_plot",s:60,w:1140,h:450,x:[0,e.last-1||5,e.step,e.labels,"Date: "],y:[n,s,l,!0,"Count: "],data:[{points:a,color:"#36b1e6",id:"plot_new_users"},{points:e.returned,color:"#88b52d",id:"plot_returned_users"}],plusx:0}),$("#total_customers").text("(Total: "+e.users+")")}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},feedback:function(t){loadBtn.start($(t)),$.post("/analytics/feedback_report",{date_start:$("#calendar3").lenght?$('#calendar3 > input[name="date"]').val():$('#calendar > input[name="date"]').val(),date_finish:$("#calendar3").lenght?$('#calendar3 > input[name="fDate"]').val():$('#calendar > input[name="fDate"]').val()},function(e){if(loadBtn.stop($(t)),e){var a=e.data,n=Math.min.apply(null,a.map(function(t){return t[1]})),s=Math.max.apply(null,a.map(function(t){return t[1]})),l=(s-n?round100(parseInt((s-n)/10),100,!0):n)||0;n=round100(n,l),s=round100(s,l,!0),"Infinity"==Math.abs(n)&&(n=0),"Infinity"==Math.abs(s)&&(s=0),$("#feedbacks_plot").empty(),makeStat.init({id:"feedbacks_plot",s:60,w:1140,h:450,x:[0,e.last-1||5,e.step,e.labels,"Rating: "],y:[0,s,10,!0,"Count: "],data:[{points:a,color:"#36b1e6",dash:!0,id:"by_count"}],plusx:1}),$("#freport").html(e.stores),t&&$('[data-value="middle_value"]').hasClass("active")&&analytics.feedback_by_day()}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},feedback_by_day:function(t){loadBtn.start($(t)),$.post("/analytics/feedback_by_day",{date_start:$("#calendar3").lenght?$('#calendar3 > input[name="date"]').val():$('#calendar > input[name="date"]').val(),date_finish:$("#calendar3").lenght?$('#calendar3 > input[name="fDate"]').val():$('#calendar > input[name="fDate"]').val()},function(e){if(loadBtn.stop($(t)),e){var a=e.data,n=Math.min.apply(null,a.map(function(t){return t[1]})),s=Math.max.apply(null,a.map(function(t){return t[1]})),l=(s-n?round100(parseInt((s-n)/10),100,!0):n)||0;n=round100(n,l),s=round100(s,l,!0),"Infinity"==Math.abs(n)&&(n=0),"Infinity"==Math.abs(s)&&(s=0),$("#feedback_by_day").empty(),makeStat.init({id:"feedback_by_day",s:60,w:1140,h:450,x:[0,e.last-1||5,e.step,e.labels,"Rating: "],y:[0,5,1,!0,"Count: "],data:[{points:a,color:"#36b1e6",dash:!0,id:"by_day"}],plusx:1})}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},expansesReport:function(t,e){loadBtn.start($(t));var a={},n=null;$('input[name="date"]').val()||e||(n="Please, choose period"),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):(e||(a.objects=Object.keys($('input[name="object"]').data()).join(","),a.date_start=$('#calendar > input[name="date"]').val(),a.date_finish=$('#calendar > input[name="fDate"]').val()),$.post("/analytics/expanses_report",a,function(e){loadBtn.stop($(t)),e?$("#report").html(e.report).append($("<div/>",{class:"roTotal",html:"Total: "+e.total})):$("#report").empty()},"json"))},purchasesReport:function(t,e){loadBtn.start($(t));var a={},n=null;$('input[name="date"]').val()||e||(n="Please, choose period"),n?(alr.show({class:"alrDanger",content:n,delay:2}),loadBtn.stop($(t))):(e||(a.objects=Object.keys($('input[name="object"]').data()).join(","),a.type=$('select[name="type"]').val(),a.date_start=$('#calendar > input[name="date"]').val(),a.date_finish=$('#calendar > input[name="fDate"]').val()),$.post("/analytics/purchases_report",a,function(e){loadBtn.stop($(t)),e?$("#report").html(e.report).append($("<div/>",{class:"roTotal",html:"Total: "+e.total})):$("#report").empty()},"json"))},sales:function(t){var e=$(t).parents(".filterCtnr"),a={date:$('input[name="date_stat"]').val(),object:$('select[name="object_stat"]').val(),cash:$('input[name="pay_cash"]').val(),credit:$('input[name="pay_credit"]').val(),check:$('input[name="pay_check"]').val(),merchaine:$('input[name="pay_merchaine"]').val(),compare_period:$('input[name="compare_period"]').val()};loadBtn.start($(t)),date=a.date.split(" / "),$.post("/analytics/sales",a,function(a){if(loadBtn.stop($(t)),a){var n=a.data,s=Math.min.apply(null,n.map(function(t){return t[1]})),l=Math.max.apply(null,n.map(function(t){return t[1]})),o=(l-s?round100(parseInt((l-s)/10),100,!0):s)||0;s=round100(s,o),l=round100(l,o,!0),"Infinity"==Math.abs(s)&&(s=0),"Infinity"==Math.abs(l)&&(l=0),$("#stat").empty(),makeStat.init({id:"stat",s:60,w:1140,h:450,x:[0,a.last-1||23,a.step,a.labels,(date?date[0]==date[1]?lang[145]:lang[146]:lang[145])+": "],y:[s,l,o,!0,"Sales: $"],data:[{points:n,color:"#36b1e6"}],red_line:4e3,black_line:4,violet_line:!0,compare_line:$('input[name="compare_period"]').val()||0}),e.hide()}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},points:function(t){var e=$(t).parents(".filterCtnr"),a={date:$('input[name="date_points"]').val(),object:$('select[name="object_points"]').val(),user:Object.keys($('input[name="user_points"]').data()).join(",")};loadBtn.start($(t)),date=a.date.split(" / "),$.post("/analytics/points",a,function(n){if(loadBtn.stop($(t)),n){var s=n.data,l=Math.min.apply(null,s.map(function(t){return t[1]})),o=Math.max.apply(null,s.map(function(t){return t[1]})),c=(o-l?round100(parseInt((o-l)/10),100,!0):l)||0;l=round100(l,c),o=round100(o,c,!0),"Infinity"==Math.abs(l)&&(l=0),"Infinity"==Math.abs(o)&&(o=0),$("#eff").empty(),makeStat.init({id:"eff",s:60,w:1140,h:450,x:[0,n.last-1||23,n.step,n.labels,(a.date&&date[0]==date[1]?lang[145]:lang[146])+": "],y:[l,o,c,!0,lang[115]+": "],data:[{points:s,color:"#36b1e6"}]}),e.hide()}else alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")}};$("body").on("click",function(t){$(t.target).hasClass("cl")||$(".calendar").hide()});var dashbord={appointments:function(){$.post("/main/appointments",{},function(t){$("#tbl_appointments").html(t)})},uncofirmed:function(){$.post("/main/uncofirmed",{},function(t){$("#conf_services").html(t.services),$("#conf_inventory").html(t.inventory),$("#conf_discounts").html(t.discounts),$("#conf_warranty").html(t.warranty),$("#conf_services").parent().next().remove(),$("#conf_inventory").parent().next().remove(),$("#conf_discounts").parent().next().remove(),$("#conf_warranty").parent().next().remove()},"json")},drops:function(){$.post("/main/drops",{},function(t){$("#drops").html(t),$("#drops").next().remove()})},onsite:function(){$.post("/main/onsite",{},function(t){$("#onsite_list").html(t.list),$("#onsite_details_list").html(t.details_list),$("#onsite_invoices_list").html(t.invoices_list),$("#onsite_uncofirmed_list").html(t.uncofirmed_list),$("#onsite_list").parent().next().remove(),$("#onsite_details_list").parent().next().remove(),$("#onsite_invoices_list").parent().next().remove(),$("#onsite_uncofirmed_list").parent().next().remove()},"json")},issues:function(){$.post("/main/issues",{},function(t){$("#issues_list").html(t.issues),$("#store_issues_list").html(t.store_issues),$("#issues_list").parent().next().remove(),$("#store_issues_list").parent().next().remove()},"json")},my_issues:function(){$.post("/main/my_issues",{},function(t){$("#my_issues_list").html(t),$("#my_issues_list").parent().next().remove()})},object_issues:function(){$.post("/main/store_issues",{},function(t){$("#object_issues_list").html(t),$("#object_issues_list").parent().next().remove()})},timer:function(){$.post("/main/timer",{},function(t){$("#timers_list").html(t),$("#timers_list").parent().next().remove()})},cash_stat:function(){$.post("/main/cash_stat",{},function(t){$("#cash_stat_list").html(t),$("#cash_stat_list").parent().next().remove()})},feedbacks:function(){$.post("/main/feedbacks",{},function(t){$("#feedbacks_list").html(t),$("#feedbacks_list").parent().next().remove()})},purchases:function(){$.post("/main/purchases",{},function(t){$("#tbl_purchases").html(t.purchases),$("#tbl_purchases").parent().next().remove()},"json")},confirm_drop:function(t,e,a){var n={id:t,action:e};$.post("/cash/confirm_drop",n,function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"Drop was successfully "+lang[e],delay:2}),$("#drop_"+t).remove()):"ERR"==a?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})}},Languages={save:function(t,e){var t=$(t).serializeArray();e.preventDefault(),$.post("/settings/saveLang",t,function(t){"OK"==t?alr.show({class:"alrSuccess",content:lang[1],delay:2}):alr.show({class:"alrDanger",content:lang[1],delay:2})})},get:function(t){$.post("/settings/getLang",{lang:t},function(t){$('select[name="module"]').html(t).next().remove().parent().select()})},getModule:function(t){var e=t.split("_");$.post("/settings/getLangModule",{lang:$('select[name="lang"]').val(),type:e[0],module:e[1]},function(t){$("#phrases").html(t)})}},salary={sendPointsEdit:function(t,e){$(e).val()?$(e).val()==parseFloat($(e).attr("old-value"))?$(e).parent().html($(e).val()):$.post("/salary/edit_points",{id:t,value:$(e).val(),oldValue:$(e).attr("old-value")},function(a){"OK"==a?(alr.show({class:"alrSuccess",content:"Points was successfully sent",delay:2}),$(e).parent().attr("ondblclick","salary.pointsEdit("+t+", this)").html($(e).val())):(alr.show({class:"alrDanger",content:lang[13],delay:2}),$(e).parent().html($(e).attr("old-value")))}):alr.show({class:"alrDanger",content:"Value can not be empty",delay:2})},pointsEdit:function(t,e){$(e).attr("ondblclick","").html($("<input/>",{name:"new_points",type:"number",class:"quickEdit",value:$(e).text(),"old-value":$(e).text(),onblur:"salary.sendPointsEdit("+t+", this);"})),$(e).find("input").focus()},pointsPayout:function(t,e){$.post("/salary/points_payout",{id:t,amount:$(e).prev().val()},function(t){if("OK"==t){var a=$(e).parent().parent();$(e).prev().val(0),a.find(".pPoints").text(parseFloat(parseFloat(a.find(".pPoints").text().replace(/[^0-9.-]/g,""))+parseFloat(a.find(".pCurrent").text().replace(/[^0-9.-]/g,""))).toFixed(2)),a.find(".pCurrent").text(0),alr.show({class:"alrSuccess",content:"Payout was successfully sent",delay:2})}else alr.show({class:"alrDanger",content:lang[13],delay:2})})},makeSalary:function(t,e,a,n){$.post("/salary/make",{id:t,object_id:e,amount:a,lDate:$('#calendar > input[name="fDate"]').val(),sDate:$('#calendar > input[name="date"]').val()},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Payment done",delay:2}),$(n).parent().parent().remove()):"DONE"==t?alr.show({class:"alrDanger",content:"Staff has already get salary on that period. Please, check payment period",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})}},phones={newPhone:function(){$(".nPhone").before($("<div/>",{class:"sPhone",html:$("<span/>",{class:"fa fa-times rd",onclick:"$(this).parent().remove();"})}).append($("<select/>",{name:"phoneCode",html:$("<option/>",{value:"0",html:"None"})}).append($("<option/>",{value:"+1",html:"+1"})).append($("<option/>",{value:"+3",html:"+3"}))).append($("<span/>",{class:"wr",html:"("})).append($("<input/>",{type:"number",name:"code",max:"999",onkeyup:"phones.next(this, 3);"})).append($("<span/>",{class:"wr",html:")"})).append($("<input/>",{type:"number",name:"part1",onkeyup:"phones.next(this, 7);"})).append($("<input/>",{type:"number",name:"part2"})).append($("<input/>",{type:"checkbox",name:"sms",onchange:"phones.onePhone(this);"}))),$("#page").select(),$("#page").checkbox()},onePhone:function(t){var e=$(t).val();$('input[name="sms"]').attr("onchange","").val(0).prop("checked",0),1==e&&$(t).val(1).prop("checked",1),$('input[name="sms"]').attr("onchange","phones.onePhone(this);")},next:function(t,e){$(t).val().length==e&&($(t).next().hasClass("wr")?$(t).next().next().focus():$(t).next().focus())}},faq={send:function(t,e,a){e.preventDefault(),loadBtn.start($(t).find('button[type="submit"]'));var n={id:a},s=null;$(t).find('input[name="title"]').val()?$(t).find('textarea[name="content"]').val()?(n.title=$(t).find('input[name="title"]').val(),n.content=$(t).find('textarea[name="content"]').val()):s="Content can not be empty":s="Title can not be empty",s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/faq/send",n,function(e){loadBtn.stop($(t).find('button[type="submit"]')),"OK"==e?(alr.show({class:"alrSuccess",content:"FAQ was succefully sent",delay:2}),Page.get("/faq")):"no_acc"==e?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})},del:function(t,e){$.post("/faq/del",{id:t},function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"FAQ was succefully deleted",delay:2}),$(e).parent().parent().remove()):"no_acc"==t?alr.show({class:"alrDanger",content:"You have no access to do this",delay:2}):alr.show({class:"alrDanger",content:lang[13],delay:2})})}},camera={cpage:0,showVideo:function(t){mdl.open({id:"showVideo",title:"Camera shoot",content:'<div class="video-camera">\t\t\t\t<video width="470" height="265" controls src="/video.mov">\t\t\t\t\tYour browser does not support the video tag.\t\t\t\t</video>\t\t\t</div>'})},comments:function(t){camera.cpage=0,$.post("/camera/comments",{id:t},function(e){mdl.open({id:"cameraComments",title:"Comments",content:$("<div/>",{html:$("<div/>",{class:"comments",html:e.content})}).append($("<button/>",{class:"btn btnLoad"+(e.left_count>0?"":" hdn"),onclick:"camera.doloadComments(this,"+t+");",html:"Load commetns"})).append($("<div/>",{class:"commentForm",html:$("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Status"})}).append($("<select/>",{name:"status",html:e.statuses}))}).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Leave comment"})}).append($("<textarea/>",{name:"comment"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"camera.sendComment("+t+");",html:"Send"})}))),cb:function(){$("select").select()}})},"json")},sendComment:function(t){$('textarea[name="comment"]').val()?parseInt($('select[name="status"]').val())?$.post("/camera/send_comment",{id:t,text:$('textarea[name="comment"]').val(),status:$('select[name="status"]').val()},function(t){"OK"==t.res?(alr.show({class:"alrSuccess",content:"Comment was successfully added",delay:2}),$(".comments").append(t.html),$('textarea[name="comment"]').val(""),p=($(window).height()-$(".mdl").height())/2,$(".mdlWrap").css("padding-top",(p<70?70:p)+"px")):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json"):alr.show({class:"alrDanger",content:"Status can not be empty",delay:2}):alr.show({class:"alrDanger",content:"Comment can not be empty",delay:2})},doloadComments:function(t,e){camera.cpage+=1,$.post("/camera/comments",{id:e,page:camera.cpage},function(e){$(".comments").append(e.content),e.left_count||$(t).addClass("hdn")},"json")},openStatus:function(t,e){mdl.open({id:"openStatus",title:(t?lang[17]:lang[18])+lang[121],content:$("<div/>",{html:$("<div/>",{class:"iGroup",html:$("<label/>",{html:lang[20]})}).append($("<input/>",{type:"text",name:"name",value:e||""}))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",onclick:"camera.sendStatus(this, "+t+")",html:t?lang[113]:lang[91]})}))})},sendStatus:function(t,e){var a=$(t).parents(".mdlBody"),n={},s=null;e&&(n.id=e),a.find("input").css("border-color","#ddd"),a.find('input[name="name"]').val().length?n.name=a.find('input[name="name"]').val():(s=lang[16],a.find('input[name="name"]').css("border-color","#f00")),s?alr.show({class:"alrDanger",content:s,delay:2}):$.post("/camera/send_status",n,function(t){loadBtn.stop($(this)),t?"no_acc"==t?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):(alr.show({class:"alrSuccess",content:lang[114],delay:2}),mdl.close("openStatus"),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})},"json")},delStatus:function(t){t?$.post("/camera/del_status",{id:t},function(e){"OK"==e?$("#status_"+t).remove():"no_acc"==e?alr.show({class:"alrDanger",content:"You are not allowed to do this",delay:2}):alr.show({class:"alrDanger",content:lang[9],delay:2})}):$(el).parents(".sUser").remove()},sendPriority:function(t){var e={};$(".sUser").each(function(t,a){e[t]={id:$(a).attr("id").replace("status_",""),pr:$(a).find("input").val()}}),e&&$.post("/camera/st_priority",e,function(t){})},addActivity:function(){$.post("/users/all",{staff:1},function(t){var e="",a=0;t.list&&$.each(t.list,function(t,n){e+='<li data-value="'+n.id+'">'+n.name+"</li>",a=n.id}),$.post("/invoices/objects",{all:1},function(t){var n="",s=0;t.list&&$.each(t.list,function(t,e){n+='<li data-value="'+e.id+'">'+e.name+"</li>",s=e.id}),$.post("/camera/allStatus",{},function(t){var l="",o=0;t.list&&$.each(t.list,function(t,e){l+='<option value="'+e.id+'">'+e.name+"</option>",o=e.id}),mdl.open({id:"add_activity",title:"Add activity",content:$("<form/>",{class:"uForm",html:$("<div/>",{class:"iGroup fw price",id:"store",html:$("<label/>",{html:"Store"})}).append($("<input/>",{type:"hidden",name:"store"})).append($("<ul/>",{class:"hdn",html:n}))}).append($("<div/>",{class:"iGroup fw dGroup ",html:$("<label/>",{html:"Date"})}).append($("<input/>",{type:"text",class:"cl",name:"date_start",onclick:"closeCalendar(); $(this).next().show().parent().addClass('act');"})).append($("<div/>",{id:"sCalendar"}))).append($("<div/>",{class:"iGroup fw wp50",html:$("<label/>",{html:"Time"})}).append($("<input/>",{type:"time",name:"time"}))).append($("<div/>",{class:"iGroup fw wp50",html:$("<label/>",{html:"End Time"})}).append($("<input/>",{type:"time",name:"end_time"}))).append($("<div/>",{class:"dCLear"})).append($("<div/>",{class:"iGroup fw",id:"mdl_staff",html:$("<label/>",{html:"Staff"})}).append($("<input/>",{type:"hidden",name:"mdl_staff"})).append($("<ul/>",{class:"hdn",html:e}))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Status"})}).append($("<select/>",{name:"status",html:$("<option/>",{value:"0",html:"No status"})}).append(l))).append($("<div/>",{class:"iGroup fw",html:$("<label/>",{html:"Activity"})}).append($("<textarea/>",{name:"activity"}))).append($("<div/>",{class:"sGroup",html:$("<button/>",{type:"button",class:"btn btnSubmit",onclick:"camera.sendActivity(this);",html:"Done"})})),cb:function(){$("select").select(),$("#sCalendar").calendar(function(){$('input[name="date_start"]').val($('#sCalendar > input[name="date"]').val()),$(".dGroup > input + div").hide().parent().removeClass("act")}),$(".uForm").on("click",function(t){$(t.target).hasClass("cl")||(console.log($(t.target).hasClass("cl")),$(".calendar").hide().parents(".iGroup").removeClass("act"))}),$("#store > ul").html(n).sForm({action:"/invoices/objects",data:{lId:s,query:$("#object > .sfWrap input").val()||"",all:1},all:!1,select:$('input[name="store"]').data(),s:!0,link:"objects/edit"},$('input[name="store"]')),$("#mdl_staff > ul").html(e).sForm({action:"/users/all",data:{lId:a,query:$("#staff > .sfWrap input").val()||"",staff:1},all:!1,select:$('input[name="mdl_staff"]').data(),s:!1,link:"users/view"},$('input[name="mdl_staff"]'))}})},"json")},"json")},"json")},sendActivity:function(){if($('textarea[name="activity"]').val()){var t={object:Object.keys($('input[name="store"]').data()).join(","),staff:Object.keys($('input[name="mdl_staff"]').data()).join(","),date:$('input[name="date_start"]').val(),time:$('input[name="time"]').val(),end_time:$('input[name="end_time"]').val(),activity:$('textarea[name="activity"]').val(),status:$('select[name="status"]').val()},e=null;t.object?t.staff?t.date?t.time?parseInt(t.status)||(e="Please, enter status"):e="Please, enter time":e="Please, enter date":e="Please, enter staff":e="Please, enter object",e?alr.show({class:"alrDanger",content:e,delay:2}):$.post("/camera/add_activity",t,function(t){"OK"==t?(alr.show({class:"alrSuccess",content:"Activity was successfully added",delay:2}),mdl.close(),Page.get(location.href)):alr.show({class:"alrDanger",content:lang[13],delay:2})})}else alr.show({class:"alrDanger",content:"Enter activity",delay:2})}},sendMessage={mdl:function(t,e){$.post("/users/all",{staff:1},function(a){var n="",s=0;a.list&&$.each(a.list,function(t,e){n+='<li data-value="'+e.id+'">'+e.name+"</li>",s=e.id}),mdl.open({id:"sendMessage",title:"Select staff",content:$("<div/>",{html:$("<div/>",{class:"iGroup fw",id:"staff",html:$("<label/>",{html:"Staff"})}).append($("<input/>",{type:"hidden",name:"staff"})).append($("<ul/>"))}).append($("<div/>",{class:"sGroup",html:$("<button/>",{class:"btn btnSubmit",html:"Send",type:"button",onclick:"sendMessage.send("+t+", '"+e+"');"})})),cb:function(){$("#staff > ul").html(n).sForm({action:"/users/all",data:{lId:s,query:$("#staff > .sfWrap input").val()||"",staff:1},all:!1,s:!0,link:"users/view"},$('input[name="staff"]'))}})},"json")},send:function(t,e){Page.get("/im/"+Object.keys($('input[name="staff"]').data())[0]+"?text="+e+";"+t)}},agents={addStore:function(t,e,a){e.preventDefault(),loadBtn.start($(e.target).find('button[type="submit"]'));var n=new FormData,s=$(t).serializeArray(),l=null;n.append("id",a);for(var o=0;o<s.length;o++){if("email"==s[o].name){if(!s[o].value.length||!is_valid.email(s[o].value)){l=s[o].value.length?lang[2]:lang[3];break}}else if("phone"==s[o].name){if(!s[o].value.length||!is_valid.phone(s[o].value)){l=s[o].value.length?lang[4]:lang[5];break}}else if("name"==s[o].name){if(!s[o].value.length){l=lang[8];break}}else if("work_time_start"==s[o].name||"work_time_end"==s[o].name){if(!s[o].value.length){l="Working time can not be empty";break}}else if("timezone"==s[o].name&&!s[o].value.length){l="Timezone can not be empty";break}n.append(s[o].name,s[o].value)}var c="",i=0;$(".sPhone").each(function(t,e){if($(e).find("input").css("border","1px solid #ddd"),$(e).find("select").val()||$(e).find("input").val()){if(0==$(e).find('[name="phoneCode"]').val()||!$(e).find('[name="code"]').val()||!$(e).find('[name="part1"]').val())return $(e).find("input").css("border","1px solid #f00"),l="Please, check phone number",!1;c.length>0&&(c+=","),c+=$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()+" "+$(e).find('[name="part2"]').val(),1==$(e).find('[name="sms"]').val()&&(n.append("sms",$(e).find('[name="phoneCode"]').val()+" "+$(e).find('[name="code"]').val()+" "+$(e).find('[name="part1"]').val()),i=1)}}),c.length?n.append("phone",c):l||(l="Phone can not be empty"),i||n.append("sms",""),l?(alr.show({class:"alrDanger",content:l,delay:2}),loadBtn.stop($(e.target).find('button[type="submit"]'))):$.ajax({type:"POST",processData:!1,contentType:!1,url:"/agents/stores/send",data:n}).done(function(t){loadBtn.stop($(e.target).find('button[type="submit"]')),t>0&&(alr.show({class:"alrSuccess",content:lang[8],delay:2}),a?Page.get("/agents/stores/"):Page.get("/agents/stores/edit/"+t))})},delStore:function(t){$.post("/agents/stores/del",{id:t},function(e){"OK"==e?$("#store_"+t).addClass("deleted"):alr.show({class:"alrDanger",content:lang[9],delay:2})})}};